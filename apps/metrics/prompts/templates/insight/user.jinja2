<metrics_context team="{{ metadata.team_name }}" period="{{ metadata.days }} days">
# Period: {{ metadata.start_date }} to {{ metadata.end_date }}

## PRIORITY ISSUES
{% set has_priority = false %}
{% if copilot_metrics and copilot_metrics.waste_per_contributor and copilot_metrics.waste_per_contributor > 100 %}
{% set has_priority = true %}
- üî¥ COPILOT WASTE: ${{ copilot_metrics.waste_per_contributor }}/contributor/month (major cost issue)
{% endif %}
{% if copilot_metrics and copilot_metrics.avg_acceptance_rate and copilot_metrics.avg_acceptance_rate < 20 %}
{% set has_priority = true %}
- üî¥ COPILOT ADOPTION: {{ "%.0f"|format(copilot_metrics.avg_acceptance_rate) }}% acceptance (very low, training needed)
{% endif %}
{% if team_health.bottleneck %}
{% set has_priority = true %}
- üî¥ REVIEW BOTTLENECK: @@{{ team_health.bottleneck.github_username }} has {{ team_health.bottleneck.pending_count }} pending reviews
{% endif %}
{% if quality.revert_rate > 5 %}
{% set has_priority = true %}
- üü° QUALITY: {{ "%.1f"|format(quality.revert_rate) }}% revert rate (high)
{% endif %}
{% if quality.large_pr_pct > 30 %}
{% set has_priority = true %}
- üü° PR SIZE: {{ "%.0f"|format(quality.large_pr_pct) }}% large PRs (>500 lines)
{% endif %}
{% if team_health.pr_distribution.top_contributor_pct > 50 %}
{% set has_priority = true %}
- üü° BUS FACTOR: Top contributor at {{ "%.0f"|format(team_health.pr_distribution.top_contributor_pct) }}% of work
{% endif %}
{% if not has_priority %}
- ‚úÖ No critical issues detected
{% endif %}

## METRICS DATA

### Velocity

**Throughput (PRs merged)**
- Current: {{ velocity.throughput.current }} PRs
- Previous: {{ velocity.throughput.previous }} PRs
- Change: {% if velocity.throughput.pct_change is not none %}{{ "%.1f"|format(velocity.throughput.pct_change) }}%{% else %}N/A{% endif %}

**Cycle Time (hours from PR open to merge)**
- Current: {% if velocity.cycle_time.current is not none %}{{ "%.1f"|format(velocity.cycle_time.current) }}h{% else %}N/A{% endif %}
- Previous: {% if velocity.cycle_time.previous is not none %}{{ "%.1f"|format(velocity.cycle_time.previous) }}h{% else %}N/A{% endif %}
- Change: {% if velocity.cycle_time.pct_change is not none %}{{ "%.1f"|format(velocity.cycle_time.pct_change) }}% (positive = slower){% else %}N/A{% endif %}

**Review Time (hours to first review)**
- Current: {% if velocity.review_time.current is not none %}{{ "%.1f"|format(velocity.review_time.current) }}h{% else %}N/A{% endif %}
- Previous: {% if velocity.review_time.previous is not none %}{{ "%.1f"|format(velocity.review_time.previous) }}h{% else %}N/A{% endif %}
- Change: {% if velocity.review_time.pct_change is not none %}{{ "%.1f"|format(velocity.review_time.pct_change) }}%{% else %}N/A{% endif %}

### Quality

- Reverts: {{ quality.revert_count }} ({{ "%.1f"|format(quality.revert_rate) }}% rate) {% if quality.revert_rate > 5 %}‚ö†Ô∏è HIGH{% endif %}
- Hotfixes: {{ quality.hotfix_count }} ({{ "%.1f"|format(quality.hotfix_rate) }}% rate)
- Avg review rounds: {% if quality.avg_review_rounds is not none %}{{ "%.1f"|format(quality.avg_review_rounds) }}{% else %}N/A{% endif %}
- Large PRs (>500 lines): {{ "%.1f"|format(quality.large_pr_pct) }}% {% if quality.large_pr_pct > 30 %}‚ö†Ô∏è HIGH{% endif %}

### Team Health

- Active contributors: {{ team_health.active_contributors }}
- Top contributor share: {{ "%.1f"|format(team_health.pr_distribution.top_contributor_pct) }}% {% if team_health.pr_distribution.top_contributor_pct > 50 %}‚ö†Ô∏è BUS FACTOR RISK{% endif %}
- Work concentration: {{ "HIGH RISK" if team_health.pr_distribution.is_concentrated else "Healthy" }}
{% if team_health.review_distribution.avg_reviews_per_reviewer is not none %}
- Avg reviews per reviewer: {{ "%.1f"|format(team_health.review_distribution.avg_reviews_per_reviewer) }}
{% endif %}
- Max reviews (single person): {{ team_health.review_distribution.max_reviews }}

**Open PRs Status:**
{% if team_health.open_prs %}
- Total open: {{ team_health.open_prs.total_open }} PRs
- Ready for review: {{ team_health.open_prs.ready_for_review }} (non-draft, actionable)
- Work in progress: {{ team_health.open_prs.draft_count }} drafts ({{ "%.0f"|format(team_health.open_prs.draft_pct) }}%)
{% else %}
- No open PR data available
{% endif %}
{% if team_health.bottleneck %}
- ‚ö†Ô∏è BOTTLENECK: @@{{ team_health.bottleneck.github_username }} ({{ team_health.bottleneck.reviewer_name }}) has {{ team_health.bottleneck.pending_count }} pending reviews (non-draft PRs only)
{% endif %}

**Top Contributors (use @username for author mentions, @@username for reviewer mentions):**
{% for c in team_health.top_contributors %}
- @{{ c.github_username }}: {{ c.pr_count }} PRs ({{ c.pct_share }}%)
{% endfor %}

### AI Impact

- AI-assisted PRs: {{ ai_impact.ai_pr_count }} ({{ "%.1f"|format(ai_impact.ai_adoption_pct) }}% adoption)
- Non-AI PRs: {{ ai_impact.non_ai_pr_count }}
{% if ai_impact.ai_avg_cycle_time is not none and ai_impact.non_ai_avg_cycle_time is not none %}
- AI PR cycle time: {{ "%.1f"|format(ai_impact.ai_avg_cycle_time) }}h
- Non-AI PR cycle time: {{ "%.1f"|format(ai_impact.non_ai_avg_cycle_time) }}h
{% set ai_diff_pct = ((ai_impact.ai_avg_cycle_time - ai_impact.non_ai_avg_cycle_time) / ai_impact.non_ai_avg_cycle_time * 100) if ai_impact.non_ai_avg_cycle_time > 0 else 0 %}
{% if ai_diff_pct < -10 %}
- ‚úÖ AI PRs are {{ "%.0f"|format(ai_diff_pct|abs) }}% FASTER
{% elif ai_diff_pct > 10 %}
- ‚ö†Ô∏è AI PRs are {{ "%.0f"|format(ai_diff_pct) }}% SLOWER
{% else %}
- AI PRs have similar cycle time to non-AI PRs
{% endif %}
{% endif %}
{% if jira %}

### Jira Integration

**Sprint Performance:**
- Issues resolved: {{ jira.sprint_metrics.issues_resolved }}
- Story points completed: {{ jira.sprint_metrics.story_points_completed }}
- Avg issue cycle time: {% if jira.sprint_metrics.avg_cycle_time_hours is not none %}{{ "%.1f"|format(jira.sprint_metrics.avg_cycle_time_hours) }}h{% else %}N/A{% endif %}

**PR-Jira Correlation:**
- PRs with Jira links: {{ jira.pr_correlation.linked_count }}/{{ jira.pr_correlation.total_prs }} ({{ "%.1f"|format(jira.pr_correlation.linkage_rate) }}%)
{% if jira.pr_correlation.linkage_rate < 50 %}‚ö†Ô∏è LOW LINKAGE - many PRs lack Jira context{% endif %}
- Linked PRs avg cycle time: {% if jira.pr_correlation.linked_avg_cycle_time is not none %}{{ "%.1f"|format(jira.pr_correlation.linked_avg_cycle_time) }}h{% else %}N/A{% endif %}
- Unlinked PRs avg cycle time: {% if jira.pr_correlation.unlinked_avg_cycle_time is not none %}{{ "%.1f"|format(jira.pr_correlation.unlinked_avg_cycle_time) }}h{% else %}N/A{% endif %}
{% endif %}
{% if copilot_metrics %}

### GitHub Copilot Usage

{% include 'insight/sections/copilot_metrics.jinja2' %}
{% endif %}

</metrics_context>

<task>Analyze metrics and generate insight JSON.</task>
