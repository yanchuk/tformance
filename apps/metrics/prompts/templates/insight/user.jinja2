<metrics_context team="{{ metadata.team_name }}" period="{{ metadata.days }} days">
# Period: {{ metadata.start_date }} to {{ metadata.end_date }}

## METRICS DATA

### Velocity

**Throughput (PRs merged)**
- Current: {{ velocity.throughput.current }} PRs
- Previous: {{ velocity.throughput.previous }} PRs
- Change: {% if velocity.throughput.pct_change is not none %}{{ "%.1f"|format(velocity.throughput.pct_change) }}%{% else %}N/A{% endif %}

**Cycle Time (hours from PR open to merge)**
- Current: {% if velocity.cycle_time.current is not none %}{{ "%.1f"|format(velocity.cycle_time.current) }}h{% else %}N/A{% endif %}
- Previous: {% if velocity.cycle_time.previous is not none %}{{ "%.1f"|format(velocity.cycle_time.previous) }}h{% else %}N/A{% endif %}
- Change: {% if velocity.cycle_time.pct_change is not none %}{{ "%.1f"|format(velocity.cycle_time.pct_change) }}% (positive = slower){% else %}N/A{% endif %}

**Review Time (hours to first review)**
- Current: {% if velocity.review_time.current is not none %}{{ "%.1f"|format(velocity.review_time.current) }}h{% else %}N/A{% endif %}
- Previous: {% if velocity.review_time.previous is not none %}{{ "%.1f"|format(velocity.review_time.previous) }}h{% else %}N/A{% endif %}
- Change: {% if velocity.review_time.pct_change is not none %}{{ "%.1f"|format(velocity.review_time.pct_change) }}%{% else %}N/A{% endif %}

### Quality

- Reverts: {{ quality.revert_count }} ({{ "%.1f"|format(quality.revert_rate) }}% rate) {% if quality.revert_rate > 5 %}⚠️ HIGH{% endif %}
- Hotfixes: {{ quality.hotfix_count }} ({{ "%.1f"|format(quality.hotfix_rate) }}% rate)
- Avg review rounds: {% if quality.avg_review_rounds is not none %}{{ "%.1f"|format(quality.avg_review_rounds) }}{% else %}N/A{% endif %}
- Large PRs (>500 lines): {{ "%.1f"|format(quality.large_pr_pct) }}% {% if quality.large_pr_pct > 30 %}⚠️ HIGH{% endif %}

### Team Health

- Active contributors: {{ team_health.active_contributors }}
- Top contributor share: {{ "%.1f"|format(team_health.pr_distribution.top_contributor_pct) }}% {% if team_health.pr_distribution.top_contributor_pct > 50 %}⚠️ BUS FACTOR RISK{% endif %}
- Work concentration: {{ "HIGH RISK" if team_health.pr_distribution.is_concentrated else "Healthy" }}
{% if team_health.review_distribution.avg_reviews_per_reviewer is not none %}
- Avg reviews per reviewer: {{ "%.1f"|format(team_health.review_distribution.avg_reviews_per_reviewer) }}
{% endif %}
- Max reviews (single person): {{ team_health.review_distribution.max_reviews }}
{% if team_health.bottleneck %}
- ⚠️ BOTTLENECK: {{ team_health.bottleneck.reviewer_name }} has {{ team_health.bottleneck.pending_count }} pending reviews
{% endif %}

### AI Impact

- AI-assisted PRs: {{ ai_impact.ai_pr_count }} ({{ "%.1f"|format(ai_impact.ai_adoption_pct) }}% adoption)
- Non-AI PRs: {{ ai_impact.non_ai_pr_count }}
{% if ai_impact.ai_avg_cycle_time is not none and ai_impact.non_ai_avg_cycle_time is not none %}
- AI PR cycle time: {{ "%.1f"|format(ai_impact.ai_avg_cycle_time) }}h
- Non-AI PR cycle time: {{ "%.1f"|format(ai_impact.non_ai_avg_cycle_time) }}h
{% set ai_diff_pct = ((ai_impact.ai_avg_cycle_time - ai_impact.non_ai_avg_cycle_time) / ai_impact.non_ai_avg_cycle_time * 100) if ai_impact.non_ai_avg_cycle_time > 0 else 0 %}
{% if ai_diff_pct < -10 %}
- ✅ AI PRs are {{ "%.0f"|format(ai_diff_pct|abs) }}% FASTER
{% elif ai_diff_pct > 10 %}
- ⚠️ AI PRs are {{ "%.0f"|format(ai_diff_pct) }}% SLOWER
{% else %}
- AI PRs have similar cycle time to non-AI PRs
{% endif %}
{% endif %}

</metrics_context>

<task>
Analyze this data and return JSON with:
1. headline: The ROOT CAUSE (not symptom) in 8-12 words, NO numbers
2. detail: 2-3 sentences using QUALITATIVE language (see system prompt)
3. recommendation: ONE specific action addressing an issue from your detail
4. actions: 2-3 buttons matching the issues you discussed
</task>
