{% extends "web/app/app_base.html" %}
{% load static %}
{% load i18n %}

{% block app %}
<section class="app-card">
  <div class="app-card-header">
    <div>
      <a href="{% url 'integrations:integrations_home' %}"
         class="inline-flex items-center gap-2 text-sm text-base-content/70 hover:text-base-content transition-colors mb-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        {% translate "Back to Integrations" %}
      </a>
      <h1 class="app-page-title">{% translate "GitHub Members" %}</h1>
      <p class="app-page-subtitle">{% translate "Manage team members imported from GitHub." %}</p>
    </div>
    {% if request.team_membership.role == 'admin' %}
      <button
        hx-post="{% url 'integrations:github_members_sync' %}"
        hx-target="#member-sync-status"
        hx-swap="outerHTML"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        class="app-btn-primary app-btn-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        {% translate "Sync Now" %}
      </button>
    {% endif %}
  </div>

  {# Target element for HTMX sync status updates #}
  {% include "integrations/partials/member_sync_progress.html" %}

  {% if members %}
    <div class="overflow-x-auto">
      <table class="app-table">
        <thead>
          <tr>
            <th>{% translate "Name" %}</th>
            <th>{% translate "GitHub Username" %}</th>
            <th>{% translate "Email" %}</th>
            <th>{% translate "Status" %}</th>
            {% if request.team_membership.role == 'admin' %}
              <th class="text-right">{% translate "Actions" %}</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
            {% include "integrations/components/member_row.html" %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-4 text-sm text-base-content/70">
      {% blocktranslate count counter=members.count %}
        Showing {{ counter }} member
      {% plural %}
        Showing {{ counter }} members
      {% endblocktranslate %}
    </div>
  {% else %}
    {% include "web/components/empty_state.html" with icon="users" title="No GitHub members found" description="Click the 'Sync Now' button to import members from your GitHub organization." %}
  {% endif %}
</section>
{% endblock %}
