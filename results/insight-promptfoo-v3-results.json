{
  "evalId": "eval-vFD-2025-12-31T19:35:48",
  "results": {
    "version": 3,
    "timestamp": "2025-12-31T19:35:48.127Z",
    "prompts": [
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "GPT-OSS-20B",
        "metrics": {
          "score": 10,
          "testPassCount": 10,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 21,
          "assertFailCount": 0,
          "totalLatencyMs": 10255,
          "tokenUsage": {
            "prompt": 17832,
            "completion": 7508,
            "cached": 0,
            "total": 25340,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 5381,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      },
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "GPT-OSS-120B",
        "metrics": {
          "score": 10,
          "testPassCount": 10,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 21,
          "assertFailCount": 0,
          "totalLatencyMs": 17889,
          "tokenUsage": {
            "prompt": 17832,
            "completion": 6871,
            "cached": 0,
            "total": 24703,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 4352,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      },
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "Llama-3.3-70B",
        "metrics": {
          "score": 10,
          "testPassCount": 10,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 21,
          "assertFailCount": 0,
          "totalLatencyMs": 10710,
          "tokenUsage": {
            "prompt": 17601,
            "completion": 2577,
            "cached": 0,
            "total": 20178,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      }
    ],
    "results": [
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid JSON structure with 4 metric cards"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "P1: Headline addresses quality"
              }
            }
          ]
        },
        "id": "61b1d459-b54a-41d7-9671-aff247f6f277",
        "latencyMs": 629,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Acme Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 100 PRs merged\\n- Previous period: 83 PRs merged\\n- Change: +20.5%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 28.5 hours\\n- Previous period: 29.2 hours\\n- Change: -2.4% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 4.2 hours\\n- Previous period: 4.8 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 3 (3.0% of merged PRs)\\n- Average review rounds: 1.8\\n- Large PRs (>500 lines): 8.0%\\n\\n## Team Health\\n\\n- Active contributors: 8\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 12.5\\n- Max reviews by single reviewer: 22\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 45 (45.0% adoption)\\n- Non-AI PRs: 55\\n- AI PR avg cycle time: 25.6 hours\\n- Non-AI PR avg cycle time: 28.5 hours\\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\", \"detail\":\"Despite a 20.5% increase in throughput and a 2.4% reduction in cycle time, the 12% revert rate signals significant quality issues that could impact customer stability.\", \"recommendation\":\"Conduct a root‑cause analysis of reverted PRs and tighten pre‑merge checks, such as automated tests or stricter review guidelines.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+20.5%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"-2.4%\",\"trend\":\"positive\"}, {\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"}, {\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"} ] }",
          "tokenUsage": {
            "total": 2236,
            "prompt": 1788,
            "completion": 448,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 270
            }
          },
          "cached": false,
          "latencyMs": 617,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 12% reverts - must address quality",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid JSON structure with 4 metric cards"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "P1: Headline addresses quality"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid JSON structure with 4 metric cards"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "P1: Headline addresses quality"
              }
            }
          ]
        },
        "id": "7fe85d77-b2a0-4bd1-a461-bdb7ad9c82a8",
        "latencyMs": 1170,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Acme Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 100 PRs merged\\n- Previous period: 83 PRs merged\\n- Change: +20.5%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 28.5 hours\\n- Previous period: 29.2 hours\\n- Change: -2.4% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 4.2 hours\\n- Previous period: 4.8 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 3 (3.0% of merged PRs)\\n- Average review rounds: 1.8\\n- Large PRs (>500 lines): 8.0%\\n\\n## Team Health\\n\\n- Active contributors: 8\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 12.5\\n- Max reviews by single reviewer: 22\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 45 (45.0% adoption)\\n- Non-AI PRs: 55\\n- AI PR avg cycle time: 25.6 hours\\n- Non-AI PR avg cycle time: 28.5 hours\\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold, despite 20.5% throughput growth and 45% AI adoption.\",\n  \"detail\": \"The 12% revert rate indicates significant quality issues, with 12 reverts out of 100 merged PRs. Although AI adoption at 45% has resulted in 10.2% faster cycle times for AI-assisted PRs, the overall quality concerns take priority. Throughput has increased by 20.5% compared to the previous period, but this growth is overshadowed by the quality crisis.\",\n  \"recommendation\": \"Investigate the 12 reverted PRs to identify root causes and implement corrective actions to improve code quality and reduce reverts.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20.5%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-2.4%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2026,
            "prompt": 1765,
            "completion": 261,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1155,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 12% reverts - must address quality",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid JSON structure with 4 metric cards"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "P1: Headline addresses quality"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid JSON structure with 4 metric cards"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "P1: Headline addresses quality"
              }
            }
          ]
        },
        "id": "7b7bbcd8-592c-42f3-ac18-8f76abc06e53",
        "latencyMs": 2102,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Acme Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 100 PRs merged\\n- Previous period: 83 PRs merged\\n- Change: +20.5%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 28.5 hours\\n- Previous period: 29.2 hours\\n- Change: -2.4% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 4.2 hours\\n- Previous period: 4.8 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 3 (3.0% of merged PRs)\\n- Average review rounds: 1.8\\n- Large PRs (>500 lines): 8.0%\\n\\n## Team Health\\n\\n- Active contributors: 8\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 12.5\\n- Max reviews by single reviewer: 22\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 45 (45.0% adoption)\\n- Non-AI PRs: 55\\n- AI PR avg cycle time: 25.6 hours\\n- Non-AI PR avg cycle time: 28.5 hours\\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of merged PRs were reverted this period, exceeding the 8% threshold and threatening stability.\",\n  \"detail\": \"Despite a 20.5% increase in throughput and a 2.4% reduction in cycle time, the revert rate rose to 12%, indicating a serious quality drop. AI adoption sits at 45% and is shaving 10% off cycle time, but it does not offset the quality concerns.\",\n  \"recommendation\": \"Launch a root‑cause analysis of reverted PRs, tighten pre‑merge testing, and enforce stricter review criteria to improve stability.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20.5%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-2.4%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2396,
            "prompt": 1788,
            "completion": 608,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 373
            }
          },
          "cached": false,
          "latencyMs": 2088,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 12% reverts - must address quality",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid JSON structure with 4 metric cards"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "P1: Headline addresses quality"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
              }
            }
          ]
        },
        "id": "bf61e090-4b89-4713-b682-116488cd5706",
        "latencyMs": 788,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Beta Inc\\n\\n## Period: 2024-11-15 to 2024-12-15 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 45 PRs merged\\n- Previous period: 44 PRs merged\\n- Change: +2.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.2 hours\\n- Previous period: 21.4 hours\\n- Change: -15.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.1 hours\\n- Previous period: 3.8 hours\\n- Change: -18.4% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 1 (2.2% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 6.7%\\n\\n## Team Health\\n\\n- Active contributors: 6\\n- Top contributor share: 25.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 7.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 14 (31.1% adoption)\\n- Non-AI PRs: 31\\n- AI PR avg cycle time: 17.8 hours\\n- Non-AI PR avg cycle time: 18.4 hours\\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{  \n  \"headline\": \"Quality alert: 9% of PRs were reverted this period, exceeding the 8% threshold.\",  \n  \"detail\": \"Despite a modest 2.3% increase in throughput and a 15% reduction in cycle time, the 9% revert rate signals significant quality issues that could impact customer stability.\",  \n  \"recommendation\": \"Conduct a root‑cause analysis of the reverted PRs and tighten review or testing checkpoints to reduce reverts.\",  \n  \"metric_cards\": [  \n    {\"label\": \"Throughput\", \"value\": \"+2.3%\", \"trend\": \"positive\"},  \n    {\"label\": \"Cycle Time\", \"value\": \"-15%\", \"trend\": \"positive\"},  \n    {\"label\": \"AI Adoption\", \"value\": \"31%\", \"trend\": \"neutral\"},  \n    {\"label\": \"Quality\", \"value\": \"9% reverts\", \"trend\": \"warning\"}  \n  ]}",
          "tokenUsage": {
            "total": 2371,
            "prompt": 1787,
            "completion": 584,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 376
            }
          },
          "cached": false,
          "latencyMs": 784,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 9% reverts",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
              }
            }
          ]
        },
        "id": "0a172a98-21b1-4eb5-8792-dc95010c1c5c",
        "latencyMs": 927,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Beta Inc\\n\\n## Period: 2024-11-15 to 2024-12-15 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 45 PRs merged\\n- Previous period: 44 PRs merged\\n- Change: +2.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.2 hours\\n- Previous period: 21.4 hours\\n- Change: -15.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.1 hours\\n- Previous period: 3.8 hours\\n- Change: -18.4% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 1 (2.2% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 6.7%\\n\\n## Team Health\\n\\n- Active contributors: 6\\n- Top contributor share: 25.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 7.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 14 (31.1% adoption)\\n- Non-AI PRs: 31\\n- AI PR avg cycle time: 17.8 hours\\n- Non-AI PR avg cycle time: 18.4 hours\\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 9% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite a 15% decrease in cycle time and a healthy team distribution, the 9% revert rate indicates quality issues. Throughput has increased by 2.3% with 45 PRs merged in the current period. AI adoption is at 31.1%, with AI-assisted PRs being 3.3% faster than non-AI PRs.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and implement quality control measures.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+2.3%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-15.0%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"31.1%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"9% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1993,
            "prompt": 1764,
            "completion": 229,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 924,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 9% reverts",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
              }
            }
          ]
        },
        "id": "e6285252-5dea-4bc2-9676-cad2c93dd2ba",
        "latencyMs": 1511,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for Beta Inc\\n\\n## Period: 2024-11-15 to 2024-12-15 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 45 PRs merged\\n- Previous period: 44 PRs merged\\n- Change: +2.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.2 hours\\n- Previous period: 21.4 hours\\n- Change: -15.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.1 hours\\n- Previous period: 3.8 hours\\n- Change: -18.4% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 1 (2.2% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 6.7%\\n\\n## Team Health\\n\\n- Active contributors: 6\\n- Top contributor share: 25.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 7.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 14 (31.1% adoption)\\n- Non-AI PRs: 31\\n- AI PR avg cycle time: 17.8 hours\\n- Non-AI PR avg cycle time: 18.4 hours\\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 9% of merged PRs were reverted this period, exceeding the 8% threshold and risking stability.\",\n  \"detail\": \"Beta Inc merged 45 PRs (up 2.3% from the prior period) with cycle time improving 15% to 18.2 h. Despite a 31.1% AI adoption that makes AI‑assisted PRs 3.3% faster, the revert rate rose to 9%, indicating a quality problem that could affect customers.\",\n  \"recommendation\": \"Launch a focused root‑cause analysis of reverted PRs and tighten pre‑merge quality gates (e.g., mandatory automated tests and peer‑review checklists) to bring the revert rate below 8% within the next sprint.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+2.3%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"18.2h (-15%)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"31.1%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"9% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2417,
            "prompt": 1787,
            "completion": 630,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 357
            }
          },
          "cached": false,
          "latencyMs": 1506,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1] Quality crisis 9% reverts",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "P2: AI positive impact"
              }
            }
          ]
        },
        "id": "4d670bd3-45f6-4128-b779-8e2c15874bb1",
        "latencyMs": 1284,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for TechStartup\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 78 PRs merged\\n- Previous period: 68 PRs merged\\n- Change: +14.7%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 16.2 hours\\n- Previous period: 25.3 hours\\n- Change: -36.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 4.1 hours\\n- Change: -31.7% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.3% of merged PRs)\\n- Hotfixes: 2 (2.6% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 5.1%\\n\\n## Team Health\\n\\n- Active contributors: 12\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 15\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 55 (70.5% adoption)\\n- Non-AI PRs: 23\\n- AI PR avg cycle time: 12.4 hours\\n- Non-AI PR avg cycle time: 23.0 hours\\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"AI adoption accelerates delivery: 70.5% of PRs are AI‑assisted, cutting cycle time by 46% compared to non‑AI PRs.\", \"detail\":\"The team merged 78 PRs this month, a 14.7% increase, while average cycle time dropped from 25.3 to 16.2 hours—a 36% improvement. AI‑assisted PRs average 12.4 hours versus 23.0 hours for non‑AI, a 46% faster turnaround, and the revert rate remains healthy at 1.3%.\", \"recommendation\":\"Scale AI assistance to the remaining 29.5% of PRs and track cycle time and quality metrics to ensure continued improvement.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+14.7%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"-36%\",\"trend\":\"positive\"}, {\"label\":\"AI Adoption\",\"value\":\"70.5%\",\"trend\":\"positive\"}, {\"label\":\"Quality\",\"value\":\"1.3% reverts\",\"trend\":\"positive\"} ]}",
          "tokenUsage": {
            "total": 2734,
            "prompt": 1777,
            "completion": 957,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 719
            }
          },
          "cached": false,
          "latencyMs": 1281,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI positive - 70% adoption, 46% faster",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "P2: AI positive impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "P2: AI positive impact"
              }
            }
          ]
        },
        "id": "4b737e97-2696-42fb-8068-72d889981f8b",
        "latencyMs": 1083,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for TechStartup\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 78 PRs merged\\n- Previous period: 68 PRs merged\\n- Change: +14.7%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 16.2 hours\\n- Previous period: 25.3 hours\\n- Change: -36.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 4.1 hours\\n- Change: -31.7% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.3% of merged PRs)\\n- Hotfixes: 2 (2.6% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 5.1%\\n\\n## Team Health\\n\\n- Active contributors: 12\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 15\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 55 (70.5% adoption)\\n- Non-AI PRs: 23\\n- AI PR avg cycle time: 12.4 hours\\n- Non-AI PR avg cycle time: 23.0 hours\\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption boosts velocity: AI-assisted PRs are 46.1% faster than non-AI PRs, with 70.5% adoption rate.\",\n  \"detail\": \"The current period saw a significant increase in throughput, with 78 PRs merged, representing a 14.7% growth from the previous period. The average cycle time decreased by 36.0% to 16.2 hours, with AI-assisted PRs averaging 12.4 hours, outperforming non-AI PRs by 46.1%. Quality metrics are healthy, with a low revert rate of 1.3% and no review bottleneck detected.\",\n  \"recommendation\": \"Continue to invest in AI tooling and training to further improve velocity and efficiency, while monitoring quality and team health metrics to ensure sustainable growth.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14.7%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-36.0%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70.5%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.3% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2033,
            "prompt": 1754,
            "completion": 279,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1079,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI positive - 70% adoption, 46% faster",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "P2: AI positive impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "P2: AI positive impact"
              }
            }
          ]
        },
        "id": "fc984f36-610a-435f-9700-a4dce0abc79f",
        "latencyMs": 1884,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for TechStartup\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 78 PRs merged\\n- Previous period: 68 PRs merged\\n- Change: +14.7%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 16.2 hours\\n- Previous period: 25.3 hours\\n- Change: -36.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 4.1 hours\\n- Change: -31.7% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.3% of merged PRs)\\n- Hotfixes: 2 (2.6% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 5.1%\\n\\n## Team Health\\n\\n- Active contributors: 12\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 15\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 55 (70.5% adoption)\\n- Non-AI PRs: 23\\n- AI PR avg cycle time: 12.4 hours\\n- Non-AI PR avg cycle time: 23.0 hours\\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption accelerates delivery: 70.5% AI‑assisted PRs are 46% faster, cutting overall cycle time by 36%\",\n  \"detail\": \"With AI used on 70.5% of PRs, AI‑assisted changes average 12.4 h versus 23.0 h for non‑AI, a 46.1% speed gain. This drives the overall cycle time down to 16.2 h (‑36%) and boosts throughput to 78 PRs (+14.7%). Quality remains high at only 1.3% revert rate.\",\n  \"recommendation\": \"Expand AI assistance to additional PRs, codify best‑practice guidelines, and set up a quarterly review of AI impact on cycle time and quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14.7%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-36%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70.5%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.3% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2512,
            "prompt": 1777,
            "completion": 735,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 461
            }
          },
          "cached": false,
          "latencyMs": 1880,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI positive - 70% adoption, 46% faster",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "P2: AI positive impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "P2: AI negative impact"
              }
            }
          ]
        },
        "id": "79b52b89-3a07-4385-aebd-057ea5a87af2",
        "latencyMs": 1114,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SlowCorp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 60 PRs merged\\n- Previous period: 55 PRs merged\\n- Change: +9.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 40.5 hours\\n- Previous period: 30.5 hours\\n- Change: +32.8% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 8.2 hours\\n- Previous period: 6.5 hours\\n- Change: +26.2% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 3 (5.0% of merged PRs)\\n- Hotfixes: 2 (3.3% of merged PRs)\\n- Average review rounds: 2.1\\n- Large PRs (>500 lines): 12.0%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 22.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 42 (70.0% adoption)\\n- Non-AI PRs: 18\\n- AI PR avg cycle time: 48.0 hours\\n- Non-AI PR avg cycle time: 24.0 hours\\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{  \n  \"headline\": \"AI adoption slows delivery: AI‑assisted PRs take 100% longer than non‑AI PRs despite 70% adoption.\",  \n  \"detail\": \"During December, 70% of merged PRs were AI‑assisted, yet their average cycle time was 48 hours versus 24 hours for non‑AI PRs – a 100% increase. The overall cycle time rose 32.8% to 40.5 hours, while throughput grew modestly by 9.1% to 60 PRs.\",  \n  \"recommendation\": \"Conduct a focused audit of the AI tooling and workflow to identify bottlenecks or misconfigurations that are inflating cycle time, and consider a phased reduction or retraining of the AI model.\",  \n  \"metric_cards\": [  \n    {\"label\": \"Throughput\", \"value\": \"+9.1%\", \"trend\": \"positive\"},  \n    {\"label\": \"Cycle Time\", \"value\": \"32.8%\", \"trend\": \"negative\"},  \n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},  \n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"positive\"}  \n  ]}",
          "tokenUsage": {
            "total": 2573,
            "prompt": 1779,
            "completion": 794,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 521
            }
          },
          "cached": false,
          "latencyMs": 1111,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI negative - 70% adoption, 100% slower",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "P2: AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "P2: AI negative impact"
              }
            }
          ]
        },
        "id": "1226b857-da59-4d43-bc2a-4cb048783a1b",
        "latencyMs": 953,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SlowCorp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 60 PRs merged\\n- Previous period: 55 PRs merged\\n- Change: +9.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 40.5 hours\\n- Previous period: 30.5 hours\\n- Change: +32.8% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 8.2 hours\\n- Previous period: 6.5 hours\\n- Change: +26.2% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 3 (5.0% of merged PRs)\\n- Hotfixes: 2 (3.3% of merged PRs)\\n- Average review rounds: 2.1\\n- Large PRs (>500 lines): 12.0%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 22.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 42 (70.0% adoption)\\n- Non-AI PRs: 18\\n- AI PR avg cycle time: 48.0 hours\\n- Non-AI PR avg cycle time: 24.0 hours\\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are 100% slower than non-AI PRs, despite 70% adoption.\",\n  \"detail\": \"The average cycle time for AI-assisted PRs is 48 hours, compared to 24 hours for non-AI PRs, indicating a significant slowdown. However, overall throughput has increased by 9.1% and quality metrics are stable, with a 5% revert rate. The team's distribution of work and reviews appears healthy, with no review bottleneck detected.\",\n  \"recommendation\": \"Investigate the causes of the slower cycle time for AI-assisted PRs to understand whether the benefits of AI adoption outweigh the current costs.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+9.1%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+32.8% (40.5h)\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2008,
            "prompt": 1755,
            "completion": 253,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 947,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI negative - 70% adoption, 100% slower",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "P2: AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "P2: AI negative impact"
              }
            }
          ]
        },
        "id": "1423d2fd-0077-478c-bb2e-c7de264a97fa",
        "latencyMs": 1571,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SlowCorp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 60 PRs merged\\n- Previous period: 55 PRs merged\\n- Change: +9.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 40.5 hours\\n- Previous period: 30.5 hours\\n- Change: +32.8% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 8.2 hours\\n- Previous period: 6.5 hours\\n- Change: +26.2% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 3 (5.0% of merged PRs)\\n- Hotfixes: 2 (3.3% of merged PRs)\\n- Average review rounds: 2.1\\n- Large PRs (>500 lines): 12.0%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 22.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 42 (70.0% adoption)\\n- Non-AI PRs: 18\\n- AI PR avg cycle time: 48.0 hours\\n- Non-AI PR avg cycle time: 24.0 hours\\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption is slowing delivery: 70% of PRs use AI, yet AI‑assisted PRs take twice as long as non‑AI PRs.\",\n  \"detail\": \"AI‑assisted PRs average 48 h versus 24 h for manual PRs—a 100% slowdown, driving the overall cycle time up 32.8% to 40.5 h. Throughput still rose modestly (+9.1% to 60 PRs), and quality remains acceptable (5% revert rate).\",\n  \"recommendation\": \"Run a focused analysis on the AI‑generated PRs to identify why they double cycle time, then refine prompts, add automated testing, or limit AI use to simpler changes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+9.1%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+32.8%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"neutral\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2426,
            "prompt": 1779,
            "completion": 647,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 385
            }
          },
          "cached": false,
          "latencyMs": 1568,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2] AI negative - 70% adoption, 100% slower",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "P2: AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
                "description": "P3: Addresses slowdown"
              }
            }
          ]
        },
        "id": "535cea28-e7a4-4a0c-b169-c45bc0a71975",
        "latencyMs": 1117,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for BigTech Enterprise\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 125 PRs merged\\n- Previous period: 100 PRs merged\\n- Change: +25.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 169.2 hours\\n- Previous period: 71.7 hours\\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\\n\\n### Review Time (hours to first review)\\n- Current period: 32.5 hours\\n- Previous period: 12.8 hours\\n- Change: +153.9% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (0.8% of merged PRs)\\n- Hotfixes: 2 (1.6% of merged PRs)\\n- Average review rounds: 2.8\\n- Large PRs (>500 lines): 18.0%\\n\\n## Team Health\\n\\n- Active contributors: 25\\n- Top contributor share: 17.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.0\\n- Max reviews by single reviewer: 18\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 43 (34.4% adoption)\\n- Non-AI PRs: 82\\n- AI PR avg cycle time: 155.0 hours\\n- Non-AI PR avg cycle time: 176.5 hours\\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Delivery slowdown: Cycle time jumped 136% this month, pushing merge times beyond acceptable limits.\", \"detail\":\"While throughput rose 25% to 125 PRs, the average cycle time ballooned from 71.7 to 169.2 hours (+136%), and review time spiked 153.9%. AI-assisted PRs are 12.2% faster, but overall delays suggest bottlenecks in the review or integration process.\", \"recommendation\":\"Conduct a focused review of the PR review workflow, enforce size limits, and consider parallel review queues to reduce cycle time.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+25%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"169.2 hrs (+136%)\",\"trend\":\"negative\"}, {\"label\":\"AI Adoption\",\"value\":\"34.4%\",\"trend\":\"neutral\"}, {\"label\":\"Quality\",\"value\":\"0.8% reverts\",\"trend\":\"positive\"} ] }",
          "tokenUsage": {
            "total": 2655,
            "prompt": 1786,
            "completion": 869,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 662
            }
          },
          "cached": false,
          "latencyMs": 1113,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3] Severe slowdown - 136% cycle time increase",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
              "description": "P3: Addresses slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
                "description": "P3: Addresses slowdown"
              }
            }
          ]
        },
        "id": "766b1843-c877-423f-8f53-53321d89072d",
        "latencyMs": 1152,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for BigTech Enterprise\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 125 PRs merged\\n- Previous period: 100 PRs merged\\n- Change: +25.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 169.2 hours\\n- Previous period: 71.7 hours\\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\\n\\n### Review Time (hours to first review)\\n- Current period: 32.5 hours\\n- Previous period: 12.8 hours\\n- Change: +153.9% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (0.8% of merged PRs)\\n- Hotfixes: 2 (1.6% of merged PRs)\\n- Average review rounds: 2.8\\n- Large PRs (>500 lines): 18.0%\\n\\n## Team Health\\n\\n- Active contributors: 25\\n- Top contributor share: 17.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.0\\n- Max reviews by single reviewer: 18\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 43 (34.4% adoption)\\n- Non-AI PRs: 82\\n- AI PR avg cycle time: 155.0 hours\\n- Non-AI PR avg cycle time: 176.5 hours\\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown in cycle time: 136% increase from 71.7 hours to 169.2 hours, indicating systemic delivery issues.\",\n  \"detail\": \"The current period saw a significant increase in cycle time, with a 136% change from the previous period, resulting in an average cycle time of 169.2 hours. This slowdown is a major concern, despite a 25% increase in throughput and healthy quality metrics, including a low revert rate of 0.8%. AI adoption is at 34.4%, with AI-assisted PRs being 12.2% faster than non-AI PRs.\",\n  \"recommendation\": \"Investigate the root causes of the severe slowdown in cycle time, focusing on process inefficiencies and potential bottlenecks, to improve delivery velocity.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+25%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+136%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"34.4%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2033,
            "prompt": 1763,
            "completion": 270,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1149,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3] Severe slowdown - 136% cycle time increase",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
              "description": "P3: Addresses slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
                "description": "P3: Addresses slowdown"
              }
            }
          ]
        },
        "id": "d973f6cf-f993-42d3-9582-c380d8598c0a",
        "latencyMs": 1958,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for BigTech Enterprise\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 125 PRs merged\\n- Previous period: 100 PRs merged\\n- Change: +25.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 169.2 hours\\n- Previous period: 71.7 hours\\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\\n\\n### Review Time (hours to first review)\\n- Current period: 32.5 hours\\n- Previous period: 12.8 hours\\n- Change: +153.9% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (0.8% of merged PRs)\\n- Hotfixes: 2 (1.6% of merged PRs)\\n- Average review rounds: 2.8\\n- Large PRs (>500 lines): 18.0%\\n\\n## Team Health\\n\\n- Active contributors: 25\\n- Top contributor share: 17.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.0\\n- Max reviews by single reviewer: 18\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 43 (34.4% adoption)\\n- Non-AI PRs: 82\\n- AI PR avg cycle time: 155.0 hours\\n- Non-AI PR avg cycle time: 176.5 hours\\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown: Cycle time surged 136% this month, jeopardizing delivery speed.\",\n  \"detail\": \"Average PR cycle time climbed from 71.7 h to 169.2 h (+136%). Throughput rose 25% to 125 merged PRs, but review time also jumped 154% (32.5 h vs 12.8 h), indicating bottlenecks despite higher output.\",\n  \"recommendation\": \"Launch a root‑cause analysis of the PR pipeline—break down large PRs, tighten review SLAs, and add automation or staffing where needed to reduce cycle time.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+25%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+136%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"34.4%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2504,
            "prompt": 1786,
            "completion": 718,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 480
            }
          },
          "cached": false,
          "latencyMs": 1955,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3] Severe slowdown - 136% cycle time increase",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
              "description": "P3: Addresses slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
              }
            }
          ]
        },
        "id": "3f6796a1-2bf2-443c-89b3-1fde491c410c",
        "latencyMs": 1132,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for RocketShip Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 72 PRs merged\\n- Previous period: 45 PRs merged\\n- Change: +60.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 12.8 hours\\n- Previous period: 29.8 hours\\n- Change: -57.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.1 hours\\n- Previous period: 5.2 hours\\n- Change: -59.6% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 2 (2.8% of merged PRs)\\n- Hotfixes: 1 (1.4% of merged PRs)\\n- Average review rounds: 1.3\\n- Large PRs (>500 lines): 4.2%\\n\\n## Team Health\\n\\n- Active contributors: 11\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 30 (41.7% adoption)\\n- Non-AI PRs: 42\\n- AI PR avg cycle time: 10.8 hours\\n- Non-AI PR avg cycle time: 14.0 hours\\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Throughput surge: 60% increase in merged PRs this month.\",\"detail\":\"RocketShip merged 72 PRs in December, up from 45 in November—a 60% jump. Cycle time dropped 57% to 12.8 hours, and AI‑assisted PRs are 22.9% faster, all while the revert rate stays low at 2.8%.\",\"recommendation\":\"Capitalize on the momentum by scaling the engineering team—hire 1–2 developers or expand automation—to sustain the high throughput without compromising quality.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"+60%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"-57%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"41.7%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"2.8% reverts\",\"trend\":\"positive\"}]}",
          "tokenUsage": {
            "total": 2637,
            "prompt": 1778,
            "completion": 859,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 667
            }
          },
          "cached": false,
          "latencyMs": 1128,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput surge +60%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
              }
            }
          ]
        },
        "id": "66109374-d8f2-425a-9b12-34eada8845e7",
        "latencyMs": 1086,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for RocketShip Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 72 PRs merged\\n- Previous period: 45 PRs merged\\n- Change: +60.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 12.8 hours\\n- Previous period: 29.8 hours\\n- Change: -57.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.1 hours\\n- Previous period: 5.2 hours\\n- Change: -59.6% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 2 (2.8% of merged PRs)\\n- Hotfixes: 1 (1.4% of merged PRs)\\n- Average review rounds: 1.3\\n- Large PRs (>500 lines): 4.2%\\n\\n## Team Health\\n\\n- Active contributors: 11\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 30 (41.7% adoption)\\n- Non-AI PRs: 42\\n- AI PR avg cycle time: 10.8 hours\\n- Non-AI PR avg cycle time: 14.0 hours\\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption boosts velocity: 41.7% of PRs are AI-assisted, with 22.9% faster cycle times.\",\n  \"detail\": \"The team merged 72 PRs in the current period, a 60% increase from the previous period. AI-assisted PRs averaged 10.8 hours cycle time, 22.9% faster than non-AI PRs. Quality metrics are healthy, with a 2.8% revert rate and no review bottleneck detected.\",\n  \"recommendation\": \"Continue to invest in AI adoption and monitor its impact on cycle time and quality to ensure sustained velocity gains.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+60%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-57%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"41.7%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"2.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1990,
            "prompt": 1755,
            "completion": 235,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1082,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput surge +60%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
              }
            }
          ]
        },
        "id": "a8207ab3-f244-46ad-864d-32dbe17f5315",
        "latencyMs": 1736,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for RocketShip Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 72 PRs merged\\n- Previous period: 45 PRs merged\\n- Change: +60.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 12.8 hours\\n- Previous period: 29.8 hours\\n- Change: -57.0% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.1 hours\\n- Previous period: 5.2 hours\\n- Change: -59.6% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 2 (2.8% of merged PRs)\\n- Hotfixes: 1 (1.4% of merged PRs)\\n- Average review rounds: 1.3\\n- Large PRs (>500 lines): 4.2%\\n\\n## Team Health\\n\\n- Active contributors: 11\\n- Top contributor share: 20.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.5\\n- Max reviews by single reviewer: 14\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 30 (41.7% adoption)\\n- Non-AI PRs: 42\\n- AI PR avg cycle time: 10.8 hours\\n- Non-AI PR avg cycle time: 14.0 hours\\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput surge: PR merges jumped 60% this month, raising output dramatically.\",\n  \"detail\": \"Merged PRs rose from 45 to 72 (+60%). Cycle time fell 57% to 12.8 h and review time dropped 60% to 2.1 h, while quality stayed strong with only 2.8% reverts. AI assists 41.7% of PRs and speeds them up by 22.9%.\",\n  \"recommendation\": \"Conduct a capacity review to ensure reviewers and CI pipelines can sustain the higher volume without degrading quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+60%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-57%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"41.7%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"2.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2418,
            "prompt": 1778,
            "completion": 640,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 407
            }
          },
          "cached": false,
          "latencyMs": 1731,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput surge +60%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
              }
            }
          ]
        },
        "id": "b272f357-e553-46ca-94a8-eac762806a66",
        "latencyMs": 1218,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SmallTeam LLC\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 8 PRs merged\\n- Previous period: 22 PRs merged\\n- Change: -63.6%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.5 hours\\n- Previous period: 24.7 hours\\n- Change: -25.1% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.2 hours\\n- Previous period: 4.8 hours\\n- Change: -33.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 0 (0.0% of merged PRs)\\n- Average review rounds: 1.2\\n- Large PRs (>500 lines): 0.0%\\n\\n## Team Health\\n\\n- Active contributors: 3\\n- Top contributor share: 50.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 2.7\\n- Max reviews by single reviewer: 4\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 3 (37.5% adoption)\\n- Non-AI PRs: 5\\n- AI PR avg cycle time: 16.2 hours\\n- Non-AI PR avg cycle time: 19.9 hours\\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Throughput slump: 63.6% drop in merged PRs despite faster cycle times.\", \"detail\":\"Merged PRs fell from 22 to 8, a 63.6% decline. Cycle time improved by 25.1% (18.5h vs 24.7h) and review time by 33.3% (3.2h vs 4.8h). Reverts remain at 0% and AI adoption is 37.5%.\",\"recommendation\":\"Investigate the root cause of the throughput decline—review PR creation rates, capacity constraints, or process changes—and adjust resource allocation or workflow to restore volume.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"-63.6%\",\"trend\":\"negative\"},{\"label\":\"Cycle Time\",\"value\":\"-25.1%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"37.5%\",\"trend\":\"neutral\"},{\"label\":\"Quality\",\"value\":\"0% reverts\",\"trend\":\"positive\"}] }",
          "tokenUsage": {
            "total": 2709,
            "prompt": 1778,
            "completion": 931,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 713
            }
          },
          "cached": false,
          "latencyMs": 1217,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput drop -64%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
              }
            }
          ]
        },
        "id": "dc2c19f1-3797-46b2-8509-969ce0a3565f",
        "latencyMs": 1045,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SmallTeam LLC\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 8 PRs merged\\n- Previous period: 22 PRs merged\\n- Change: -63.6%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.5 hours\\n- Previous period: 24.7 hours\\n- Change: -25.1% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.2 hours\\n- Previous period: 4.8 hours\\n- Change: -33.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 0 (0.0% of merged PRs)\\n- Average review rounds: 1.2\\n- Large PRs (>500 lines): 0.0%\\n\\n## Team Health\\n\\n- Active contributors: 3\\n- Top contributor share: 50.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 2.7\\n- Max reviews by single reviewer: 4\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 3 (37.5% adoption)\\n- Non-AI PRs: 5\\n- AI PR avg cycle time: 16.2 hours\\n- Non-AI PR avg cycle time: 19.9 hours\\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown in throughput: 63.6% decrease in PRs merged, despite improved cycle and review times.\",\n  \"detail\": \"The team merged 8 PRs in the current period, a significant drop from 22 PRs in the previous period, indicating a major delivery issue. However, cycle time decreased by 25.1% to 18.5 hours, and review time decreased by 33.3% to 3.2 hours. AI adoption is at 37.5%, with AI-assisted PRs being 18.6% faster than non-AI PRs.\",\n  \"recommendation\": \"Investigate the root cause of the decreased throughput, focusing on potential process or resource bottlenecks, and explore ways to leverage AI to improve overall team velocity.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"-63.6%\", \"trend\": \"negative\"},\n    {\"label\": \"Cycle Time\", \"value\": \"18.5 hours (-25.1%)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"37.5%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2031,
            "prompt": 1755,
            "completion": 276,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1042,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput drop -64%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
              }
            }
          ]
        },
        "id": "15abdacb-6d72-47f6-bc30-e8a93748848f",
        "latencyMs": 1892,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for SmallTeam LLC\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 8 PRs merged\\n- Previous period: 22 PRs merged\\n- Change: -63.6%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 18.5 hours\\n- Previous period: 24.7 hours\\n- Change: -25.1% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.2 hours\\n- Previous period: 4.8 hours\\n- Change: -33.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 0 (0.0% of merged PRs)\\n- Average review rounds: 1.2\\n- Large PRs (>500 lines): 0.0%\\n\\n## Team Health\\n\\n- Active contributors: 3\\n- Top contributor share: 50.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 2.7\\n- Max reviews by single reviewer: 4\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 3 (37.5% adoption)\\n- Non-AI PRs: 5\\n- AI PR avg cycle time: 16.2 hours\\n- Non-AI PR avg cycle time: 19.9 hours\\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput plunge: PR merges fell 63.6% this month, dropping to 8 from 22.\",\n  \"detail\": \"Cycle time improved 25% (18.5 h vs 24.7 h) and quality stayed perfect with 0% reverts, but the team delivered far fewer changes, a 63.6% decline in merged PRs. AI adoption is modest at 37.5% and makes AI‑assisted PRs 18.6% faster than non‑AI PRs.\",\n  \"recommendation\": \"Conduct a root‑cause analysis of the throughput drop—examine backlog size, PR prioritization, and any process or resource blockers, then adjust staffing or workflow to restore delivery volume.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"-63.6%\", \"trend\": \"negative\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-25.1%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"37.5%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2560,
            "prompt": 1778,
            "completion": 782,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 517
            }
          },
          "cached": false,
          "latencyMs": 1889,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4] Throughput drop -64%",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "P6: Bus factor risk"
              }
            }
          ]
        },
        "id": "5f1ef5b7-c491-4f12-a6c1-f8bb407a1051",
        "latencyMs": 967,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for FocusedTeam Co\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 40 PRs merged\\n- Previous period: 35 PRs merged\\n- Change: +14.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 15.2 hours\\n- Previous period: 16.5 hours\\n- Change: -7.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 3.2 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 1 (2.5% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 7.5%\\n\\n## Team Health\\n\\n- Active contributors: 5\\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\\n- Work concentration: High risk\\n- Avg reviews per reviewer: 8.0\\n- Max reviews by single reviewer: 28\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 10 (25.0% adoption)\\n- Non-AI PRs: 30\\n- AI PR avg cycle time: 13.4 hours\\n- Non-AI PR avg cycle time: 15.8 hours\\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Team dependency risk: One contributor owns 65% of merged PRs, creating a high concentration of work.\", \"detail\":\"With 5 active contributors, 40 PRs merged this month, and a 0% revert rate, the team’s throughput rose 14.3% and cycle time improved 7.9%. However, 65% of PRs are authored by a single member, exposing the team to continuity risk.\", \"recommendation\":\"Implement pair programming and rotate ownership of key components to spread knowledge and reduce reliance on the top contributor.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+14.3%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"-7.9%\",\"trend\":\"positive\"}, {\"label\":\"AI Adoption\",\"value\":\"25%\",\"trend\":\"neutral\"}, {\"label\":\"Quality\",\"value\":\"0% reverts\",\"trend\":\"positive\"} ]}",
          "tokenUsage": {
            "total": 2496,
            "prompt": 1793,
            "completion": 703,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 506
            }
          },
          "cached": false,
          "latencyMs": 965,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6] Bus factor - 65% concentration on team of 5",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "P6: Bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "P6: Bus factor risk"
              }
            }
          ]
        },
        "id": "d6f348f8-4b58-4304-b3a2-c5dede392aef",
        "latencyMs": 1054,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for FocusedTeam Co\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 40 PRs merged\\n- Previous period: 35 PRs merged\\n- Change: +14.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 15.2 hours\\n- Previous period: 16.5 hours\\n- Change: -7.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 3.2 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 1 (2.5% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 7.5%\\n\\n## Team Health\\n\\n- Active contributors: 5\\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\\n- Work concentration: High risk\\n- Avg reviews per reviewer: 8.0\\n- Max reviews by single reviewer: 28\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 10 (25.0% adoption)\\n- Non-AI PRs: 30\\n- AI PR avg cycle time: 13.4 hours\\n- Non-AI PR avg cycle time: 15.8 hours\\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs, posing continuity risk.\",\n  \"detail\": \"With a team size of 5, the top contributor's share of 65% indicates a high concentration of work, creating a bus factor risk. However, the team's overall performance is healthy, with a 14.3% increase in throughput, a 7.9% decrease in cycle time, and zero reverts. AI adoption is at 25%, with AI-assisted PRs being 15.2% faster than non-AI PRs.\",\n  \"recommendation\": \"Distribute ownership through pair programming or code reviews to mitigate the bus factor risk and ensure knowledge sharing among team members.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14.3%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-7.9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2023,
            "prompt": 1770,
            "completion": 253,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1052,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6] Bus factor - 65% concentration on team of 5",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "P6: Bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "P6: Bus factor risk"
              }
            }
          ]
        },
        "id": "58e31798-aa96-451a-8542-30ac238c9aa1",
        "latencyMs": 1828,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for FocusedTeam Co\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 40 PRs merged\\n- Previous period: 35 PRs merged\\n- Change: +14.3%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 15.2 hours\\n- Previous period: 16.5 hours\\n- Change: -7.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 2.8 hours\\n- Previous period: 3.2 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 0 (0.0% of merged PRs)\\n- Hotfixes: 1 (2.5% of merged PRs)\\n- Average review rounds: 1.4\\n- Large PRs (>500 lines): 7.5%\\n\\n## Team Health\\n\\n- Active contributors: 5\\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\\n- Work concentration: High risk\\n- Avg reviews per reviewer: 8.0\\n- Max reviews by single reviewer: 28\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 10 (25.0% adoption)\\n- Non-AI PRs: 30\\n- AI PR avg cycle time: 13.4 hours\\n- Non-AI PR avg cycle time: 15.8 hours\\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs, creating a bus‑factor concern.\",\n  \"detail\": \"With 5 active contributors, the top engineer authored 65% of the 40 merged PRs this month. While quality is excellent (0% reverts) and delivery is improving (throughput +14.3%, cycle time ‑7.9%), the concentration of work poses a continuity risk.\",\n  \"recommendation\": \"Introduce pair‑programming and rotate PR ownership so that no single engineer exceeds 30% of merged PRs within the next quarter.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14.3%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-7.9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2503,
            "prompt": 1793,
            "completion": 710,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 478
            }
          },
          "cached": false,
          "latencyMs": 1823,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6] Bus factor - 65% concentration on team of 5",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "P6: Bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality (P1) beats AI (P2)"
              }
            }
          ]
        },
        "id": "226fe993-98c7-43f4-a373-2227bf049adb",
        "latencyMs": 733,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for ConflictTest Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 90 PRs merged\\n- Previous period: 81 PRs merged\\n- Change: +11.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.4 hours\\n- Previous period: 24.6 hours\\n- Change: -8.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.5 hours\\n- Previous period: 4.0 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 4 (4.4% of merged PRs)\\n- Average review rounds: 1.9\\n- Large PRs (>500 lines): 11.0%\\n\\n## Team Health\\n\\n- Active contributors: 15\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 16\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 41 (45.6% adoption)\\n- Non-AI PRs: 49\\n- AI PR avg cycle time: 20.5 hours\\n- Non-AI PR avg cycle time: 22.8 hours\\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\", \"detail\":\"Despite a 11.1% increase in merged PRs and an 8.9% reduction in cycle time, 12% of merged PRs were reverted, indicating a significant quality issue. AI adoption stands at 45.6% and AI PRs are 10.1% faster than non‑AI PRs.\", \"recommendation\":\"Conduct a root‑cause analysis of the 12 reverted PRs, focusing on review practices, test coverage, and automated checks to reduce reverts.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+11.1%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"-8.9%\",\"trend\":\"positive\"}, {\"label\":\"AI Adoption\",\"value\":\"45.6%\",\"trend\":\"positive\"}, {\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"} ] }",
          "tokenUsage": {
            "total": 2238,
            "prompt": 1788,
            "completion": 450,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 238
            }
          },
          "cached": false,
          "latencyMs": 730,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] Quality 12% beats AI 45% positive",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality (P1) beats AI (P2)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality (P1) beats AI (P2)"
              }
            }
          ]
        },
        "id": "8851d818-c2d8-45dd-913e-46f5668039ae",
        "latencyMs": 1129,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for ConflictTest Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 90 PRs merged\\n- Previous period: 81 PRs merged\\n- Change: +11.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.4 hours\\n- Previous period: 24.6 hours\\n- Change: -8.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.5 hours\\n- Previous period: 4.0 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 4 (4.4% of merged PRs)\\n- Average review rounds: 1.9\\n- Large PRs (>500 lines): 11.0%\\n\\n## Team Health\\n\\n- Active contributors: 15\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 16\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 41 (45.6% adoption)\\n- Non-AI PRs: 49\\n- AI PR avg cycle time: 20.5 hours\\n- Non-AI PR avg cycle time: 22.8 hours\\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite a 11.1% increase in throughput and 45.6% AI adoption, which has resulted in 10.1% faster cycle times for AI-assisted PRs, the 12% revert rate indicates significant quality concerns. The team's velocity and AI adoption are positive trends, but the high revert rate requires immediate attention.\",\n  \"recommendation\": \"Investigate the 12 reverted PRs to identify root causes and implement corrective actions to improve code quality and reduce reverts.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+11.1%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-8.9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45.6%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1999,
            "prompt": 1765,
            "completion": 234,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1125,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] Quality 12% beats AI 45% positive",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality (P1) beats AI (P2)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality (P1) beats AI (P2)"
              }
            }
          ]
        },
        "id": "7f6ce270-4e59-45ee-b4a8-aad0089475bc",
        "latencyMs": 1598,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for ConflictTest Corp\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 90 PRs merged\\n- Previous period: 81 PRs merged\\n- Change: +11.1%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.4 hours\\n- Previous period: 24.6 hours\\n- Change: -8.9% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.5 hours\\n- Previous period: 4.0 hours\\n- Change: -12.5% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 4 (4.4% of merged PRs)\\n- Average review rounds: 1.9\\n- Large PRs (>500 lines): 11.0%\\n\\n## Team Health\\n\\n- Active contributors: 15\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 6.0\\n- Max reviews by single reviewer: 16\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 41 (45.6% adoption)\\n- Non-AI PRs: 49\\n- AI PR avg cycle time: 20.5 hours\\n- Non-AI PR avg cycle time: 22.8 hours\\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of merged PRs were reverted this period, exceeding the 8% safety threshold and risking product stability.\",\n  \"detail\": \"In December, 12 out of 90 merged PRs were reverted (12.0%), while throughput rose 11.1% and cycle time improved 8.9%. Despite faster delivery and 45.6% AI adoption, the high revert rate signals a serious quality problem.\",\n  \"recommendation\": \"Conduct a rapid root‑cause analysis of reverted PRs, prioritize fixing underlying bugs, and tighten pre‑merge testing or review gates.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+11.1%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-8.9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45.6%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2432,
            "prompt": 1788,
            "completion": 644,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 409
            }
          },
          "cached": false,
          "latencyMs": 1594,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] Quality 12% beats AI 45% positive",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality (P1) beats AI (P2)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "9a572b93-523c-470e-821c-95f69411de1c",
        "latencyMs": 1273,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for HealthyTeam Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 54 PRs merged\\n- Previous period: 50 PRs merged\\n- Change: +8.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.0 hours\\n- Previous period: 23.2 hours\\n- Change: -5.2% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.8 hours\\n- Previous period: 4.1 hours\\n- Change: -7.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.9% of merged PRs)\\n- Hotfixes: 1 (1.9% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 5.6%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.4\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 16 (29.6% adoption)\\n- Non-AI PRs: 38\\n- AI PR avg cycle time: 20.4 hours\\n- Non-AI PR avg cycle time: 22.2 hours\\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{ \"headline\":\"Velocity gains: Throughput up 8% and cycle time down 5% while quality remains strong.\", \"detail\":\"In December, HealthyTeam merged 54 PRs, an 8% increase over the previous month, and reduced average cycle time from 23.2 to 22.0 hours (5.2% faster). With a 1.9% revert rate and 29.6% AI adoption, the team is delivering faster without compromising quality.\", \"recommendation\":\"Scale AI-assisted PRs to 40% to sustain cycle time improvements while maintaining quality.\", \"metric_cards\":[ {\"label\":\"Throughput\",\"value\":\"+8%\",\"trend\":\"positive\"}, {\"label\":\"Cycle Time\",\"value\":\"-5.2%\",\"trend\":\"positive\"}, {\"label\":\"AI Adoption\",\"value\":\"29.6%\",\"trend\":\"neutral\"}, {\"label\":\"Quality\",\"value\":\"1.9% reverts\",\"trend\":\"positive\"} ] }",
          "tokenUsage": {
            "total": 2691,
            "prompt": 1778,
            "completion": 913,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 709
            }
          },
          "cached": false,
          "latencyMs": 1270,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All metrics healthy - general summary",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "4c89b38e-e05c-469b-98eb-a0fab9ffb6ee",
        "latencyMs": 1111,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for HealthyTeam Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 54 PRs merged\\n- Previous period: 50 PRs merged\\n- Change: +8.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.0 hours\\n- Previous period: 23.2 hours\\n- Change: -5.2% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.8 hours\\n- Previous period: 4.1 hours\\n- Change: -7.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.9% of merged PRs)\\n- Hotfixes: 1 (1.9% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 5.6%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.4\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 16 (29.6% adoption)\\n- Non-AI PRs: 38\\n- AI PR avg cycle time: 20.4 hours\\n- Non-AI PR avg cycle time: 22.2 hours\\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption shows promise with 8.1% faster cycle time, while team health and quality remain strong.\",\n  \"detail\": \"With 29.6% AI adoption, AI-assisted PRs have a cycle time 8.1% faster than non-AI PRs, averaging 20.4 hours compared to 22.2 hours for non-AI PRs. The team's overall quality is healthy, with a 1.9% revert rate and 1.9% hotfix rate. Throughput has increased by 8.0% to 54 PRs merged, and cycle time has decreased by 5.2% to 22.0 hours.\",\n  \"recommendation\": \"Continue to monitor and expand AI adoption, focusing on integrating AI tools into the development workflow to further improve cycle time and productivity.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+8.0%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"22.0 hours, -5.2%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"29.6%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"1.9% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2042,
            "prompt": 1755,
            "completion": 287,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1109,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All metrics healthy - general summary",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "19788cde-e882-4c2e-82d5-671bbb76d64f",
        "latencyMs": 1809,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"# Identity\\n\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n\\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\\n\\n# Instructions\\n\\n## Task\\n\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline addressing the most critical finding (based on priority rules)\\n2. Detail providing context with specific numbers\\n3. One actionable recommendation\\n4. Four metric cards summarizing key indicators\\n\\n## Priority Rules\\n\\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\\n\\n1. **Quality Crisis**: revert_rate > 8%\\n   - Headline must address: reverts, quality concerns, stability\\n   - Why: Quality problems affect customers and indicate process failures\\n\\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n   - Headline must address: AI tool impact on velocity (positive or negative)\\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\\n   - Headline must address: cycle time increase, delivery delays\\n   - Why: Major slowdowns indicate systemic delivery issues\\n\\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\\n   - Headline must address: throughput increase or decrease\\n   - Why: Significant output changes require investigation\\n\\n5. **Review Bottleneck**: bottleneck_detected = true\\n   - Headline must address: review delays, blocked work\\n   - Why: Bottlenecks slow the entire team\\n\\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\\n   - Headline must address: work concentration, dependency risk\\n   - Why: Heavy reliance on one person creates continuity risk\\n\\n7. **General Summary**: None of the above apply\\n   - Headline must address: Most notable positive or negative trend\\n\\n## Output Format\\n\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on highest priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or %\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\\n\\nCRITICAL OUTPUT RULES:\\n- Start your response with the { character\\n- End your response with the } character\\n- No markdown code fences\\n- No text before or after the JSON\\n\\n# Examples\\n\\n<example id=\\\"quality-crisis\\\">\\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\\n</example>\\n\\n<example id=\\\"bus-factor\\\">\\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\\n</example>\\n\\n<example id=\\\"ai-negative\\\">\\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\\n<output>\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI PRs to understand complexity differences.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n</output>\\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\\n</example>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics Analysis for HealthyTeam Inc\\n\\n## Period: 2024-12-01 to 2024-12-31 (30 days)\\n\\n## Velocity Metrics\\n\\n### Throughput\\n- Current period: 54 PRs merged\\n- Previous period: 50 PRs merged\\n- Change: +8.0%\\n\\n### Cycle Time (hours from PR open to merge)\\n- Current period: 22.0 hours\\n- Previous period: 23.2 hours\\n- Change: -5.2% (negative = faster)\\n\\n### Review Time (hours to first review)\\n- Current period: 3.8 hours\\n- Previous period: 4.1 hours\\n- Change: -7.3% (negative = faster)\\n\\n## Quality Metrics\\n\\n- Reverts: 1 (1.9% of merged PRs)\\n- Hotfixes: 1 (1.9% of merged PRs)\\n- Average review rounds: 1.5\\n- Large PRs (>500 lines): 5.6%\\n\\n## Team Health\\n\\n- Active contributors: 10\\n- Top contributor share: 18.0% of PRs\\n- Work concentration: Healthy distribution\\n- Avg reviews per reviewer: 5.4\\n- Max reviews by single reviewer: 12\\n- No review bottleneck detected\\n\\n## AI Impact\\n\\n- AI-assisted PRs: 16 (29.6% adoption)\\n- Non-AI PRs: 38\\n- AI PR avg cycle time: 20.4 hours\\n- Non-AI PR avg cycle time: 22.2 hours\\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\\n\\n---\\n\\nAnalyze these metrics and provide your insight.\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"HealthyTeam shows strong efficiency gains: cycle time down 5%, throughput up 8%, and AI‑assisted PRs 8% faster.\",\n  \"detail\": \"In December the team merged 54 PRs (+8% vs prior month) while reducing average cycle time to 22.0 h (‑5.2%). AI‑assisted changes (29.6% adoption) run 8.1% faster than non‑AI PRs, and the revert rate remains low at 1.9%. All indicators point to improved speed without sacrificing quality.\",\n  \"recommendation\": \"Scale AI assistance to at least 40% of PRs to capture further cycle‑time reductions while monitoring quality metrics.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"54 PRs (+8%)\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"22.0 h (‑5.2%)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"29.6%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.9% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2535,
            "prompt": 1778,
            "completion": 757,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 485
            }
          },
          "cached": false,
          "latencyMs": 1806,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All metrics healthy - general summary",
          "vars": {
            "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
            "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>",
          "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      }
    ],
    "stats": {
      "successes": 30,
      "failures": 0,
      "errors": 0,
      "tokenUsage": {
        "prompt": 53265,
        "completion": 16956,
        "cached": 0,
        "total": 70221,
        "numRequests": 30,
        "completionDetails": {
          "reasoning": 9733,
          "acceptedPrediction": 0,
          "rejectedPrediction": 0
        },
        "assertions": {
          "total": 0,
          "prompt": 0,
          "completion": 0,
          "cached": 0,
          "numRequests": 0,
          "completionDetails": {
            "reasoning": 0,
            "acceptedPrediction": 0,
            "rejectedPrediction": 0
          }
        }
      },
      "durationMs": 13463
    }
  },
  "config": {
    "tags": {},
    "description": "Dashboard Insight v3.0 (OpenAI + Anthropic Best Practices)",
    "prompts": [
      {
        "id": "v3.0-openai-structure",
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
      }
    ],
    "providers": [
      {
        "id": "groq:openai/gpt-oss-20b",
        "label": "GPT-OSS-20B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      },
      {
        "id": "groq:openai/gpt-oss-120b",
        "label": "GPT-OSS-120B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      },
      {
        "id": "groq:llama-3.3-70b-versatile",
        "label": "Llama-3.3-70B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      }
    ],
    "tests": [
      {
        "description": "[P1] Quality crisis 12% reverts - must address quality",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for Acme Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 100 PRs merged\n- Previous period: 83 PRs merged\n- Change: +20.5%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 28.5 hours\n- Previous period: 29.2 hours\n- Change: -2.4% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 4.2 hours\n- Previous period: 4.8 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 3 (3.0% of merged PRs)\n- Average review rounds: 1.8\n- Large PRs (>500 lines): 8.0%\n\n## Team Health\n\n- Active contributors: 8\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 12.5\n- Max reviews by single reviewer: 22\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 45 (45.0% adoption)\n- Non-AI PRs: 55\n- AI PR avg cycle time: 25.6 hours\n- Non-AI PR avg cycle time: 28.5 hours\n- AI HELPS: AI PRs are 10.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
            "description": "Valid JSON structure with 4 metric cards"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
            "description": "P1: Headline addresses quality"
          }
        ]
      },
      {
        "description": "[P1] Quality crisis 9% reverts",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for Beta Inc\n\n## Period: 2024-11-15 to 2024-12-15 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 45 PRs merged\n- Previous period: 44 PRs merged\n- Change: +2.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.2 hours\n- Previous period: 21.4 hours\n- Change: -15.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.1 hours\n- Previous period: 3.8 hours\n- Change: -18.4% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 1 (2.2% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 6.7%\n\n## Team Health\n\n- Active contributors: 6\n- Top contributor share: 25.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 7.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 14 (31.1% adoption)\n- Non-AI PRs: 31\n- AI PR avg cycle time: 17.8 hours\n- Non-AI PR avg cycle time: 18.4 hours\n- AI HELPS: AI PRs are 3.3% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9'); })()"
          }
        ]
      },
      {
        "description": "[P2] AI positive - 70% adoption, 46% faster",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for TechStartup\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 78 PRs merged\n- Previous period: 68 PRs merged\n- Change: +14.7%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 16.2 hours\n- Previous period: 25.3 hours\n- Change: -36.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 4.1 hours\n- Change: -31.7% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.3% of merged PRs)\n- Hotfixes: 2 (2.6% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 5.1%\n\n## Team Health\n\n- Active contributors: 12\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 15\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 55 (70.5% adoption)\n- Non-AI PRs: 23\n- AI PR avg cycle time: 12.4 hours\n- Non-AI PR avg cycle time: 23.0 hours\n- AI HELPS: AI PRs are 46.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
            "description": "P2: AI positive impact"
          }
        ]
      },
      {
        "description": "[P2] AI negative - 70% adoption, 100% slower",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for SlowCorp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 60 PRs merged\n- Previous period: 55 PRs merged\n- Change: +9.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 40.5 hours\n- Previous period: 30.5 hours\n- Change: +32.8% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 8.2 hours\n- Previous period: 6.5 hours\n- Change: +26.2% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 3 (5.0% of merged PRs)\n- Hotfixes: 2 (3.3% of merged PRs)\n- Average review rounds: 2.1\n- Large PRs (>500 lines): 12.0%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 22.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 42 (70.0% adoption)\n- Non-AI PRs: 18\n- AI PR avg cycle time: 48.0 hours\n- Non-AI PR avg cycle time: 24.0 hours\n- AI HURTS: AI PRs are 100.0% SLOWER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
            "description": "P2: AI negative impact"
          }
        ]
      },
      {
        "description": "[P3] Severe slowdown - 136% cycle time increase",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for BigTech Enterprise\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 125 PRs merged\n- Previous period: 100 PRs merged\n- Change: +25.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 169.2 hours\n- Previous period: 71.7 hours\n- Change: +136.0% (negative = faster) [SEVERE SLOWDOWN]\n\n### Review Time (hours to first review)\n- Current period: 32.5 hours\n- Previous period: 12.8 hours\n- Change: +153.9% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (0.8% of merged PRs)\n- Hotfixes: 2 (1.6% of merged PRs)\n- Average review rounds: 2.8\n- Large PRs (>500 lines): 18.0%\n\n## Team Health\n\n- Active contributors: 25\n- Top contributor share: 17.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.0\n- Max reviews by single reviewer: 18\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 43 (34.4% adoption)\n- Non-AI PRs: 82\n- AI PR avg cycle time: 155.0 hours\n- Non-AI PR avg cycle time: 176.5 hours\n- AI HELPS: AI PRs are 12.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('delay'); })()",
            "description": "P3: Addresses slowdown"
          }
        ]
      },
      {
        "description": "[P4] Throughput surge +60%",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for RocketShip Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 72 PRs merged\n- Previous period: 45 PRs merged\n- Change: +60.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 12.8 hours\n- Previous period: 29.8 hours\n- Change: -57.0% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.1 hours\n- Previous period: 5.2 hours\n- Change: -59.6% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 2 (2.8% of merged PRs)\n- Hotfixes: 1 (1.4% of merged PRs)\n- Average review rounds: 1.3\n- Large PRs (>500 lines): 4.2%\n\n## Team Health\n\n- Active contributors: 11\n- Top contributor share: 20.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.5\n- Max reviews by single reviewer: 14\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 30 (41.7% adoption)\n- Non-AI PRs: 42\n- AI PR avg cycle time: 10.8 hours\n- Non-AI PR avg cycle time: 14.0 hours\n- AI HELPS: AI PRs are 22.9% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('ai'); })()"
          }
        ]
      },
      {
        "description": "[P4] Throughput drop -64%",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for SmallTeam LLC\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 8 PRs merged\n- Previous period: 22 PRs merged\n- Change: -63.6%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 18.5 hours\n- Previous period: 24.7 hours\n- Change: -25.1% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.2 hours\n- Previous period: 4.8 hours\n- Change: -33.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 0 (0.0% of merged PRs)\n- Average review rounds: 1.2\n- Large PRs (>500 lines): 0.0%\n\n## Team Health\n\n- Active contributors: 3\n- Top contributor share: 50.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 2.7\n- Max reviews by single reviewer: 4\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 3 (37.5% adoption)\n- Non-AI PRs: 5\n- AI PR avg cycle time: 16.2 hours\n- Non-AI PR avg cycle time: 19.9 hours\n- AI HELPS: AI PRs are 18.6% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decline'); })()"
          }
        ]
      },
      {
        "description": "[P6] Bus factor - 65% concentration on team of 5",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for FocusedTeam Co\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 40 PRs merged\n- Previous period: 35 PRs merged\n- Change: +14.3%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 15.2 hours\n- Previous period: 16.5 hours\n- Change: -7.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 2.8 hours\n- Previous period: 3.2 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 0 (0.0% of merged PRs)\n- Hotfixes: 1 (2.5% of merged PRs)\n- Average review rounds: 1.4\n- Large PRs (>500 lines): 7.5%\n\n## Team Health\n\n- Active contributors: 5\n- Top contributor share: 65.0% of PRs [BUS FACTOR RISK: >50% on team >3]\n- Work concentration: High risk\n- Avg reviews per reviewer: 8.0\n- Max reviews by single reviewer: 28\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 10 (25.0% adoption)\n- Non-AI PRs: 30\n- AI PR avg cycle time: 13.4 hours\n- Non-AI PR avg cycle time: 15.8 hours\n- AI HELPS: AI PRs are 15.2% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
            "description": "P6: Bus factor risk"
          }
        ]
      },
      {
        "description": "[CONFLICT] Quality 12% beats AI 45% positive",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for ConflictTest Corp\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 90 PRs merged\n- Previous period: 81 PRs merged\n- Change: +11.1%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.4 hours\n- Previous period: 24.6 hours\n- Change: -8.9% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.5 hours\n- Previous period: 4.0 hours\n- Change: -12.5% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 4 (4.4% of merged PRs)\n- Average review rounds: 1.9\n- Large PRs (>500 lines): 11.0%\n\n## Team Health\n\n- Active contributors: 15\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 6.0\n- Max reviews by single reviewer: 16\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 41 (45.6% adoption)\n- Non-AI PRs: 49\n- AI PR avg cycle time: 20.5 hours\n- Non-AI PR avg cycle time: 22.8 hours\n- AI HELPS: AI PRs are 10.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
            "description": "Quality (P1) beats AI (P2)"
          }
        ]
      },
      {
        "description": "[EDGE] All metrics healthy - general summary",
        "vars": {
          "user_prompt": "# Engineering Metrics Analysis for HealthyTeam Inc\n\n## Period: 2024-12-01 to 2024-12-31 (30 days)\n\n## Velocity Metrics\n\n### Throughput\n- Current period: 54 PRs merged\n- Previous period: 50 PRs merged\n- Change: +8.0%\n\n### Cycle Time (hours from PR open to merge)\n- Current period: 22.0 hours\n- Previous period: 23.2 hours\n- Change: -5.2% (negative = faster)\n\n### Review Time (hours to first review)\n- Current period: 3.8 hours\n- Previous period: 4.1 hours\n- Change: -7.3% (negative = faster)\n\n## Quality Metrics\n\n- Reverts: 1 (1.9% of merged PRs)\n- Hotfixes: 1 (1.9% of merged PRs)\n- Average review rounds: 1.5\n- Large PRs (>500 lines): 5.6%\n\n## Team Health\n\n- Active contributors: 10\n- Top contributor share: 18.0% of PRs\n- Work concentration: Healthy distribution\n- Avg reviews per reviewer: 5.4\n- Max reviews by single reviewer: 12\n- No review bottleneck detected\n\n## AI Impact\n\n- AI-assisted PRs: 16 (29.6% adoption)\n- Non-AI PRs: 38\n- AI PR avg cycle time: 20.4 hours\n- Non-AI PR avg cycle time: 22.2 hours\n- AI HELPS: AI PRs are 8.1% FASTER than non-AI PRs\n\n---\n\nAnalyze these metrics and provide your insight."
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
            "description": "Valid response with 4 metric cards"
          }
        ]
      }
    ],
    "scenarios": [],
    "env": {},
    "defaultTest": {
      "vars": {
        "system_prompt": "# Identity\n\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n\nYour goal is to surface the single most important insight from the metrics data and provide an actionable recommendation.\n\n# Instructions\n\n## Task\n\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline addressing the most critical finding (based on priority rules)\n2. Detail providing context with specific numbers\n3. One actionable recommendation\n4. Four metric cards summarizing key indicators\n\n## Priority Rules\n\nCheck these conditions IN ORDER. Use the FIRST that matches, then STOP.\n\n1. **Quality Crisis**: revert_rate > 8%\n   - Headline must address: reverts, quality concerns, stability\n   - Why: Quality problems affect customers and indicate process failures\n\n2. **AI Impact (significant)**: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n   - Headline must address: AI tool impact on velocity (positive or negative)\n   - Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\n3. **Severe Slowdown**: cycle_time_pct_change > 50%\n   - Headline must address: cycle time increase, delivery delays\n   - Why: Major slowdowns indicate systemic delivery issues\n\n4. **Major Throughput Change**: |throughput_pct_change| > 30%\n   - Headline must address: throughput increase or decrease\n   - Why: Significant output changes require investigation\n\n5. **Review Bottleneck**: bottleneck_detected = true\n   - Headline must address: review delays, blocked work\n   - Why: Bottlenecks slow the entire team\n\n6. **Bus Factor Risk**: team_size > 3 AND top_contributor_pct > 50%\n   - Headline must address: work concentration, dependency risk\n   - Why: Heavy reliance on one person creates continuity risk\n\n7. **General Summary**: None of the above apply\n   - Headline must address: Most notable positive or negative trend\n\n## Output Format\n\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on highest priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or %\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings: positive=good, negative=bad, neutral=stable, warning=needs attention\n\nCRITICAL OUTPUT RULES:\n- Start your response with the { character\n- End your response with the } character\n- No markdown code fences\n- No text before or after the JSON\n\n# Examples\n\n<example id=\"quality-crisis\">\n<input>revert_rate: 12%, ai_adoption: 45%, ai_cycle_diff: -10%, throughput: +20%</input>\n<output>\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption, the 12% revert rate indicates quality issues.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Quality crisis (12% > 8%) takes priority over AI benefits.</reasoning>\n</example>\n\n<example id=\"bus-factor\">\n<input>team_size: 5, top_contributor: 65%, revert_rate: 2%, ai_adoption: 25%</input>\n<output>\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk. Quality healthy at 2% reverts.\",\n  \"recommendation\": \"Distribute ownership through pair programming.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n</output>\n<reasoning>Bus factor (65% > 50%, team > 3) applies. AI below threshold.</reasoning>\n</example>\n\n<example id=\"ai-negative\">\n<input>revert_rate: 3%, ai_adoption: 55%, ai_cycle_diff: +100%</input>\n<output>\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs take 100% longer than non-AI PRs.\",\n  \"detail\": \"At 55% AI adoption, AI PRs average 48h vs 24h for non-AI PRs.\",\n  \"recommendation\": \"Analyze AI PRs to understand complexity differences.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n</output>\n<reasoning>AI impact significant (55% > 40%, 100% > 25%). Quality fine.</reasoning>\n</example>"
      },
      "options": {
        "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
      },
      "assert": [],
      "metadata": {}
    },
    "outputPath": [
      "./results/insight-promptfoo-v3-results.json"
    ],
    "extensions": [],
    "metadata": {},
    "evaluateOptions": {
      "maxConcurrency": 3,
      "showProgressBar": true
    }
  },
  "shareableUrl": null,
  "metadata": {
    "promptfooVersion": "0.120.8",
    "nodeVersion": "v22.17.1",
    "platform": "darwin",
    "arch": "arm64",
    "exportedAt": "2025-12-31T19:36:02.478Z",
    "evaluationCreatedAt": "2025-12-31T19:35:48.127Z"
  }
}