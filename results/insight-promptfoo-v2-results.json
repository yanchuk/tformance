{
  "evalId": "eval-94K-2025-12-31T19:04:09",
  "results": {
    "version": 3,
    "timestamp": "2025-12-31T19:04:09.974Z",
    "prompts": [
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "GPT-OSS-20B",
        "metrics": {
          "score": 9.666666666666666,
          "testPassCount": 9,
          "testFailCount": 1,
          "testErrorCount": 0,
          "assertPassCount": 21,
          "assertFailCount": 1,
          "totalLatencyMs": 9963,
          "tokenUsage": {
            "prompt": 17206,
            "completion": 7302,
            "cached": 0,
            "total": 24508,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 5222,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      },
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "GPT-OSS-120B",
        "metrics": {
          "score": 8.666666666666666,
          "testPassCount": 8,
          "testFailCount": 2,
          "testErrorCount": 0,
          "assertPassCount": 19,
          "assertFailCount": 3,
          "totalLatencyMs": 16255,
          "tokenUsage": {
            "prompt": 17206,
            "completion": 6022,
            "cached": 0,
            "total": 23228,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 3661,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      },
      {
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]",
        "id": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "provider": "Llama-3.3-70B",
        "metrics": {
          "score": 9.666666666666666,
          "testPassCount": 9,
          "testFailCount": 1,
          "testErrorCount": 0,
          "assertPassCount": 21,
          "assertFailCount": 1,
          "totalLatencyMs": 9003,
          "tokenUsage": {
            "prompt": 16984,
            "completion": 2446,
            "cached": 0,
            "total": 19430,
            "numRequests": 10,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 0,
              "prompt": 0,
              "completion": 0,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      }
    ],
    "results": [
      {
        "cost": 0,
        "error": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
        "gradingResult": {
          "pass": false,
          "score": 0.6666666666666666,
          "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": false,
              "score": 0,
              "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
                "description": "Has all required fields"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
                "description": "Headline addresses quality crisis (P1)"
              }
            }
          ]
        },
        "id": "342c74b2-08e2-4dd5-8a2a-f493413e9791",
        "latencyMs": 733,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics for Team Alpha\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +20% (100 PRs merged)\\n- Cycle Time: stable\\n\\n## Team Health\\n- Active contributors: 8\\n- Top contributor: 18% of PRs\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% faster than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\"detail\":\"Despite a 20% increase in throughput and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\"recommendation\":\"Investigate reverted PRs for root causes and consider adding preâ€‘merge testing requirements.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]}",
          "tokenUsage": {
            "total": 2205,
            "prompt": 1732,
            "completion": 473,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 322
            }
          },
          "cached": false,
          "latencyMs": 727,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 0.6666666666666666,
        "success": false,
        "testCase": {
          "description": "[P1-quality] 12% reverts should trigger quality crisis (ignore AI benefits)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "description": "Has all required fields"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
              "description": "Headline addresses quality crisis (P1)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 1
      },
      {
        "cost": 0,
        "error": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
        "gradingResult": {
          "pass": false,
          "score": 0.6666666666666666,
          "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": false,
              "score": 0,
              "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
                "description": "Has all required fields"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
                "description": "Headline addresses quality crisis (P1)"
              }
            }
          ]
        },
        "id": "e6bcbbca-505f-4e11-ae64-2f502b49d0aa",
        "latencyMs": 927,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics for Team Alpha\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +20% (100 PRs merged)\\n- Cycle Time: stable\\n\\n## Team Health\\n- Active contributors: 8\\n- Top contributor: 18% of PRs\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% faster than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times for AI PRs, the 12% revert rate indicates quality issues requiring immediate attention. The team has a healthy distribution of contributions, with the top contributor owning 18% of PRs. Quality remains the top priority due to the high revert rate.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements or code review checklists to improve quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1939,
            "prompt": 1710,
            "completion": 229,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 921,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 0.6666666666666666,
        "success": false,
        "testCase": {
          "description": "[P1-quality] 12% reverts should trigger quality crisis (ignore AI benefits)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "description": "Has all required fields"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
              "description": "Headline addresses quality crisis (P1)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 1
      },
      {
        "cost": 0,
        "error": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
        "gradingResult": {
          "pass": false,
          "score": 0.6666666666666666,
          "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": false,
              "score": 0,
              "reason": "Custom function threw error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\nStack Trace: Error: Custom function must return a boolean, number, or GradingResult object. Got type object: [{\"label\":\"Throughput\",\"value\":\"+20%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"AI Adoption\",\"value\":\"45%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"12% reverts\",\"trend\":\"warning\"}]\n    at validateResult (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1295:13)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:13)\n    at async runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:18)\n    at async file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:18\n(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
                "description": "Has all required fields"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
                "description": "Headline addresses quality crisis (P1)"
              }
            }
          ]
        },
        "id": "5d67930f-2c36-4c60-8979-34dc6cfa49e9",
        "latencyMs": 1151,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics for Team Alpha\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +20% (100 PRs merged)\\n- Cycle Time: stable\\n\\n## Team Health\\n- Active contributors: 8\\n- Top contributor: 18% of PRs\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% faster than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Team Alpha merged 100 PRs (+20% throughput) and maintained stable cycle times, with AI adoption at 45% delivering 10% faster cycles. However, a 12% revert rate signals a serious quality problem that could impact stability and customer experience.\",\n  \"recommendation\": \"Conduct a rootâ€‘cause analysis of reverted PRs and introduce stricter preâ€‘merge testing or automated quality gates.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2147,
            "prompt": 1732,
            "completion": 415,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 201
            }
          },
          "cached": false,
          "latencyMs": 1145,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 0.6666666666666666,
        "success": false,
        "testCase": {
          "description": "[P1-quality] 12% reverts should trigger quality crisis (ignore AI benefits)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
              "description": "Has all required fields"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
              "description": "Headline addresses quality crisis (P1)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 1
      },
      {
        "cost": 0,
        "error": "Custom function threw error: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\nStack Trace: SyntaxError: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\n    at JSON.parse (<anonymous>)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:32)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:146)\n    at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:92)\n    at runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:24)\n    at file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:24\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:151:38\n    at replenish (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:447:21)\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:452:13\n    at Object.eachOfLimit (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:478:36)\n(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
        "gradingResult": {
          "pass": false,
          "score": 0,
          "reason": "Custom function threw error: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\nStack Trace: SyntaxError: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\n    at JSON.parse (<anonymous>)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:32)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:146)\n    at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:92)\n    at runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:24)\n    at file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:24\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:151:38\n    at replenish (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:447:21)\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:452:13\n    at Object.eachOfLimit (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:478:36)\n(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": false,
              "score": 0,
              "reason": "Expected output to be valid JSON",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": false,
              "score": 0,
              "reason": "Custom function threw error: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\nStack Trace: SyntaxError: Unexpected non-whitespace character after JSON at position 336 (line 13 column 1)\n    at JSON.parse (<anonymous>)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:32)\n    at eval (eval at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:34), <anonymous>:3:146)\n    at handleJavascript (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:1327:92)\n    at runAssertion (file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2741:24)\n    at file:///Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/promptfoo/dist/src/evaluator-DUa6jTyI.js:2784:24\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:151:38\n    at replenish (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:447:21)\n    at /Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:452:13\n    at Object.eachOfLimit (/Users/yanchuk/.npm/_npx/1ddbeaccabfe00a4/node_modules/async/dist/async.js:478:36)\n(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
                "description": "Headline addresses quality (9% > 8%)"
              }
            }
          ]
        },
        "id": "c0b7f69a-4bbc-46a8-a55f-35b0a655b48d",
        "latencyMs": 1514,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n\\n## Velocity\\n- Throughput: stable\\n- Cycle Time: -15% (faster)\\n\\n## Team Health\\n- Active contributors: 6\\n- Top contributor: 25%\\n\\n## AI Impact\\n- AI adoption: 30%\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n \"headline\": \"...\",\n \"detail\": \"...\",\n \"recommendation\": \"...\",\n \"metric_cards\": [\n   {\"label\":\"Throughput\",\"value\":\"stable\",\"trend\":\"neutral\"},\n   {\"label\":\"Cycle Time\",\"value\":\"-15%\",\"trend\":\"positive\"},\n   {\"label\":\"AI Adoption\",\"value\":\"30%\",\"trend\":\"neutral\"},\n   {\"label\":\"Quality\",\"value\":\"9% reverts\",\"trend\":\"warning\"}\n ]\n}\n\nCheck length: fine.\n\nReturn only JSON.\n\n{\n  \"headline\": \"Quality alert: 9% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Revert rate rose to 9%, triggering a quality warning despite stable throughput and a 15% faster cycle time. AI adoption sits at 30% and the top contributor accounts for only 25% of work, so the issue is not workload concentration but code stability.\",\n  \"recommendation\": \"Conduct a rootâ€‘cause analysis of reverted PRs and introduce stricter preâ€‘merge testing or review gates to catch defects early.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-15%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"30%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"9% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2267,
            "prompt": 1698,
            "completion": 569,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 350
            }
          },
          "cached": false,
          "latencyMs": 1509,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 0,
        "success": false,
        "testCase": {
          "description": "[P1-quality] 9% reverts should trigger quality crisis",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
              "description": "Headline addresses quality (9% > 8%)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 1
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
                "description": "Headline addresses quality (9% > 8%)"
              }
            }
          ]
        },
        "id": "5714d724-8638-45a9-855d-a475d6226f30",
        "latencyMs": 960,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n\\n## Velocity\\n- Throughput: stable\\n- Cycle Time: -15% (faster)\\n\\n## Team Health\\n- Active contributors: 6\\n- Top contributor: 25%\\n\\n## AI Impact\\n- AI adoption: 30%\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Quality alert: 9% of PRs were reverted this period, exceeding the 8% threshold.\",\"detail\":\"The team delivered a stable throughput while cutting cycle time by 15%. However, the 9% revert rate indicates a quality issue that could impact customer experience. AI adoption remains low at 30%, so the focus should be on process improvements.\",\"recommendation\":\"Conduct a rootâ€‘cause analysis of the reverted PRs and enforce stricter preâ€‘merge testing or code review standards.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"stable\",\"trend\":\"neutral\"},{\"label\":\"Cycle Time\",\"value\":\"-15%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"30%\",\"trend\":\"neutral\"},{\"label\":\"Quality\",\"value\":\"9% reverts\",\"trend\":\"warning\"}]}",
          "tokenUsage": {
            "total": 2321,
            "prompt": 1698,
            "completion": 623,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 450
            }
          },
          "cached": false,
          "latencyMs": 956,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1-quality] 9% reverts should trigger quality crisis",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
              "description": "Headline addresses quality (9% > 8%)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
                "description": "Headline addresses quality (9% > 8%)"
              }
            }
          ]
        },
        "id": "02bc7d89-f556-4357-8810-019bef267704",
        "latencyMs": 814,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n\\n## Velocity\\n- Throughput: stable\\n- Cycle Time: -15% (faster)\\n\\n## Team Health\\n- Active contributors: 6\\n- Top contributor: 25%\\n\\n## AI Impact\\n- AI adoption: 30%\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 9% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite a 15% reduction in cycle time and stable throughput, the 9% revert rate indicates quality issues requiring immediate attention. The team has a healthy distribution of work with the top contributor owning 25% of the work. AI adoption is at 30%, but its impact does not currently meet the threshold for significant concern.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements or code review checks to improve quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-15%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"30%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"9% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1900,
            "prompt": 1676,
            "completion": 224,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 811,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P1-quality] 9% reverts should trigger quality crisis",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
              "description": "Headline addresses quality (9% > 8%)"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "Headline highlights positive AI impact"
              }
            }
          ]
        },
        "id": "48b3bb54-e788-4a6f-b831-1a723c37febb",
        "latencyMs": 1219,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.3% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (80 PRs)\\n- Cycle Time: -36% (18 hours, was 28)\\n\\n## Team Health\\n- Active contributors: 12\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption drives speed: 70% of PRs use AI and are 46% faster, boosting throughput by 14%.\",\n  \"detail\": \"With 70% AI adoption, AI-assisted PRs average 14 hours versus 26 hours for non-AI, a 46% reduction in cycle time. Throughput rose 14% to 80 PRs, and overall cycle time fell 36% to 18 hours. Quality remains healthy with only 1.3% reverts.\",\n  \"recommendation\": \"Roll out AI-assisted workflows to the remaining 30% of PRs, providing targeted training and guidelines to sustain the 46% speed advantage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-36%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.3% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2681,
            "prompt": 1720,
            "completion": 961,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 715
            }
          },
          "cached": false,
          "latencyMs": 1215,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-positive] High AI adoption (70%) with 46% faster cycle time",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "Headline highlights positive AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "Headline highlights positive AI impact"
              }
            }
          ]
        },
        "id": "f828b623-bb3f-44a7-9bc8-997aa6c74843",
        "latencyMs": 949,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.3% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (80 PRs)\\n- Cycle Time: -36% (18 hours, was 28)\\n\\n## Team Health\\n- Active contributors: 12\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption drives 46% faster cycle times with 70% adoption, while quality and team health remain stable.\",\n  \"detail\": \"The team has seen a significant increase in AI adoption at 70%, which has resulted in 46% faster cycle times for AI-assisted PRs compared to non-AI PRs. Quality remains healthy with a 1.3% revert rate, and team health is stable with the top contributor owning 20% of the work. Throughput has also increased by 14% with 80 PRs merged.\",\n  \"recommendation\": \"Continue to monitor AI adoption and its impact on cycle times, and consider expanding AI tool usage to other areas of the development process.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-36%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.3% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1946,
            "prompt": 1698,
            "completion": 248,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 946,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-positive] High AI adoption (70%) with 46% faster cycle time",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "Headline highlights positive AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
                "description": "Headline highlights positive AI impact"
              }
            }
          ]
        },
        "id": "0c4a2ac6-f2d2-4e78-a2aa-7267337a8ce3",
        "latencyMs": 1452,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.3% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (80 PRs)\\n- Cycle Time: -36% (18 hours, was 28)\\n\\n## Team Health\\n- Active contributors: 12\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption boost: 70% of PRs now use AI, delivering 46% faster cycle times and accelerating overall velocity.\",\n  \"detail\": \"With AI tools applied to 70% of work, AIâ€‘assisted PRs close in 14â€¯h versus 26â€¯h for nonâ€‘AI, driving a 46% speed gain. Overall cycle time fell 36% to 18â€¯h and throughput rose 14% to 80 PRs, while revert rate remains low at 1.3%.\",\n  \"recommendation\": \"Formalize AI bestâ€‘practice guidelines and provide targeted training to expand the fastâ€‘track AI workflow across the team.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-36% (18h)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"1.3% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2303,
            "prompt": 1720,
            "completion": 583,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 334
            }
          },
          "cached": false,
          "latencyMs": 1449,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-positive] High AI adoption (70%) with 46% faster cycle time",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
              "description": "Headline highlights positive AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 2,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "Headline flags AI negative impact"
              }
            }
          ]
        },
        "id": "e53fb5df-e067-4c0d-b8b5-45891a2dd152",
        "latencyMs": 704,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 3 (5.0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +9% (60 PRs)\\n- Cycle Time: +33% (40 hours, was 30)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 22%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\\n- AI HURTS: AI PRs take TWICE as long\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 70% adoption, indicating potential process inefficiencies.\",\n  \"detail\": \"With 70% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs, suggesting AI tools may be used for more complex work or require process adjustment. Quality remains healthy at 5% reverts, and throughput increased by 9%. However, cycle time increased by 33% to 40 hours.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage to mitigate the negative impact on cycle time.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+9%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+33%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1963,
            "prompt": 1712,
            "completion": 251,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 702,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-negative] High AI adoption (70%) but AI PRs 100% slower",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "Headline flags AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "Headline flags AI negative impact"
              }
            }
          ]
        },
        "id": "5a5e12db-2bf2-4fab-8b17-0b9a325aaeed",
        "latencyMs": 1283,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 3 (5.0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +9% (60 PRs)\\n- Cycle Time: +33% (40 hours, was 30)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 22%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\\n- AI HURTS: AI PRs take TWICE as long\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 70% adoption.\",\n  \"detail\": \"In the last 30 days, 70% of PRs were AI-assisted, yet they averaged 48 hours versus 24 hours for non-AI PRs, doubling the cycle time. Overall cycle time rose 33% to 40 hours, while throughput grew modestly by 9% to 60 PRs. Revert rate remains healthy at 5%.\",\n  \"recommendation\": \"Conduct a focused review of AI-assisted PRs to identify complexity or process gaps, and roll out targeted training or workflow adjustments to reduce their cycle time.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+9%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+33%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2756,
            "prompt": 1735,
            "completion": 1021,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 772
            }
          },
          "cached": false,
          "latencyMs": 1279,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-negative] High AI adoption (70%) but AI PRs 100% slower",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "Headline flags AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
                "description": "Headline flags AI negative impact"
              }
            }
          ]
        },
        "id": "67b5ad49-0739-4d36-a1b0-b04f1c4e3825",
        "latencyMs": 1691,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 3 (5.0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +9% (60 PRs)\\n- Cycle Time: +33% (40 hours, was 30)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 22%\\n\\n## AI Impact\\n- AI adoption: 70%\\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\\n- AI HURTS: AI PRs take TWICE as long\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"AI adoption concern: 70% of PRs use AI, yet AI-assisted changes are taking twice as long, slowing overall cycle time.\",\n  \"detail\": \"While throughput rose 9% to 60 PRs, average cycle time jumped 33% to 40â€¯hours (up from 30â€¯h). AIâ€‘assisted PRs average 48â€¯h versus 24â€¯h for nonâ€‘AI, a 100% slowdown despite 70% adoption. Quality remains acceptable at a 5% revert rate.\",\n  \"recommendation\": \"Conduct a focused analysis of AIâ€‘assisted PRs to identify complexity or workflow issues, and pilot targeted AI usage guidelines or training to reduce cycle time.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+9%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+33% (40h)\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"70%\", \"trend\": \"warning\"},\n    {\"label\": \"Quality\", \"value\": \"5% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2427,
            "prompt": 1735,
            "completion": 692,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 437
            }
          },
          "cached": false,
          "latencyMs": 1688,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P2-ai-negative] High AI adoption (70%) but AI PRs 100% slower",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
              "description": "Headline flags AI negative impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 3,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
                "description": "Headline addresses severe slowdown"
              }
            }
          ]
        },
        "id": "13534c41-1c87-4611-8e94-35f1954292f1",
        "latencyMs": 1044,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (0.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +25% (123 PRs)\\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\\n- Review Time: +227% (72h, was 22h)\\n\\n## Team Health\\n- Active contributors: 25\\n- Top contributor: 17%\\n\\n## AI Impact\\n- AI adoption: 34%\\n- AI PRs: 47% SLOWER than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown: Cycle time has surged 136% over the last 30 days, pushing average PR completion to 169 hours.\",\n  \"detail\": \"During the period, throughput grew 25% to 123 PRs, but cycle time jumped from 72 to 169 hours and review time spiked 227%. AI adoption sits at 34% yet AI PRs are slower than nonâ€‘AI. Quality remains healthy with only 0.8% reverts.\",\n  \"recommendation\": \"Introduce a structured review workflow with automated linting, preâ€‘merge checks, and parallel review queues to cut review time by at least 50% within the next month.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+25%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+136%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"34%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2487,
            "prompt": 1738,
            "completion": 749,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 504
            }
          },
          "cached": false,
          "latencyMs": 1041,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3-slowdown] 136% cycle time increase (no quality issues)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
              "description": "Headline addresses severe slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
                "description": "Headline addresses severe slowdown"
              }
            }
          ]
        },
        "id": "cd369513-6b50-4b39-ba51-3f3c409875d0",
        "latencyMs": 1782,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (0.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +25% (123 PRs)\\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\\n- Review Time: +227% (72h, was 22h)\\n\\n## Team Health\\n- Active contributors: 25\\n- Top contributor: 17%\\n\\n## AI Impact\\n- AI adoption: 34%\\n- AI PRs: 47% SLOWER than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown: Cycle time jumped 136% to 169â€¯h, threatening delivery timelines.\",\n  \"detail\": \"While throughput rose 25% to 123 PRs, cycle time more than doubled from 72â€¯h to 169â€¯h and review time surged 227% to 72â€¯h. Quality remains strong with only 0.8% reverts, and AI adoption sits at 34% (AI PRs are slower). The dramatic slowdown indicates bottlenecks in review and handâ€‘off processes.\",\n  \"recommendation\": \"Launch a rapid reviewâ€‘process audit to identify and remove handâ€‘off delays, then implement parallel or automated reviews and stricter WIP limits to bring cycle time back down.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+25%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"169h (+136%)\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"34%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2384,
            "prompt": 1738,
            "completion": 646,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 385
            }
          },
          "cached": false,
          "latencyMs": 1778,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3-slowdown] 136% cycle time increase (no quality issues)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
              "description": "Headline addresses severe slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
                "description": "Headline addresses severe slowdown"
              }
            }
          ]
        },
        "id": "1fcaec19-ef9d-4d49-a262-719c248745b7",
        "latencyMs": 909,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (0.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +25% (123 PRs)\\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\\n- Review Time: +227% (72h, was 22h)\\n\\n## Team Health\\n- Active contributors: 25\\n- Top contributor: 17%\\n\\n## AI Impact\\n- AI adoption: 34%\\n- AI PRs: 47% SLOWER than non-AI\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Severe slowdown in cycle time: 136% increase to 169 hours, indicating systemic delivery issues.\",\n  \"detail\": \"The cycle time has significantly increased by 136% to 169 hours, which is a major concern. Despite a 25% increase in throughput with 123 PRs merged, the severe slowdown in cycle time and review time, which increased by 227% to 72 hours, suggests that there are underlying issues with the development process. The revert rate remains healthy at 0.8%, and AI adoption is at 34%, but AI PRs are 47% slower than non-AI PRs.\",\n  \"recommendation\": \"Investigate the root causes of the cycle time increase and review time delay, and consider process adjustments or additional resources to mitigate these issues.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+25%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+136%\", \"trend\": \"negative\"},\n    {\"label\": \"AI Adoption\", \"value\": \"34%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1981,
            "prompt": 1715,
            "completion": 266,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 900,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P3-slowdown] 136% cycle time increase (no quality issues)",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
              "description": "Headline addresses severe slowdown"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 4,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
                "description": "Headline addresses throughput or AI impact"
              }
            }
          ]
        },
        "id": "01bec8cb-3627-46e0-92a8-9dd94f8cf0b6",
        "latencyMs": 1033,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 2 (2.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +60% (72 PRs, was 45)\\n- Cycle Time: -57% (28h, was 65h)\\n\\n## Team Health\\n- Active contributors: 11\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 42%\\n- AI PRs: 23% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Throughput surge: 60% increase in merged PRs this period, driven by faster cycle times and AI adoption.\",\"detail\":\"The team closed 72 PRsâ€”up 60% from 45â€”while cycle time dropped 57% to 28 hours. AI-assisted PRs are 23% faster, and the revert rate remains low at 2.8%. These gains indicate a healthy acceleration in delivery.\",\"recommendation\":\"Add a postâ€‘merge quality gate to keep the revert rate below 5% as throughput continues to grow.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"+60%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"-57%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"42%\",\"trend\":\"positive\"},{\"label\":\"Quality\",\"value\":\"2.8% reverts\",\"trend\":\"positive\"}]}",
          "tokenUsage": {
            "total": 2385,
            "prompt": 1712,
            "completion": 673,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 486
            }
          },
          "cached": false,
          "latencyMs": 1030,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-up] 60% throughput increase",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
              "description": "Headline addresses throughput or AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
                "description": "Headline addresses throughput or AI impact"
              }
            }
          ]
        },
        "id": "a9aea29a-1e74-4071-bb62-90e6177d1032",
        "latencyMs": 931,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 2 (2.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +60% (72 PRs, was 45)\\n- Cycle Time: -57% (28h, was 65h)\\n\\n## Team Health\\n- Active contributors: 11\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 42%\\n- AI PRs: 23% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput significantly increased by 60% with reduced cycle time, indicating improved team efficiency and productivity.\",\n  \"detail\": \"Over the last 30 days, the team saw a 60% increase in throughput, merging 72 PRs compared to 45 previously, and a 57% reduction in cycle time to 28 hours. Quality remains stable with a 2.8% revert rate. AI adoption is at 42%, with AI-assisted PRs being 23% faster, but this is below the threshold for significant AI impact.\",\n  \"recommendation\": \"Investigate the causes of the improved throughput and cycle time to identify best practices and areas for further optimization, ensuring these gains are sustainable.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+60%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-57%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"42%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"2.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1938,
            "prompt": 1690,
            "completion": 248,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 928,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-up] 60% throughput increase",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
              "description": "Headline addresses throughput or AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
                "description": "Headline addresses throughput or AI impact"
              }
            }
          ]
        },
        "id": "4da8f4e7-f6bc-41c0-8942-1b27aeeb774e",
        "latencyMs": 1803,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 2 (2.8% of merged PRs)\\n\\n## Velocity\\n- Throughput: +60% (72 PRs, was 45)\\n- Cycle Time: -57% (28h, was 65h)\\n\\n## Team Health\\n- Active contributors: 11\\n- Top contributor: 20%\\n\\n## AI Impact\\n- AI adoption: 42%\\n- AI PRs: 23% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput surge: PR volume jumped 60% this period, accelerating delivery speed.\",\n  \"detail\": \"The team delivered 72 PRs, a 60% increase over the prior month, while cycle time dropped 57% to 28â€¯h. AI tools are used in 42% of work and make PRs 23% faster, and the revert rate remains low at 2.8%, indicating quality is holding.\",\n  \"recommendation\": \"Run a capacity and process review to codify the practices that enabled the throughput boost and ensure the pace is sustainable without compromising quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+60%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-57%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"42%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"2.8% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2430,
            "prompt": 1712,
            "completion": 718,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 489
            }
          },
          "cached": false,
          "latencyMs": 1800,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-up] 60% throughput increase",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
              "description": "Headline addresses throughput or AI impact"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 5,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
                "description": "Headline addresses throughput drop"
              }
            }
          ]
        },
        "id": "2547e621-de46-44bb-811f-6bcb11c115a5",
        "latencyMs": 1064,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: -64% (8 PRs, was 22)\\n- Cycle Time: -25% (18h, was 24h)\\n\\n## Team Health\\n- Active contributors: 3\\n- Top contributor: 50%\\n\\n## AI Impact\\n- AI adoption: 38%\\n- AI PRs: 16% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Throughput drop: 64% decline in PRs merged this period.\",\"detail\":\"Merged PRs fell from 22 to 8, a 64% drop, while cycle time improved 25% to 18â€¯hours. AI adoption sits at 38% and reverts remain at 0%, indicating quality is intact but output has sharply decreased.\",\"recommendation\":\"Conduct a capacity and blocker review to identify why fewer PRs are being mergedâ€”consider redistributing work or adding resources to restore throughput.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"-64%\",\"trend\":\"negative\"},{\"label\":\"Cycle Time\",\"value\":\"-25%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"38%\",\"trend\":\"neutral\"},{\"label\":\"Quality\",\"value\":\"0% reverts\",\"trend\":\"positive\"}]}",
          "tokenUsage": {
            "total": 2541,
            "prompt": 1710,
            "completion": 831,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 653
            }
          },
          "cached": false,
          "latencyMs": 1063,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-down] 64% throughput drop",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
              "description": "Headline addresses throughput drop"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
                "description": "Headline addresses throughput drop"
              }
            }
          ]
        },
        "id": "3c99cd2e-c3b7-4864-b2e5-48cf82ed32fc",
        "latencyMs": 1119,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: -64% (8 PRs, was 22)\\n- Cycle Time: -25% (18h, was 24h)\\n\\n## Team Health\\n- Active contributors: 3\\n- Top contributor: 50%\\n\\n## AI Impact\\n- AI adoption: 38%\\n- AI PRs: 16% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput alert: 64% decrease in PRs merged over the last 30 days, from 22 to 8.\",\n  \"detail\": \"Despite a 25% reduction in cycle time to 18 hours and a healthy 0% revert rate, the significant drop in throughput indicates potential delivery issues. AI adoption at 38% shows promise, with AI-assisted PRs being 16% faster, but does not meet the 40% threshold for significant impact. Team health appears stable with 3 active contributors and the top contributor at 50%.\",\n  \"recommendation\": \"Investigate the cause of the throughput decrease, focusing on potential bottlenecks or process changes that may be hindering the team's ability to merge PRs.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"-64%\", \"trend\": \"negative\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-25%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"38%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1943,
            "prompt": 1688,
            "completion": 255,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 1118,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-down] 64% throughput drop",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
              "description": "Headline addresses throughput drop"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
                "description": "Headline addresses throughput drop"
              }
            }
          ]
        },
        "id": "fa2890fc-85b5-42d8-859f-6c352ee193f3",
        "latencyMs": 2075,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: -64% (8 PRs, was 22)\\n- Cycle Time: -25% (18h, was 24h)\\n\\n## Team Health\\n- Active contributors: 3\\n- Top contributor: 50%\\n\\n## AI Impact\\n- AI adoption: 38%\\n- AI PRs: 16% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Throughput alarm: PR output fell 64% this period, dropping from 22 to 8 PRs.\",\n  \"detail\": \"The team delivered only 8 PRs, a 64% decline, while cycle time improved 25% to 18â€¯h and quality remained perfect with 0% reverts. AI adoption sits at 38% and the top contributor accounts for 50% of merged work.\",\n  \"recommendation\": \"Run a focused rootâ€‘cause analysis on the throughput dropâ€”review sprint planning, blocker logs, and capacity to pinpoint and eliminate impediments.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"-64%\", \"trend\": \"negative\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-25%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"38%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2477,
            "prompt": 1710,
            "completion": 767,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 541
            }
          },
          "cached": false,
          "latencyMs": 2073,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P4-throughput-down] 64% throughput drop",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
              "description": "Headline addresses throughput drop"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 6,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "Headline addresses bus factor risk"
              }
            }
          ]
        },
        "id": "a66bc1a4-4b1c-4d02-9f02-430d6970da38",
        "latencyMs": 1037,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (40 PRs)\\n- Cycle Time: -8% (24h, was 26h)\\n\\n## Team Health\\n- Active contributors: 5\\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\\n- Work concentration: High risk\\n\\n## AI Impact\\n- AI adoption: 25%\\n- AI PRs: 12% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"With 65% of PRs handled by a single contributor, the team faces a high bus factor risk despite healthy metrics: 0% revert rate, a 14% throughput increase, and an 8% reduction in cycle time to 24 hours. AI adoption remains low at 25%, and overall quality is strong.\",\n  \"recommendation\": \"Implement crossâ€‘training and pair programming to distribute ownership of key components and reduce reliance on the top contributor.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-8% (24h)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2547,
            "prompt": 1723,
            "completion": 824,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 596
            }
          },
          "cached": false,
          "latencyMs": 1035,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6-busfactor] 65% work concentration on team of 5",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "Headline addresses bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "Headline addresses bus factor risk"
              }
            }
          ]
        },
        "id": "a8694890-f0e6-4616-a93e-8d6f939c7292",
        "latencyMs": 875,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (40 PRs)\\n- Cycle Time: -8% (24h, was 26h)\\n\\n## Team Health\\n- Active contributors: 5\\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\\n- Work concentration: High risk\\n\\n## AI Impact\\n- AI adoption: 25%\\n- AI PRs: 12% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members, posing a continuity risk.\",\n  \"detail\": \"With a healthy revert rate of 0%, a 14% increase in throughput, and an 8% decrease in cycle time, the team's overall performance is positive. However, the high work concentration at 65% creates a significant continuity risk if the top contributor is unavailable. AI adoption is at 25%, with AI-assisted PRs being 12% faster, but this is below the threshold for significant AI impact.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components to mitigate the bus factor risk.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-8%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1946,
            "prompt": 1701,
            "completion": 245,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 873,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6-busfactor] 65% work concentration on team of 5",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "Headline addresses bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
                "description": "Headline addresses bus factor risk"
              }
            }
          ]
        },
        "id": "98dce4a0-a5ac-488c-acf2-073a1fc40d16",
        "latencyMs": 1987,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 0 (0% of merged PRs)\\n\\n## Velocity\\n- Throughput: +14% (40 PRs)\\n- Cycle Time: -8% (24h, was 26h)\\n\\n## Team Health\\n- Active contributors: 5\\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\\n- Work concentration: High risk\\n\\n## AI Impact\\n- AI adoption: 25%\\n- AI PRs: 12% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of PRs across a 5â€‘person team.\",\n  \"detail\": \"Quality is excellent with 0% reverts and delivery is improving â€“ throughput rose 14% to 40 PRs and cycle time fell 8% to 24â€¯h. However, 65% of merged work comes from a single engineer, creating a high busâ€‘factor risk.\",\n  \"recommendation\": \"Implement a rotation or pairâ€‘programming program to spread ownership of core components and reduce reliance on the top contributor.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+14%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-8% (24h)\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2281,
            "prompt": 1723,
            "completion": 558,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 334
            }
          },
          "cached": false,
          "latencyMs": 1985,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[P6-busfactor] 65% work concentration on team of 5",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
              "description": "Headline addresses bus factor risk"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 7,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality crisis (P1) beats AI impact (P2)"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
                "description": "Should NOT lead with AI benefits when quality is crisis"
              }
            }
          ]
        },
        "id": "90f42b1e-34c8-40fd-816e-3d6e875b61cd",
        "latencyMs": 752,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +11%\\n- Cycle Time: -9%\\n\\n## Team Health\\n- Active contributors: 15\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% FASTER than non-AI\\n- AI HELPS velocity\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite an 11% increase in throughput and a 9% reduction in cycle time, the 12% revert rate signals a quality crisis that could impact customer experience. The team is actively using AI tools at 45% adoption, which is helping velocity, but the high revert rate suggests that quality controls may be lagging.\",\n  \"recommendation\": \"Conduct a rootâ€‘cause analysis of reverted PRs and implement mandatory preâ€‘merge testing or code review checklists to reduce reverts.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+11%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2310,
            "prompt": 1727,
            "completion": 583,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 352
            }
          },
          "cached": false,
          "latencyMs": 749,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] 12% reverts AND 45% AI adoption - quality must win",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality crisis (P1) beats AI impact (P2)"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
              "description": "Should NOT lead with AI benefits when quality is crisis"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality crisis (P1) beats AI impact (P2)"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
                "description": "Should NOT lead with AI benefits when quality is crisis"
              }
            }
          ]
        },
        "id": "600fad00-4583-4495-a915-a03f64db87b0",
        "latencyMs": 780,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +11%\\n- Cycle Time: -9%\\n\\n## Team Health\\n- Active contributors: 15\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% FASTER than non-AI\\n- AI HELPS velocity\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite a 11% increase in throughput and a 9% decrease in cycle time, the 12% revert rate indicates significant quality issues requiring immediate attention. AI adoption is at 45%, with AI-assisted PRs being 10% faster, but this positive impact is overshadowed by the quality concerns. The team has 15 active contributors, with the top contributor owning 18% of the work.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements to improve overall quality.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+11%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-9%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1943,
            "prompt": 1705,
            "completion": 238,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 779,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] 12% reverts AND 45% AI adoption - quality must win",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality crisis (P1) beats AI impact (P2)"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
              "description": "Should NOT lead with AI benefits when quality is crisis"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
                "description": "Quality crisis (P1) beats AI impact (P2)"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
                "description": "Should NOT lead with AI benefits when quality is crisis"
              }
            }
          ]
        },
        "id": "6dc16d2e-064f-4de9-9c68-5d9a20fb1c6e",
        "latencyMs": 1214,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\\n- Hotfixes: 5 (5.0%)\\n\\n## Velocity\\n- Throughput: +11%\\n- Cycle Time: -9%\\n\\n## Team Health\\n- Active contributors: 15\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 45%\\n- AI PRs: 10% FASTER than non-AI\\n- AI HELPS velocity\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Quality alert: 12% of merged PRs were reverted this period, exceeding the 8% safety threshold.\",\n  \"detail\": \"Despite a healthy +11% increase in throughput and a 9% reduction in cycle time, the revert rate climbed to 12%, indicating a stability problem. AI adoption is at 45% with AIâ€‘assisted PRs delivering 10% faster, but the quality signal outweighs the velocity gains.\",\n  \"recommendation\": \"Conduct a rootâ€‘cause analysis of reverted PRs and introduce stricter preâ€‘merge quality gates (e.g., automated regression tests and mandatory peer review checklists).\",\n  \"metric_cards\": [\n    {\n      \"label\": \"Throughput\",\n      \"value\": \"+11%\",\n      \"trend\": \"positive\"\n    },\n    {\n      \"label\": \"Cycle Time\",\n      \"value\": \"-9%\",\n      \"trend\": \"positive\"\n    },\n    {\n      \"label\": \"AI Adoption\",\n      \"value\": \"45%\",\n      \"trend\": \"positive\"\n    },\n    {\n      \"label\": \"Quality\",\n      \"value\": \"12% reverts\",\n      \"trend\": \"warning\"\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2172,
            "prompt": 1727,
            "completion": 445,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 185
            }
          },
          "cached": false,
          "latencyMs": 1211,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[CONFLICT] 12% reverts AND 45% AI adoption - quality must win",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
              "description": "Quality crisis (P1) beats AI impact (P2)"
            },
            {
              "type": "javascript",
              "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
              "description": "Should NOT lead with AI benefits when quality is crisis"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 8,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Complete valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "78894f9e-382f-443d-942c-d778c356d038",
        "latencyMs": 838,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.0% of merged PRs)\\n- Hotfixes: 0\\n\\n## Velocity\\n- Throughput: +8% (54 PRs)\\n- Cycle Time: -5% (22h)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 30%\\n- AI PRs: 8% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 0,
        "provider": {
          "id": "groq:openai/gpt-oss-20b",
          "label": "GPT-OSS-20B"
        },
        "response": {
          "output": "{\"headline\":\"Delivery gains: Throughput up 8% and cycle time down 5% over the last 30 days.\",\"detail\":\"The team closed 54 PRs, an 8% increase in throughput, while average cycle time improved to 22 hours, a 5% reduction. AI tools are adopted by 30% of PRs and are 8% faster, and the revert rate remains low at 1%. These metrics indicate a healthy, efficient delivery pipeline.\",\"recommendation\":\"Maintain the current process cadence and explore scaling AI adoption to further accelerate cycle times without compromising quality.\",\"metric_cards\":[{\"label\":\"Throughput\",\"value\":\"+8%\",\"trend\":\"positive\"},{\"label\":\"Cycle Time\",\"value\":\"-5%\",\"trend\":\"positive\"},{\"label\":\"AI Adoption\",\"value\":\"30%\",\"trend\":\"neutral\"},{\"label\":\"Quality\",\"value\":\"1% reverts\",\"trend\":\"positive\"}]}",
          "tokenUsage": {
            "total": 2275,
            "prompt": 1711,
            "completion": 564,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 372
            }
          },
          "cached": false,
          "latencyMs": 836,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All healthy metrics - general positive summary",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Complete valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Complete valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "599d1e89-a289-43f9-b964-42fce5cfdbd3",
        "latencyMs": 995,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.0% of merged PRs)\\n- Hotfixes: 0\\n\\n## Velocity\\n- Throughput: +8% (54 PRs)\\n- Cycle Time: -5% (22h)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 30%\\n- AI PRs: 8% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 2,
        "provider": {
          "id": "groq:llama-3.3-70b-versatile",
          "label": "Llama-3.3-70B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Engineering team maintains healthy quality and velocity with 1.0% reverts and 8% throughput growth.\",\n  \"detail\": \"The team has shown a stable performance over the last 30 days, with a low revert rate of 1.0% and an 8% increase in throughput, resulting in 54 PRs. Cycle time has also improved by 5%, now averaging 22 hours. AI adoption stands at 30%, with AI-assisted PRs being 8% faster, indicating a positive but not yet significant impact.\",\n  \"recommendation\": \"Continue monitoring AI adoption and its effect on cycle time to identify opportunities for further improvement and potential training needs.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+8%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"30%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"1.0% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 1931,
            "prompt": 1689,
            "completion": 242,
            "numRequests": 1
          },
          "cached": false,
          "latencyMs": 994,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All healthy metrics - general positive summary",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Complete valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 1,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 0,
            "prompt": 0,
            "completion": 0,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "is-json"
              }
            },
            {
              "pass": true,
              "score": 1,
              "reason": "Assertion passed",
              "assertion": {
                "type": "javascript",
                "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
                "description": "Complete valid response with 4 metric cards"
              }
            }
          ]
        },
        "id": "a8832c24-c5ce-4216-be3e-4ed2c1408624",
        "latencyMs": 1586,
        "namedScores": {},
        "prompt": {
          "raw": "[\n  {\n    \"role\": \"system\",\n    \"content\": \"<role>\\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\\n</role>\\n\\n<task>\\nAnalyze the provided engineering metrics and generate an executive insight with:\\n1. A headline that addresses the most critical finding (based on priority rules below)\\n2. Context explaining the key numbers and implications\\n3. One specific, actionable recommendation\\n4. Four metric cards summarizing key indicators\\n</task>\\n\\n<priority_rules>\\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\\n\\nPRIORITY 1: Quality Crisis\\n- Condition: revert_rate > 8%\\n- Headline must address: Reverts, quality concerns, stability\\n- Why first: Quality problems affect customers directly and indicate process failures\\n\\nPRIORITY 2: AI Impact (significant)\\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\\n- Headline must address: AI tool impact on velocity (positive or negative)\\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\\n\\nPRIORITY 3: Severe Slowdown\\n- Condition: cycle_time pct_change > 50%\\n- Headline must address: Cycle time increase, delivery delays\\n- Why: Major slowdowns indicate systemic delivery issues\\n\\nPRIORITY 4: Major Throughput Change\\n- Condition: |throughput pct_change| > 30%\\n- Headline must address: Throughput increase or decrease\\n- Why: Significant output changes require investigation\\n\\nPRIORITY 5: Review Bottleneck\\n- Condition: bottleneck_detected = true\\n- Headline must address: Review delays, blocked work\\n- Why: Bottlenecks slow the entire team\\n\\nPRIORITY 6: Bus Factor Risk\\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\\n- Headline must address: Work concentration, dependency risk\\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\\n\\nPRIORITY 7: General Summary\\n- Condition: None of the above apply\\n- Headline must address: Most notable positive or negative trend\\n</priority_rules>\\n\\n<examples>\\n\\n<example name=\\\"quality_crisis_priority\\\">\\nInput metrics:\\n- revert_rate: 12%\\n- ai_adoption: 45%\\n- ai_cycle_diff: -10% (AI PRs are faster)\\n- throughput_change: +20%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\\\",\\n  \\\"detail\\\": \\\"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\\\",\\n  \\\"recommendation\\\": \\\"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"+20%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"45%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"12% reverts\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\\n</example>\\n\\n<example name=\\\"bus_factor_priority\\\">\\nInput metrics:\\n- team_size: 5 contributors\\n- top_contributor_pct: 65%\\n- revert_rate: 2%\\n- ai_adoption: 25%\\n- cycle_time_change: -5%\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\\\",\\n  \\\"detail\\\": \\\"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\\\",\\n  \\\"recommendation\\\": \\\"Distribute ownership through pair programming or knowledge transfer sessions on key components.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"-5%\\\", \\\"trend\\\": \\\"positive\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"25%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Team Health\\\", \\\"value\\\": \\\"65% concentration\\\", \\\"trend\\\": \\\"warning\\\"}\\n  ]\\n}\\n\\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\\n</example>\\n\\n<example name=\\\"ai_negative_impact\\\">\\nInput metrics:\\n- revert_rate: 3%\\n- ai_adoption: 55%\\n- ai_cycle_time: 48 hours\\n- non_ai_cycle_time: 24 hours\\n- ai_cycle_diff: +100% (AI PRs take twice as long)\\n\\nOutput:\\n{\\n  \\\"headline\\\": \\\"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\\\",\\n  \\\"detail\\\": \\\"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\\\",\\n  \\\"recommendation\\\": \\\"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"stable\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"+100% AI\\\", \\\"trend\\\": \\\"warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"55%\\\", \\\"trend\\\": \\\"neutral\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"3% reverts\\\", \\\"trend\\\": \\\"positive\\\"}\\n  ]\\n}\\n\\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\\n</example>\\n\\n</examples>\\n\\n<output_format>\\nReturn a JSON object with exactly these fields:\\n\\n{\\n  \\\"headline\\\": \\\"1-2 sentence executive summary based on the highest applicable priority\\\",\\n  \\\"detail\\\": \\\"2-3 sentences with key numbers and context\\\",\\n  \\\"recommendation\\\": \\\"One specific, actionable next step\\\",\\n  \\\"metric_cards\\\": [\\n    {\\\"label\\\": \\\"Throughput\\\", \\\"value\\\": \\\"% change or count\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Cycle Time\\\", \\\"value\\\": \\\"hours or % change\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"AI Adoption\\\", \\\"value\\\": \\\"%\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"},\\n    {\\\"label\\\": \\\"Quality\\\", \\\"value\\\": \\\"revert rate or status\\\", \\\"trend\\\": \\\"positive|negative|neutral|warning\\\"}\\n  ]\\n}\\n\\nTrend meanings:\\n- positive: Good news, improvement, healthy\\n- negative: Bad news, decline, concerning\\n- neutral: Stable, no significant change\\n- warning: Needs attention, approaching threshold\\n\\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\\n</output_format>\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"# Engineering Metrics\\n## Period: 30 days\\n\\n## Quality Metrics\\n- Reverts: 1 (1.0% of merged PRs)\\n- Hotfixes: 0\\n\\n## Velocity\\n- Throughput: +8% (54 PRs)\\n- Cycle Time: -5% (22h)\\n\\n## Team Health\\n- Active contributors: 10\\n- Top contributor: 18%\\n\\n## AI Impact\\n- AI adoption: 30%\\n- AI PRs: 8% faster\"\n  }\n]",
          "label": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
        },
        "promptId": "4cdd7eafe3c9942225d0cf7b391374a4e41f44a24b38ae65a5cdc6fb3b55c0df",
        "promptIdx": 1,
        "provider": {
          "id": "groq:openai/gpt-oss-120b",
          "label": "GPT-OSS-120B"
        },
        "response": {
          "output": "{\n  \"headline\": \"Delivery gains: Throughput up 8% and cycle time down 5% this period.\",\n  \"detail\": \"The team shipped 54 PRs, a modest 8% increase in throughput, while average cycle time fell 5% to 22â€¯hours. Quality remains strong with only 1% revert rate, and AI tools are used in 30% of PRs, delivering an 8% speed boost on those PRs.\",\n  \"recommendation\": \"Scale AI assistance to more PRs and formalize bestâ€‘practice guidelines to amplify the observed speed gains.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+8%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"30%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"1% reverts\", \"trend\": \"positive\"}\n  ]\n}",
          "tokenUsage": {
            "total": 2340,
            "prompt": 1711,
            "completion": 629,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 405
            }
          },
          "cached": false,
          "latencyMs": 1585,
          "finishReason": "stop",
          "guardrails": {
            "flagged": false
          }
        },
        "score": 1,
        "success": true,
        "testCase": {
          "description": "[EDGE] All healthy metrics - general positive summary",
          "vars": {
            "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
            "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
          },
          "assert": [
            {
              "type": "is-json"
            },
            {
              "type": "javascript",
              "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
              "description": "Complete valid response with 4 metric cards"
            }
          ],
          "options": {
            "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
          },
          "metadata": {}
        },
        "testIdx": 9,
        "vars": {
          "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>",
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      }
    ],
    "stats": {
      "successes": 26,
      "failures": 4,
      "errors": 0,
      "tokenUsage": {
        "prompt": 51396,
        "completion": 15770,
        "cached": 0,
        "total": 67166,
        "numRequests": 30,
        "completionDetails": {
          "reasoning": 8883,
          "acceptedPrediction": 0,
          "rejectedPrediction": 0
        },
        "assertions": {
          "total": 0,
          "prompt": 0,
          "completion": 0,
          "cached": 0,
          "numRequests": 0,
          "completionDetails": {
            "reasoning": 0,
            "acceptedPrediction": 0,
            "rejectedPrediction": 0
          }
        }
      },
      "durationMs": 12169
    }
  },
  "config": {
    "tags": {},
    "description": "Dashboard Insight Evaluation v2.0 (Anthropic Best Practices)",
    "prompts": [
      {
        "id": "v2.0-anthropic-style",
        "raw": "[\n  {\"role\": \"system\", \"content\": \"{{system_prompt}}\"},\n  {\"role\": \"user\", \"content\": \"{{user_prompt}}\"}\n]"
      }
    ],
    "providers": [
      {
        "id": "groq:openai/gpt-oss-20b",
        "label": "GPT-OSS-20B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      },
      {
        "id": "groq:openai/gpt-oss-120b",
        "label": "GPT-OSS-120B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      },
      {
        "id": "groq:llama-3.3-70b-versatile",
        "label": "Llama-3.3-70B",
        "config": {
          "temperature": 0.3,
          "max_tokens": 2000
        }
      }
    ],
    "tests": [
      {
        "description": "[P1-quality] 12% reverts should trigger quality crisis (ignore AI benefits)",
        "vars": {
          "user_prompt": "# Engineering Metrics for Team Alpha\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +20% (100 PRs merged)\n- Cycle Time: stable\n\n## Team Health\n- Active contributors: 8\n- Top contributor: 18% of PRs\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% faster than non-AI"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && r.metric_cards; })()",
            "description": "Has all required fields"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12%'); })()",
            "description": "Headline addresses quality crisis (P1)"
          }
        ]
      },
      {
        "description": "[P1-quality] 9% reverts should trigger quality crisis",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 9 (9.0% of merged PRs) [CRITICAL: Above 8% threshold]\n\n## Velocity\n- Throughput: stable\n- Cycle Time: -15% (faster)\n\n## Team Health\n- Active contributors: 6\n- Top contributor: 25%\n\n## AI Impact\n- AI adoption: 30%"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('9%'); })()",
            "description": "Headline addresses quality (9% > 8%)"
          }
        ]
      },
      {
        "description": "[P2-ai-positive] High AI adoption (70%) with 46% faster cycle time",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.3% of merged PRs)\n\n## Velocity\n- Throughput: +14% (80 PRs)\n- Cycle Time: -36% (18 hours, was 28)\n\n## Team Health\n- Active contributors: 12\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 46% FASTER than non-AI (14h vs 26h)"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('fast') || h.includes('46') || h.includes('70') || h.includes('velocity') || h.includes('boost')); })()",
            "description": "Headline highlights positive AI impact"
          }
        ]
      },
      {
        "description": "[P2-ai-negative] High AI adoption (70%) but AI PRs 100% slower",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 3 (5.0% of merged PRs)\n\n## Velocity\n- Throughput: +9% (60 PRs)\n- Cycle Time: +33% (40 hours, was 30)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 22%\n\n## AI Impact\n- AI adoption: 70%\n- AI PRs: 100% SLOWER than non-AI (48h vs 24h)\n- AI HURTS: AI PRs take TWICE as long"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('ai') && (h.includes('slow') || h.includes('100') || h.includes('twice') || h.includes('longer') || h.includes('concern')); })()",
            "description": "Headline flags AI negative impact"
          }
        ]
      },
      {
        "description": "[P3-slowdown] 136% cycle time increase (no quality issues)",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (0.8% of merged PRs)\n\n## Velocity\n- Throughput: +25% (123 PRs)\n- Cycle Time: +136% (169h, was 72h) [SEVERE SLOWDOWN]\n- Review Time: +227% (72h, was 22h)\n\n## Team Health\n- Active contributors: 25\n- Top contributor: 17%\n\n## AI Impact\n- AI adoption: 34%\n- AI PRs: 47% SLOWER than non-AI"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('cycle') || h.includes('slow') || h.includes('136') || h.includes('169') || h.includes('delay'); })()",
            "description": "Headline addresses severe slowdown"
          }
        ]
      },
      {
        "description": "[P4-throughput-up] 60% throughput increase",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 2 (2.8% of merged PRs)\n\n## Velocity\n- Throughput: +60% (72 PRs, was 45)\n- Cycle Time: -57% (28h, was 65h)\n\n## Team Health\n- Active contributors: 11\n- Top contributor: 20%\n\n## AI Impact\n- AI adoption: 42%\n- AI PRs: 23% faster"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('60') || h.includes('surge') || h.includes('increase') || h.includes('growth') || h.includes('ai'); })()",
            "description": "Headline addresses throughput or AI impact"
          }
        ]
      },
      {
        "description": "[P4-throughput-down] 64% throughput drop",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: -64% (8 PRs, was 22)\n- Cycle Time: -25% (18h, was 24h)\n\n## Team Health\n- Active contributors: 3\n- Top contributor: 50%\n\n## AI Impact\n- AI adoption: 38%\n- AI PRs: 16% faster"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('throughput') || h.includes('64') || h.includes('drop') || h.includes('decrease') || h.includes('decline') || h.includes('fell'); })()",
            "description": "Headline addresses throughput drop"
          }
        ]
      },
      {
        "description": "[P6-busfactor] 65% work concentration on team of 5",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 0 (0% of merged PRs)\n\n## Velocity\n- Throughput: +14% (40 PRs)\n- Cycle Time: -8% (24h, was 26h)\n\n## Team Health\n- Active contributors: 5\n- Top contributor: 65% of PRs [BUS FACTOR RISK]\n- Work concentration: High risk\n\n## AI Impact\n- AI adoption: 25%\n- AI PRs: 12% faster"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('65') || h.includes('concentration') || h.includes('contributor') || h.includes('dependency') || h.includes('risk') || h.includes('bus'); })()",
            "description": "Headline addresses bus factor risk"
          }
        ]
      },
      {
        "description": "[CONFLICT] 12% reverts AND 45% AI adoption - quality must win",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 12 (12.0% of merged PRs) [CRITICAL: Above 8% threshold]\n- Hotfixes: 5 (5.0%)\n\n## Velocity\n- Throughput: +11%\n- Cycle Time: -9%\n\n## Team Health\n- Active contributors: 15\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 45%\n- AI PRs: 10% FASTER than non-AI\n- AI HELPS velocity"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return h.includes('revert') || h.includes('quality') || h.includes('12'); })()",
            "description": "Quality crisis (P1) beats AI impact (P2)"
          },
          {
            "type": "javascript",
            "value": "(() => { const h = JSON.parse(output).headline.toLowerCase(); return !(h.includes('ai') && h.includes('fast')); })()",
            "description": "Should NOT lead with AI benefits when quality is crisis"
          }
        ]
      },
      {
        "description": "[EDGE] All healthy metrics - general positive summary",
        "vars": {
          "user_prompt": "# Engineering Metrics\n## Period: 30 days\n\n## Quality Metrics\n- Reverts: 1 (1.0% of merged PRs)\n- Hotfixes: 0\n\n## Velocity\n- Throughput: +8% (54 PRs)\n- Cycle Time: -5% (22h)\n\n## Team Health\n- Active contributors: 10\n- Top contributor: 18%\n\n## AI Impact\n- AI adoption: 30%\n- AI PRs: 8% faster"
        },
        "assert": [
          {
            "type": "is-json"
          },
          {
            "type": "javascript",
            "value": "(() => { const r = JSON.parse(output); return r.headline && r.detail && r.recommendation && Array.isArray(r.metric_cards) && r.metric_cards.length === 4; })()",
            "description": "Complete valid response with 4 metric cards"
          }
        ]
      }
    ],
    "scenarios": [],
    "env": {},
    "defaultTest": {
      "vars": {
        "system_prompt": "<role>\nYou are an engineering metrics analyst helping CTOs understand their team's performance and make data-driven decisions.\n</role>\n\n<task>\nAnalyze the provided engineering metrics and generate an executive insight with:\n1. A headline that addresses the most critical finding (based on priority rules below)\n2. Context explaining the key numbers and implications\n3. One specific, actionable recommendation\n4. Four metric cards summarizing key indicators\n</task>\n\n<priority_rules>\nCheck these conditions IN ORDER. Use the FIRST condition that matches, then stop.\n\nPRIORITY 1: Quality Crisis\n- Condition: revert_rate > 8%\n- Headline must address: Reverts, quality concerns, stability\n- Why first: Quality problems affect customers directly and indicate process failures\n\nPRIORITY 2: AI Impact (significant)\n- Conditions: ai_adoption >= 40% AND |cycle_time_difference| >= 25%\n- Headline must address: AI tool impact on velocity (positive or negative)\n- Why: At meaningful adoption with clear impact, CTOs need visibility into AI ROI\n\nPRIORITY 3: Severe Slowdown\n- Condition: cycle_time pct_change > 50%\n- Headline must address: Cycle time increase, delivery delays\n- Why: Major slowdowns indicate systemic delivery issues\n\nPRIORITY 4: Major Throughput Change\n- Condition: |throughput pct_change| > 30%\n- Headline must address: Throughput increase or decrease\n- Why: Significant output changes require investigation\n\nPRIORITY 5: Review Bottleneck\n- Condition: bottleneck_detected = true\n- Headline must address: Review delays, blocked work\n- Why: Bottlenecks slow the entire team\n\nPRIORITY 6: Bus Factor Risk\n- Conditions: team_size > 3 AND top_contributor_pct > 50%\n- Headline must address: Work concentration, dependency risk\n- Why: Heavy reliance on one person creates continuity risk (only relevant for larger teams)\n\nPRIORITY 7: General Summary\n- Condition: None of the above apply\n- Headline must address: Most notable positive or negative trend\n</priority_rules>\n\n<examples>\n\n<example name=\"quality_crisis_priority\">\nInput metrics:\n- revert_rate: 12%\n- ai_adoption: 45%\n- ai_cycle_diff: -10% (AI PRs are faster)\n- throughput_change: +20%\n\nOutput:\n{\n  \"headline\": \"Quality alert: 12% of PRs were reverted this period, exceeding the 8% threshold.\",\n  \"detail\": \"Despite 20% throughput growth and 45% AI adoption showing 10% faster cycle times, the 12% revert rate indicates quality issues requiring immediate attention.\",\n  \"recommendation\": \"Investigate reverted PRs for root causes and consider adding pre-merge testing requirements.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"+20%\", \"trend\": \"positive\"},\n    {\"label\": \"Cycle Time\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"AI Adoption\", \"value\": \"45%\", \"trend\": \"positive\"},\n    {\"label\": \"Quality\", \"value\": \"12% reverts\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Quality crisis (12% > 8%) takes priority over positive AI impact and throughput growth.\n</example>\n\n<example name=\"bus_factor_priority\">\nInput metrics:\n- team_size: 5 contributors\n- top_contributor_pct: 65%\n- revert_rate: 2%\n- ai_adoption: 25%\n- cycle_time_change: -5%\n\nOutput:\n{\n  \"headline\": \"Team dependency risk: One contributor owns 65% of merged PRs across 5 team members.\",\n  \"detail\": \"Work concentration at 65% creates continuity risk if this person is unavailable. Quality remains healthy at 2% reverts. Cycle time improved 5%.\",\n  \"recommendation\": \"Distribute ownership through pair programming or knowledge transfer sessions on key components.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"-5%\", \"trend\": \"positive\"},\n    {\"label\": \"AI Adoption\", \"value\": \"25%\", \"trend\": \"neutral\"},\n    {\"label\": \"Team Health\", \"value\": \"65% concentration\", \"trend\": \"warning\"}\n  ]\n}\n\nReasoning: Bus factor (65% > 50% with team_size=5 > 3) applies. AI adoption (25%) is below the 40% threshold for AI impact priority.\n</example>\n\n<example name=\"ai_negative_impact\">\nInput metrics:\n- revert_rate: 3%\n- ai_adoption: 55%\n- ai_cycle_time: 48 hours\n- non_ai_cycle_time: 24 hours\n- ai_cycle_diff: +100% (AI PRs take twice as long)\n\nOutput:\n{\n  \"headline\": \"AI adoption concern: AI-assisted PRs are taking 100% longer than non-AI PRs despite 55% adoption.\",\n  \"detail\": \"At 55% AI adoption, AI-assisted PRs average 48 hours cycle time versus 24 hours for non-AI PRs. This suggests AI tools may be used for more complex work or require process adjustment.\",\n  \"recommendation\": \"Analyze AI-assisted PRs to understand if complexity differs, and consider training on effective AI tool usage.\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"stable\", \"trend\": \"neutral\"},\n    {\"label\": \"Cycle Time\", \"value\": \"+100% AI\", \"trend\": \"warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"55%\", \"trend\": \"neutral\"},\n    {\"label\": \"Quality\", \"value\": \"3% reverts\", \"trend\": \"positive\"}\n  ]\n}\n\nReasoning: AI impact is significant (55% > 40% adoption AND 100% > 25% diff). Quality is fine (3% < 8%), so AI impact takes priority.\n</example>\n\n</examples>\n\n<output_format>\nReturn a JSON object with exactly these fields:\n\n{\n  \"headline\": \"1-2 sentence executive summary based on the highest applicable priority\",\n  \"detail\": \"2-3 sentences with key numbers and context\",\n  \"recommendation\": \"One specific, actionable next step\",\n  \"metric_cards\": [\n    {\"label\": \"Throughput\", \"value\": \"% change or count\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Cycle Time\", \"value\": \"hours or % change\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"AI Adoption\", \"value\": \"%\", \"trend\": \"positive|negative|neutral|warning\"},\n    {\"label\": \"Quality\", \"value\": \"revert rate or status\", \"trend\": \"positive|negative|neutral|warning\"}\n  ]\n}\n\nTrend meanings:\n- positive: Good news, improvement, healthy\n- negative: Bad news, decline, concerning\n- neutral: Stable, no significant change\n- warning: Needs attention, approaching threshold\n\nReturn ONLY the JSON object. Start with { and end with }. No markdown code fences, no explanation before or after.\n</output_format>"
      },
      "options": {
        "transform": "(() => { const m = output.match(/\\{\\s*\"headline\"/); return m ? output.slice(m.index).replace(/```[\\s\\S]*$/, '').trim() : output.slice(output.indexOf('{')).replace(/```[\\s\\S]*$/, '').trim(); })()"
      },
      "assert": [],
      "metadata": {}
    },
    "outputPath": [
      "./results/insight-promptfoo-v2-results.json"
    ],
    "extensions": [],
    "metadata": {},
    "evaluateOptions": {
      "maxConcurrency": 3,
      "showProgressBar": true
    }
  },
  "shareableUrl": null,
  "metadata": {
    "promptfooVersion": "0.120.8",
    "nodeVersion": "v22.17.1",
    "platform": "darwin",
    "arch": "arm64",
    "exportedAt": "2025-12-31T19:04:23.386Z",
    "evaluationCreatedAt": "2025-12-31T19:04:09.974Z"
  }
}