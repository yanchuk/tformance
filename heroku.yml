setup:
  addons:
    - plan: heroku-postgresql
      as: DATABASE
    - plan: heroku-redis
      as: REDIS
  config:
    DJANGO_SETTINGS_MODULE: tformance.settings_production
    DEBUG: false
build:
  docker:
    django: Dockerfile.web
release:
  image: django
  command:
    - python manage.py migrate --noinput
run:
  web:
    command:
      - gunicorn --bind 0.0.0.0:$PORT --workers 1 --threads 8 --timeout 0 tformance.asgi:application -k uvicorn.workers.UvicornWorker
    image: django
  worker:
    command:
      - celery -A tformance worker -l INFO --pool threads --concurrency 20 -Q celery,sync,llm,compute
    image: django
  beat:
    command:
      - celery -A tformance beat -l INFO
    image: django
