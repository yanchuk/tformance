# Complete Data Architecture: GitHub + Jira + Slack + Copilot

**Last Updated:** 2025-12-22

This document provides a complete picture of how all data sources connect, when data is collected, and how relationships are established across GitHub, Jira, Slack surveys, and Copilot metrics.

---

## Table of Contents

1. [Master Data Flow Diagram](#master-data-flow-diagram)
2. [Integration Timeline](#integration-timeline)
3. [Data Relationship Map](#data-relationship-map)
4. [GitHub Data](#github-data)
5. [Jira Integration](#jira-integration)
6. [Survey System](#survey-system)
7. [Copilot Metrics](#copilot-metrics)
8. [Aggregation Layer](#aggregation-layer)
9. [Data Correlation Points](#data-correlation-points)

---

## Master Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COMPLETE DATA ARCHITECTURE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚    GITHUB     â”‚    â”‚     JIRA      â”‚    â”‚    SLACK      â”‚    â”‚   COPILOT     â”‚          â”‚
â”‚  â”‚               â”‚    â”‚               â”‚    â”‚               â”‚    â”‚               â”‚          â”‚
â”‚  â”‚  OAuth + API  â”‚    â”‚  OAuth + API  â”‚    â”‚  OAuth + Bot  â”‚    â”‚   GitHub API  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚          â”‚                    â”‚                    â”‚                    â”‚                   â”‚
â”‚          â”‚                    â”‚                    â”‚                    â”‚                   â”‚
â”‚          â–¼                    â–¼                    â–¼                    â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚                              TEAM (Tenant)                                     â”‚         â”‚
â”‚  â”‚                                                                               â”‚         â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚         â”‚
â”‚  â”‚   â”‚ GitHubIntegrationâ”‚    â”‚ JiraIntegration â”‚    â”‚ SlackIntegrationâ”‚          â”‚         â”‚
â”‚  â”‚   â”‚ â€¢ credential    â”‚    â”‚ â€¢ credential    â”‚    â”‚ â€¢ bot_token     â”‚          â”‚         â”‚
â”‚  â”‚   â”‚ â€¢ org_id        â”‚    â”‚ â€¢ cloud_id      â”‚    â”‚ â€¢ channel_id    â”‚          â”‚         â”‚
â”‚  â”‚   â”‚ â€¢ webhook_secretâ”‚    â”‚ â€¢ site_url      â”‚    â”‚ â€¢ settings      â”‚          â”‚         â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚         â”‚
â”‚  â”‚            â”‚                      â”‚                      â”‚                    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚                      â”‚                      â”‚                              â”‚
â”‚               â–¼                      â–¼                      â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                               TeamMember                                             â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚    â”‚  github_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links GitHub users                       â”‚  â”‚   â”‚
â”‚  â”‚    â”‚  github_username                                                            â”‚  â”‚   â”‚
â”‚  â”‚    â”‚  jira_account_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links Jira users                         â”‚  â”‚   â”‚
â”‚  â”‚    â”‚  slack_user_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links Slack users (for DMs)              â”‚  â”‚   â”‚
â”‚  â”‚    â”‚  display_name                                                               â”‚  â”‚   â”‚
â”‚  â”‚    â”‚  email                                                                       â”‚  â”‚   â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚    THE UNIVERSAL LINKER: TeamMember ties together identities across platforms       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚                                           â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚           â”‚                                     â”‚                                     â”‚     â”‚
â”‚           â–¼                                     â–¼                                     â–¼     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 â”‚               â”‚                                     â”‚  â”‚            â”‚ â”‚
â”‚  â”‚   PullRequest   â”‚â—„â”€ jira_key â”€â”€â–¶â”‚           JiraIssue                â”‚  â”‚AIUsageDailyâ”‚ â”‚
â”‚  â”‚                 â”‚               â”‚                                     â”‚  â”‚            â”‚ â”‚
â”‚  â”‚  â€¢ author (FK)  â”‚               â”‚  â€¢ assignee (FK to TeamMember)      â”‚  â”‚ â€¢ member   â”‚ â”‚
â”‚  â”‚  â€¢ jira_key     â”‚               â”‚  â€¢ jira_key (e.g., PROJ-123)        â”‚  â”‚ â€¢ source   â”‚ â”‚
â”‚  â”‚  â€¢ state        â”‚               â”‚  â€¢ story_points                     â”‚  â”‚ â€¢ date     â”‚ â”‚
â”‚  â”‚  â€¢ cycle_time   â”‚               â”‚  â€¢ sprint_name                      â”‚  â”‚ â€¢ accepted â”‚ â”‚
â”‚  â”‚  â€¢ is_ai_assistedâ”‚              â”‚  â€¢ status                           â”‚  â”‚            â”‚ â”‚
â”‚  â”‚                 â”‚               â”‚                                     â”‚  â”‚ Copilot    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ metrics    â”‚ â”‚
â”‚           â”‚                                                                  â”‚ per day    â”‚ â”‚
â”‚           â”‚                                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                              PR-Related Data                                         â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚    â”‚
â”‚  â”‚  â”‚   PRReview   â”‚  â”‚    Commit    â”‚  â”‚    PRFile    â”‚  â”‚ PRCheckRun   â”‚              â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ reviewer   â”‚  â”‚ â€¢ author     â”‚  â”‚ â€¢ filename   â”‚  â”‚ â€¢ name       â”‚              â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ state      â”‚  â”‚ â€¢ sha        â”‚  â”‚ â€¢ status     â”‚  â”‚ â€¢ status     â”‚              â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ submitted  â”‚  â”‚ â€¢ message    â”‚  â”‚ â€¢ additions  â”‚  â”‚ â€¢ conclusion â”‚              â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ â€¢ is_ai_     â”‚  â”‚ â€¢ category   â”‚  â”‚ â€¢ duration   â”‚              â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â”‚   assisted   â”‚  â”‚              â”‚  â”‚              â”‚              â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚    â”‚
â”‚  â”‚  â”‚           PRComment                â”‚  (issue comments + inline review comments)   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                              Survey System (On PR Merge)                              â”‚    â”‚
â”‚  â”‚                                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                           PRSurvey                                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   pull_request (1:1) â”€â”€â”€â”€â”€â”€â”€ Links to PullRequest                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   author (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links to TeamMember                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   author_ai_assisted â”€â”€â”€â”€â”€â”€â”€â”€ Author's disclosure (Yes/No/null)                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   author_responded_at â”€â”€â”€â”€â”€â”€â”€ When author responded                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   Delivery: Slack DM to author OR GitHub comment on PR                          â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                     â”‚                                                â”‚    â”‚
â”‚  â”‚                                     â”‚ 1:N                                            â”‚    â”‚
â”‚  â”‚                                     â–¼                                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                        PRSurveyReview                                            â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   survey (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links to PRSurvey                              â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   reviewer (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Links to TeamMember (PR reviewer)              â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   quality_rating â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1=Could be better, 2=OK, 3=Super               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   ai_guess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Reviewer's guess (AI used? Yes/No)             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   guess_correct â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Was guess correct? (computed)                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   Delivery: Slack DM to each reviewer                                           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                              Aggregation Layer                                        â”‚    â”‚
â”‚  â”‚                                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                          WeeklyMetrics                                           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   member (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Per-member weekly rollup                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   week_start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Monday of the week                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   GITHUB: prs_merged, avg_cycle_time, commits_count, lines_added/removed        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   JIRA:   story_points_completed, issues_resolved                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   AI:     ai_assisted_prs                                                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   SURVEY: avg_quality_rating, surveys_completed, guess_accuracy                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                      ReviewerCorrelation                                         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   reviewer_1, reviewer_2 â”€â”€â”€â”€â”€â”€â”€ Pair of reviewers                              â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   prs_reviewed_together â”€â”€â”€â”€â”€â”€â”€â”€ How many PRs reviewed together                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   agreements/disagreements â”€â”€â”€â”€â”€ Review outcome agreement                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚   Insight: Identify redundant reviewer pairings (always agree)                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Timeline

When does each piece of data enter the system?

```
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

ONBOARDING
â”‚
â”œâ”€â”€â”€ User connects GitHub OAuth
â”‚    â”œâ”€â”€ GitHubIntegration created
â”‚    â”œâ”€â”€ OAuthCredential stored (encrypted)
â”‚    â””â”€â”€ sync_github_members_task â†’ TeamMember records created (github_id, github_username)
â”‚
â”œâ”€â”€â”€ User connects Jira OAuth
â”‚    â”œâ”€â”€ JiraIntegration created
â”‚    â”œâ”€â”€ OAuthCredential stored
â”‚    â””â”€â”€ sync_jira_users_task â†’ TeamMember.jira_account_id populated
â”‚
â”œâ”€â”€â”€ User connects Slack OAuth
â”‚    â”œâ”€â”€ SlackIntegration created
â”‚    â””â”€â”€ sync_slack_users_task â†’ TeamMember.slack_user_id populated
â”‚
â””â”€â”€â”€ User selects repositories to track
     â”œâ”€â”€ TrackedRepository created
     â”œâ”€â”€ Webhook registered on GitHub
     â””â”€â”€ sync_repository_initial_task â†’ Historical PRs + all related data synced

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ONGOING: DEVELOPER OPENS PR

â”œâ”€â”€â”€ GitHub Webhook: pull_request (action=opened)
â”‚    â””â”€â”€ PullRequest created (state=open, author linked via github_id)
â”‚
â”œâ”€â”€â”€ Developer works on PR, pushes commits
â”‚    (Commits NOT captured until merge - no webhook for PR commits)
â”‚
â”œâ”€â”€â”€ Reviewer submits review
â”‚    â””â”€â”€ GitHub Webhook: pull_request_review
â”‚        â”œâ”€â”€ PRReview created (reviewer linked via github_id)
â”‚        â””â”€â”€ PullRequest.first_review_at updated (if first review)
â”‚
â””â”€â”€â”€ More reviews, updates...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PR MERGED

â”œâ”€â”€â”€ GitHub Webhook: pull_request (action=closed, merged=true)
â”‚    â”‚
â”‚    â”œâ”€â”€ PullRequest updated (state=merged, merged_at, cycle_time_hours)
â”‚    â”‚
â”‚    â””â”€â”€ Background tasks dispatched (independent, parallel):
â”‚
â”‚        â”Œâ”€â”€ send_pr_surveys_task â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ Create PRSurvey record                                                â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ IF author has slack_user_id:                                          â”‚
â”‚        â”‚   â”‚      Send Slack DM to author asking "Did you use AI?"                  â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â””â”€â”€ FOR EACH reviewer with slack_user_id:                                 â”‚
â”‚        â”‚          Create PRSurveyReview record                                       â”‚
â”‚        â”‚          Send Slack DM asking "AI used? Quality rating?"                   â”‚
â”‚        â”‚                                                                             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚        â”Œâ”€â”€ post_survey_comment_task â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â””â”€â”€ Post GitHub comment on PR with survey link for author                â”‚
â”‚        â”‚       (Alternative to Slack for users without slack_user_id)               â”‚
â”‚        â”‚                                                                             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚        â”Œâ”€â”€ fetch_pr_complete_data_task (NEW) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ sync_pr_commits() â†’ Commit records created                           â”‚
â”‚        â”‚   â”‚   â””â”€â”€ AI detection: Parse "Co-authored-by: copilot" trailers           â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ sync_pr_files() â†’ PRFile records created                             â”‚
â”‚        â”‚   â”‚   â””â”€â”€ File categorization: frontend/backend/test/docs/config           â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ sync_pr_check_runs() â†’ PRCheckRun records created                    â”‚
â”‚        â”‚   â”‚   â””â”€â”€ CI/CD duration calculated                                        â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â”œâ”€â”€ sync_pr_issue_comments() â†’ PRComment (type=issue)                    â”‚
â”‚        â”‚   â”œâ”€â”€ sync_pr_review_comments() â†’ PRComment (type=review)                  â”‚
â”‚        â”‚   â”‚                                                                         â”‚
â”‚        â”‚   â””â”€â”€ calculate_pr_iteration_metrics()                                     â”‚
â”‚        â”‚       â”œâ”€â”€ review_rounds                                                    â”‚
â”‚        â”‚       â”œâ”€â”€ commits_after_first_review                                       â”‚
â”‚        â”‚       â”œâ”€â”€ avg_fix_response_hours                                           â”‚
â”‚        â”‚       â””â”€â”€ total_comments                                                   â”‚
â”‚        â”‚                                                                             â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SURVEYS ANSWERED (async, user-initiated)

â”œâ”€â”€â”€ Author responds via Slack interaction or GitHub comment link
â”‚    â””â”€â”€ PRSurvey.author_ai_assisted = True/False
â”‚        PRSurvey.author_responded_at = now()
â”‚
â””â”€â”€â”€ Reviewer responds via Slack interaction
     â””â”€â”€ PRSurveyReview.quality_rating = 1/2/3
         PRSurveyReview.ai_guess = True/False
         PRSurveyReview.guess_correct = (ai_guess == survey.author_ai_assisted)
         PRSurveyReview.responded_at = now()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SCHEDULED TASKS (Daily)

â”œâ”€â”€â”€ sync_all_repositories_task (nightly)
â”‚    â””â”€â”€ For each active TrackedRepository:
â”‚        sync_repository_incremental() â†’ Catches any missed webhooks
â”‚
â”œâ”€â”€â”€ sync_copilot_metrics_task (daily)
â”‚    â””â”€â”€ Fetch Copilot usage from GitHub API
â”‚        â†’ AIUsageDaily records created for each user with Copilot seat
â”‚
â”œâ”€â”€â”€ sync_jira_projects_task (daily)
â”‚    â””â”€â”€ For each TrackedJiraProject:
â”‚        sync_project_issues() â†’ JiraIssue records created/updated
â”‚
â””â”€â”€â”€ aggregate_weekly_metrics_task (weekly, Mondays)
     â””â”€â”€ For each TeamMember:
         Compute WeeklyMetrics from raw data
         â”œâ”€â”€ GitHub: PRs merged, cycle time, commits, etc.
         â”œâ”€â”€ Jira: Story points completed
         â”œâ”€â”€ AI: AI-assisted PRs count
         â””â”€â”€ Survey: Quality ratings, guess accuracy
```

---

## Data Relationship Map

### How Data Connects

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚    TeamMember     â”‚
                                 â”‚                   â”‚
                                 â”‚  The Universal    â”‚
                                 â”‚  Identity Linker  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚                            â”‚
              â”‚ author / reviewer          â”‚ member                     â”‚ assignee
              â”‚                            â”‚                            â”‚
              â–¼                            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PullRequest        â”‚    â”‚      AIUsageDaily       â”‚    â”‚       JiraIssue         â”‚
â”‚                         â”‚    â”‚                         â”‚    â”‚                         â”‚
â”‚  github_pr_id           â”‚    â”‚  date                   â”‚    â”‚  jira_key â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”
â”‚  title                  â”‚    â”‚  source (copilot)       â”‚    â”‚  summary                â”‚ â”‚
â”‚  state                  â”‚    â”‚  suggestions_accepted   â”‚    â”‚  story_points           â”‚ â”‚
â”‚  jira_key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â–º                      â”‚ â”‚
â”‚  is_ai_assisted         â”‚    â”‚  acceptance_rate        â”‚    â”‚  sprint_name            â”‚ â”‚
â”‚  cycle_time_hours       â”‚    â”‚                         â”‚    â”‚  cycle_time_hours       â”‚ â”‚
â”‚  review_time_hours      â”‚    â”‚  Links AI usage to      â”‚    â”‚                         â”‚ â”‚
â”‚                         â”‚    â”‚  specific developer     â”‚    â”‚  Links work planning    â”‚ â”‚
â”‚  Links code delivery    â”‚    â”‚  on specific dates      â”‚    â”‚  to delivery            â”‚ â”‚
â”‚  to author/team         â”‚    â”‚                         â”‚    â”‚                         â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                                             â”‚
             â”‚ pull_request (FK)                                           â”‚
             â”‚                                         jira_key correlation â”‚
             â–¼                                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚       PRSurvey          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                         â”‚
â”‚  author_ai_assisted     â”‚  Author's disclosure: "Did you use AI?"
â”‚  author_responded_at    â”‚
â”‚                         â”‚
â”‚  Links perception       â”‚
â”‚  (survey) to reality    â”‚
â”‚  (actual AI usage)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ survey (FK)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PRSurveyReview      â”‚
â”‚                         â”‚
â”‚  quality_rating         â”‚  Reviewer's assessment: "How good was this PR?"
â”‚  ai_guess               â”‚  Reviewer's guess: "Was AI used?"
â”‚  guess_correct          â”‚  Reality check: "Did they guess right?"
â”‚                         â”‚
â”‚  Links code review      â”‚
â”‚  quality perception     â”‚
â”‚  to AI detection skill  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Correlation Points

| Data Point A | Data Point B | Correlation Question |
|--------------|--------------|---------------------|
| `PullRequest.is_ai_assisted` | `PullRequest.cycle_time_hours` | Do AI-assisted PRs ship faster? |
| `PRSurvey.author_ai_assisted` | `PRSurveyReview.quality_rating` | Are AI-assisted PRs rated higher quality? |
| `PRSurveyReview.ai_guess` | `PRSurvey.author_ai_assisted` | Can reviewers tell when AI was used? |
| `AIUsageDaily.suggestions_accepted` | `WeeklyMetrics.prs_merged` | Do heavy Copilot users ship more PRs? |
| `PullRequest.jira_key` | `JiraIssue.story_points` | How many story points per PR? |
| `Commit.is_ai_assisted` | `PullRequest.total_comments` | Do AI commits get more review comments? |

---

## GitHub Data

### Models & Sources

| Model | Webhook | API Fetch | Key Fields |
|-------|:-------:|:---------:|------------|
| `PullRequest` | âœ… `pull_request` | âœ… | github_pr_id, author, state, cycle_time, jira_key |
| `PRReview` | âœ… `pull_request_review` | âœ… | reviewer, state, submitted_at |
| `Commit` | âŒ | âœ… | sha, author, message, is_ai_assisted |
| `PRFile` | âŒ | âœ… | filename, status, additions, deletions, category |
| `PRCheckRun` | âŒ | âœ… | name, conclusion, duration_seconds |
| `PRComment` | âŒ | âœ… | author, body, comment_type (issue/review) |
| `Deployment` | âŒ | âœ… | environment, status, deployed_at |

### AI Detection in Commits

```python
# In sync_pr_commits(), we detect AI co-authors:

def _detect_ai_coauthors(commit_message: str) -> list[str]:
    """
    Parse commit message for AI co-author trailers.

    Example commit message:
    '''
    Add user authentication feature

    Co-authored-by: GitHub Copilot <copilot@github.com>
    Co-authored-by: Claude <claude@anthropic.com>
    '''

    Returns: ["copilot", "claude"]
    """
```

### Jira Key Extraction

```python
# In processors.py and github_sync.py:

def extract_jira_key(text: str) -> str | None:
    """
    Extract Jira key from PR title or branch name.

    Patterns matched:
    - "PROJ-123: Add feature"      â†’ "PROJ-123"
    - "feature/PROJ-456-new-ui"    â†’ "PROJ-456"
    - "[TICKET-789] Fix bug"       â†’ "TICKET-789"
    """
```

---

## Jira Integration

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JIRA DATA FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. OAuth Connection                                             â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚     User authorizes Atlassian OAuth                              â”‚
â”‚     â†’ JiraIntegration created                                    â”‚
â”‚     â†’ Scopes: read:jira-work, read:jira-user                    â”‚
â”‚                                                                  â”‚
â”‚  2. User Matching (sync_jira_users)                              â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚     GET /rest/api/3/users/search                                 â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”‚  For each Jira user:                                       â”‚
â”‚     â”‚  â€¢ Match to TeamMember by email                            â”‚
â”‚     â”‚  â€¢ Set TeamMember.jira_account_id = jira_user.accountId   â”‚
â”‚     â”‚                                                            â”‚
â”‚     This enables:                                                â”‚
â”‚     â€¢ JiraIssue.assignee â†’ TeamMember linking                   â”‚
â”‚     â€¢ Cross-platform attribution                                 â”‚
â”‚                                                                  â”‚
â”‚  3. Project Selection                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚     User selects Jira projects to track                          â”‚
â”‚     â†’ TrackedJiraProject records created                         â”‚
â”‚                                                                  â”‚
â”‚  4. Issue Sync (daily: sync_jira_projects_task)                  â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚     GET /rest/api/3/search                                       â”‚
â”‚     JQL: project = {key} AND updated >= -7d                      â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”‚  For each issue:                                           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚  â”‚ JiraIssue record:                                    â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ jira_key = "PROJ-123"                              â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ jira_id = internal ID                              â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ summary = issue title                              â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ issue_type = Story/Bug/Task                        â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ status = To Do/In Progress/Done                    â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ assignee = TeamMember (via jira_account_id)        â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ story_points = estimation                          â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ sprint_id, sprint_name                             â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ issue_created_at, resolved_at                      â”‚  â”‚
â”‚     â”‚  â”‚ â€¢ cycle_time_hours (calculated)                      â”‚  â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  5. Correlation with GitHub (automatic via jira_key)             â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚     PullRequest.jira_key links to JiraIssue.jira_key            â”‚
â”‚                                                                  â”‚
â”‚     JiraIssue has property:                                      â”‚
â”‚     @property                                                    â”‚
â”‚     def related_prs(self):                                       â”‚
â”‚         return PullRequest.objects.filter(jira_key=self.jira_key)â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Business Value

| Metric | Source | Insight |
|--------|--------|---------|
| Story Points Delivered | JiraIssue.story_points | Velocity tracking |
| Sprint Completion | Issues resolved in sprint | Sprint health |
| Planning Accuracy | Estimated vs actual cycle time | Estimation improvement |
| PR-to-Issue Ratio | PRs per Jira issue | Work granularity |

---

## Survey System

### Purpose

Collect ground truth about AI usage and code quality perception that can't be derived from GitHub data alone.

### Survey Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SURVEY SYSTEM FLOW                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  TRIGGER: PR Merged                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ send_pr_surveys_task                                                       â”‚  â”‚
â”‚  â”‚                                                                            â”‚  â”‚
â”‚  â”‚  1. Create PRSurvey record (linked to PullRequest)                        â”‚  â”‚
â”‚  â”‚                                                                            â”‚  â”‚
â”‚  â”‚  2. Author Survey (Slack DM or GitHub comment)                            â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚     â”‚ "Your PR #42 was merged! Did you use AI tools?"               â”‚    â”‚  â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚  â”‚
â”‚  â”‚     â”‚   [âœ… Yes, I used AI]    [âŒ No AI used]                       â”‚    â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                                            â”‚  â”‚
â”‚  â”‚  3. Reviewer Surveys (Slack DM to each reviewer)                          â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚     â”‚ "You reviewed PR #42. Quick feedback?"                         â”‚    â”‚  â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚  â”‚
â”‚  â”‚     â”‚ Quality: [Could be better] [OK] [Super]                       â”‚    â”‚  â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚  â”‚
â”‚  â”‚     â”‚ Do you think AI was used?                                     â”‚    â”‚  â”‚
â”‚  â”‚     â”‚   [ğŸ¤– Yes]    [ğŸ‘¤ No]                                         â”‚    â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                  â”‚
â”‚  RESPONSE HANDLING                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚                                                                                  â”‚
â”‚  Author Response:                                                                â”‚
â”‚  â€¢ PRSurvey.author_ai_assisted = True/False                                     â”‚
â”‚  â€¢ PRSurvey.author_responded_at = timestamp                                     â”‚
â”‚  â€¢ PullRequest.is_ai_assisted = True/False (if model field exists)              â”‚
â”‚                                                                                  â”‚
â”‚  Reviewer Response:                                                              â”‚
â”‚  â€¢ PRSurveyReview.quality_rating = 1/2/3                                        â”‚
â”‚  â€¢ PRSurveyReview.ai_guess = True/False                                         â”‚
â”‚  â€¢ PRSurveyReview.guess_correct = (ai_guess == survey.author_ai_assisted)       â”‚
â”‚  â€¢ PRSurveyReview.responded_at = timestamp                                      â”‚
â”‚                                                                                  â”‚
â”‚  REVEAL (after author responds)                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                                  â”‚
â”‚  When author discloses AI usage, reviewers who guessed can see:                 â”‚
â”‚  â€¢ Whether their guess was correct                                               â”‚
â”‚  â€¢ Their guess accuracy over time                                                â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Survey Data Points

| Field | Source | Insight |
|-------|--------|---------|
| `author_ai_assisted` | Author disclosure | Ground truth AI usage |
| `quality_rating` | Reviewer perception | Code quality signal |
| `ai_guess` | Reviewer guess | AI detectability |
| `guess_correct` | Calculated | Reviewer accuracy |

### Survey Metrics in WeeklyMetrics

```python
# In aggregate_team_weekly_metrics():

weekly_metrics.avg_quality_rating = PRSurveyReview.objects.filter(
    survey__pull_request__author=member,
    responded_at__range=(week_start, week_end)
).aggregate(Avg('quality_rating'))['quality_rating__avg']

weekly_metrics.surveys_completed = PRSurvey.objects.filter(
    author=member,
    author_responded_at__range=(week_start, week_end)
).count()

weekly_metrics.guess_accuracy = # Percentage of correct guesses
```

---

## Copilot Metrics

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COPILOT METRICS FLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  PREREQUISITE                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  â€¢ Team has GitHub Copilot Business/Enterprise                   â”‚
â”‚  â€¢ OAuth scope includes: manage_billing:copilot                  â”‚
â”‚                                                                  â”‚
â”‚  DAILY SYNC (sync_copilot_metrics_task)                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚                                                                  â”‚
â”‚  1. Fetch seat assignments                                       â”‚
â”‚     GET /orgs/{org}/copilot/billing/seats                        â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”‚  Response:                                                 â”‚
â”‚     â”‚  {                                                         â”‚
â”‚     â”‚    "seats": [                                              â”‚
â”‚     â”‚      {                                                     â”‚
â”‚     â”‚        "assignee": {"id": 12345, "login": "developer"},   â”‚
â”‚     â”‚        "created_at": "2025-01-01T00:00:00Z",              â”‚
â”‚     â”‚        "last_activity_at": "2025-01-15T14:30:00Z"         â”‚
â”‚     â”‚      }                                                     â”‚
â”‚     â”‚    ]                                                       â”‚
â”‚     â”‚  }                                                         â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€â–º Match to TeamMember via github_id                        â”‚
â”‚                                                                  â”‚
â”‚  2. Fetch usage metrics (if available in API)                    â”‚
â”‚     GET /orgs/{org}/copilot/usage                                â”‚
â”‚     â”‚                                                            â”‚
â”‚     â”‚  Per-user metrics:                                         â”‚
â”‚     â”‚  â€¢ suggestions_accepted                                    â”‚
â”‚     â”‚  â€¢ suggestions_rejected                                    â”‚
â”‚     â”‚  â€¢ chat_turns                                              â”‚
â”‚     â”‚  â€¢ active_days                                             â”‚
â”‚     â”‚                                                            â”‚
â”‚     â””â”€â–º AIUsageDaily records                                     â”‚
â”‚                                                                  â”‚
â”‚  3. Create AIUsageDaily records                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ AIUsageDaily:                                            â”‚ â”‚
â”‚     â”‚ â€¢ member = TeamMember (via github_id)                    â”‚ â”‚
â”‚     â”‚ â€¢ date = metrics date                                    â”‚ â”‚
â”‚     â”‚ â€¢ source = "copilot"                                     â”‚ â”‚
â”‚     â”‚ â€¢ suggestions_shown = count                              â”‚ â”‚
â”‚     â”‚ â€¢ suggestions_accepted = count                           â”‚ â”‚
â”‚     â”‚ â€¢ acceptance_rate = accepted / shown * 100               â”‚ â”‚
â”‚     â”‚ â€¢ active_hours = (estimated from activity)               â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Copilot Correlation Questions

| Question | Data Sources | Insight |
|----------|--------------|---------|
| Does Copilot boost productivity? | AIUsageDaily + WeeklyMetrics.prs_merged | Compare high vs low Copilot users |
| Does Copilot affect code quality? | AIUsageDaily + PRSurveyReview.quality_rating | Quality perception correlation |
| Copilot adoption trend | AIUsageDaily over time | Is usage growing? |
| ROI per seat | AIUsageDaily + productivity delta | Cost justification |

---

## Aggregation Layer

### WeeklyMetrics

Pre-computed weekly rollup per team member, combining all data sources.

```python
class WeeklyMetrics(BaseTeamModel):
    member = ForeignKey(TeamMember)
    week_start = DateField()  # Monday of week

    # GitHub Metrics
    prs_merged = IntegerField()
    avg_cycle_time_hours = DecimalField()
    avg_review_time_hours = DecimalField()
    commits_count = IntegerField()
    lines_added = IntegerField()
    lines_removed = IntegerField()
    revert_count = IntegerField()
    hotfix_count = IntegerField()

    # Jira Metrics
    story_points_completed = DecimalField()
    issues_resolved = IntegerField()

    # AI Metrics
    ai_assisted_prs = IntegerField()

    # Survey Metrics
    avg_quality_rating = DecimalField()
    surveys_completed = IntegerField()
    guess_accuracy = DecimalField()  # % of correct AI guesses
```

### Aggregation Task

```python
@shared_task
def aggregate_team_weekly_metrics():
    """
    Run weekly (Mondays) to pre-compute metrics for dashboard performance.

    Data sources aggregated:
    - PullRequest â†’ prs_merged, cycle_time, review_time, reverts, hotfixes
    - Commit â†’ commits_count, lines
    - JiraIssue â†’ story_points, issues_resolved
    - PRSurvey â†’ ai_assisted_prs, surveys_completed
    - PRSurveyReview â†’ quality_rating, guess_accuracy
    """
```

### ReviewerCorrelation

Tracks how often reviewer pairs agree/disagree.

```python
class ReviewerCorrelation(BaseTeamModel):
    reviewer_1 = ForeignKey(TeamMember)
    reviewer_2 = ForeignKey(TeamMember)

    prs_reviewed_together = IntegerField()
    agreements = IntegerField()      # Both approved OR both requested changes
    disagreements = IntegerField()   # One approved, one requested changes

    @property
    def is_redundant(self):
        """95%+ agreement with 10+ PRs = potentially redundant pairing"""
        return (self.agreement_rate >= 95 and
                self.prs_reviewed_together >= 10)
```

---

## Data Correlation Points

### The Big Picture: What Questions Can We Answer?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA CORRELATION MATRIX                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  QUESTION                           DATA SOURCES                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                                  â”‚
â”‚  "Is AI making us faster?"                                                       â”‚
â”‚   â””â”€â–º Compare: PRSurvey.author_ai_assisted vs PullRequest.cycle_time_hours     â”‚
â”‚       Compare: AIUsageDaily.suggestions_accepted vs WeeklyMetrics.prs_merged   â”‚
â”‚                                                                                  â”‚
â”‚  "Is AI code as good as human code?"                                            â”‚
â”‚   â””â”€â–º Compare: PRSurvey.author_ai_assisted vs PRSurveyReview.quality_rating    â”‚
â”‚       Compare: Commit.is_ai_assisted vs PullRequest.total_comments             â”‚
â”‚                                                                                  â”‚
â”‚  "Can reviewers tell when AI was used?"                                         â”‚
â”‚   â””â”€â–º Calculate: PRSurveyReview.guess_correct aggregate accuracy               â”‚
â”‚       Trend: Is accuracy improving or declining over time?                      â”‚
â”‚                                                                                  â”‚
â”‚  "Who are our top performers?"                                                   â”‚
â”‚   â””â”€â–º WeeklyMetrics: prs_merged, story_points, quality_rating                  â”‚
â”‚       Filter by: ai_assisted_prs (separate AI-assisted performance)            â”‚
â”‚                                                                                  â”‚
â”‚  "Are our estimates accurate?"                                                   â”‚
â”‚   â””â”€â–º Compare: JiraIssue.story_points vs PullRequest.cycle_time_hours          â”‚
â”‚       Trend: Estimation accuracy over time                                      â”‚
â”‚                                                                                  â”‚
â”‚  "Where is our code going?"                                                      â”‚
â”‚   â””â”€â–º PRFile.file_category: Distribution of changes (frontend/backend/test)   â”‚
â”‚       Trend: Test coverage ratio over time                                      â”‚
â”‚                                                                                  â”‚
â”‚  "Is our CI healthy?"                                                            â”‚
â”‚   â””â”€â–º PRCheckRun: Success rate, avg duration, flaky test detection             â”‚
â”‚                                                                                  â”‚
â”‚  "Which reviewer pairs are redundant?"                                           â”‚
â”‚   â””â”€â–º ReviewerCorrelation.is_redundant: High agreement pairs                   â”‚
â”‚       Insight: Could one reviewer be reassigned?                                â”‚
â”‚                                                                                  â”‚
â”‚  "How is Copilot adoption trending?"                                             â”‚
â”‚   â””â”€â–º AIUsageDaily: Unique users, acceptance_rate over time                    â”‚
â”‚       Compare: Before vs after Copilot rollout                                 â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Correlation Paths

```
TeamMember
    â”‚
    â”œâ”€â”€ github_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                              â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                          â”‚                                      â”‚
    â”‚   â”‚   PullRequest.author     â”‚      Commit.author                   â”‚
    â”‚   â”‚   PRReview.reviewer      â”‚      AIUsageDaily.member             â”‚
    â”‚   â”‚   PRSurvey.author        â”‚      WeeklyMetrics.member            â”‚
    â”‚   â”‚   PRSurveyReview.reviewerâ”‚                                      â”‚
    â”‚   â”‚                          â”‚                                      â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                              â”‚
    â”œâ”€â”€ jira_account_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º JiraIssue.assignee
    â”‚                              â”‚
    â””â”€â”€ slack_user_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â–º Slack DM delivery for surveys


PullRequest.jira_key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º JiraIssue.jira_key
    â”‚                                            â”‚
    â”‚ Links PR to planned work                   â”‚ story_points, sprint
    â”‚                                            â”‚
    â””â”€â”€â–º Enables: Story points per PR            â”‚
         Enables: Sprint completion correlation  â”‚
                                                 â”‚
                                                 â”‚
PRSurvey.author_ai_assisted â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Ground truth for:
    â”‚                                         â€¢ PullRequest.is_ai_assisted
    â”‚                                         â€¢ Training data for AI detection
    â”‚
    â””â”€â”€â–º PRSurveyReview.guess_correct â”€â”€â”€â”€â–º Reviewer accuracy tracking
```

---

## GitHub REST vs GraphQL API

### Current State: REST API (via PyGithub)

We currently use GitHub's REST API v3 through the PyGithub library.

### GraphQL API v4 Overview

GitHub's GraphQL API allows fetching exactly what you need in a single request, reducing over-fetching and round trips.

```graphql
# Example: Fetch PR with all related data in ONE request
query GetPullRequestComplete($owner: String!, $repo: String!, $number: Int!) {
  repository(owner: $owner, name: $repo) {
    pullRequest(number: $number) {
      id
      title
      state
      merged
      mergedAt
      createdAt
      additions
      deletions

      author {
        login
        ... on User { databaseId }
      }

      # Reviews - no separate API call needed
      reviews(first: 100) {
        nodes {
          id
          state
          submittedAt
          author { login }
        }
      }

      # Commits - no separate API call needed
      commits(first: 100) {
        nodes {
          commit {
            oid
            message
            committedDate
            additions
            deletions
            author { user { login databaseId } }
          }
        }
      }

      # Files - no separate API call needed
      files(first: 100) {
        nodes {
          path
          additions
          deletions
          changeType
        }
      }

      # Comments - no separate API call needed
      comments(first: 100) {
        nodes {
          id
          body
          createdAt
          author { login }
        }
      }

      # Review comments (inline)
      reviewThreads(first: 100) {
        nodes {
          comments(first: 10) {
            nodes {
              id
              body
              path
              line
              author { login }
            }
          }
        }
      }
    }
  }
}
```

### Comparison: REST vs GraphQL

#### API Call Efficiency

| Operation | REST API | GraphQL |
|-----------|----------|---------|
| Get PR with reviews, commits, files, comments | **5+ calls** | **1 call** |
| List PRs with author info | N+1 calls (or separate user fetch) | 1 call |
| Get specific fields only | Returns all fields | Returns only requested |

**Current REST flow (5+ calls per merged PR):**
```
1. GET /pulls/{number}              â†’ PR data
2. GET /pulls/{number}/commits      â†’ Commits
3. GET /pulls/{number}/files        â†’ Files
4. GET /commits/{sha}/check-runs    â†’ CI status
5. GET /issues/{number}/comments    â†’ Issue comments
6. GET /pulls/{number}/comments     â†’ Review comments
```

**GraphQL equivalent (1 call):**
```graphql
query { repository { pullRequest { ...allData } } }
```

### Pros of Moving to GraphQL

| Pro | Impact | Example |
|-----|--------|---------|
| **Fewer API calls** | Reduces rate limit usage by 80%+ | 5 calls â†’ 1 call per PR |
| **Precise data fetching** | Lower bandwidth, faster responses | Request only fields we need |
| **Nested data in one request** | Simpler code, fewer race conditions | PR + reviews + commits in one go |
| **Strongly typed schema** | Better IDE support, fewer runtime errors | Auto-completion, validation |
| **Real-time subscriptions** | Potential for live updates | (Not currently needed) |
| **Better pagination** | Cursor-based, more reliable | `after: "cursor"` vs `page=N` |

### Cons of Moving to GraphQL

| Con | Impact | Mitigation |
|-----|--------|------------|
| **Learning curve** | Team needs to learn GraphQL | Good documentation exists |
| **No official Python SDK** | PyGithub is REST-only | Use `gql` or `sgqlc` libraries |
| **Query complexity limits** | GitHub limits query depth/nodes | Split complex queries |
| **Different rate limiting** | Points-based, not call-based | Actually more generous |
| **Migration effort** | Rewrite sync services | Can migrate incrementally |
| **Debugging harder** | Single request = complex debugging | Use GraphQL explorer |
| **Cache invalidation** | REST caching doesn't apply | Use query hashing |

### Rate Limiting Comparison

**REST API v3:**
- 5,000 requests/hour for OAuth apps
- Each endpoint = 1 request
- Our current flow: ~5-10 calls per merged PR

**GraphQL API v4:**
- Points-based: 5,000 points/hour
- Simple queries: 1 point
- Complex queries: More points (calculated by nodes fetched)
- Our typical query: ~10-50 points (fetches what would be 5+ REST calls)

**Net result:** GraphQL typically 3-5x more efficient for our use case.

### Migration Strategy (If We Decide to Migrate)

```
Phase 1: Hybrid (Low Risk)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Keep PyGithub for simple operations (member sync, repo listing)
Add GraphQL for complex fetches (PR complete data)

Phase 2: New Features in GraphQL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Build new sync features using GraphQL
Don't touch working REST code

Phase 3: Gradual Migration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Migrate sync services one by one
Keep REST as fallback
Monitor rate limit usage

Phase 4: Full GraphQL (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Only if benefits outweigh migration cost
May never be necessary
```

### GraphQL Implementation Example

```python
# Using gql library
from gql import gql, Client
from gql.transport.aiohttp import AIOHTTPTransport

def get_pr_complete_data_graphql(access_token: str, owner: str, repo: str, pr_number: int):
    """Fetch complete PR data in a single GraphQL request."""

    transport = AIOHTTPTransport(
        url="https://api.github.com/graphql",
        headers={"Authorization": f"Bearer {access_token}"}
    )
    client = Client(transport=transport, fetch_schema_from_transport=True)

    query = gql("""
        query GetPRComplete($owner: String!, $repo: String!, $number: Int!) {
            repository(owner: $owner, name: $repo) {
                pullRequest(number: $number) {
                    databaseId
                    title
                    state
                    merged
                    mergedAt
                    createdAt
                    additions
                    deletions

                    author {
                        login
                        ... on User { databaseId }
                    }

                    commits(first: 100) {
                        nodes {
                            commit {
                                oid
                                message
                                committedDate
                                additions
                                deletions
                            }
                        }
                    }

                    files(first: 100) {
                        nodes {
                            path
                            additions
                            deletions
                            changeType
                        }
                    }

                    reviews(first: 100) {
                        nodes {
                            databaseId
                            state
                            submittedAt
                            author { login }
                        }
                    }

                    comments(first: 100) {
                        nodes {
                            databaseId
                            body
                            createdAt
                            author { login }
                        }
                    }
                }
            }
        }
    """)

    result = client.execute(query, variable_values={
        "owner": owner,
        "repo": repo,
        "number": pr_number
    })

    return result["repository"]["pullRequest"]
```

### Recommendation

**For now: Stay with REST API (PyGithub)**

Reasons:
1. Current implementation works and is well-tested
2. PyGithub handles pagination, retries, rate limiting
3. Migration effort doesn't justify current needs
4. 5 API calls per merged PR is acceptable

**Consider GraphQL when:**
1. Rate limiting becomes a problem (high PR volume)
2. Building new real-time features
3. Need data that's expensive to fetch via REST
4. Significant refactoring is already planned

**Quick win without full migration:**
Use GraphQL for `fetch_pr_complete_data_task` only - it's the perfect candidate:
- Fetches 5+ resources per call
- Runs in background (latency less critical)
- New code (no legacy to maintain)

---

## Summary

| Integration | Primary Key | Links To | Business Value |
|-------------|-------------|----------|----------------|
| **GitHub** | `github_id` | TeamMember | Code delivery metrics |
| **Jira** | `jira_account_id`, `jira_key` | TeamMember, PullRequest | Planning correlation |
| **Slack** | `slack_user_id` | TeamMember | Survey delivery |
| **Copilot** | `github_id` | TeamMember | AI adoption metrics |
| **Surveys** | `pull_request`, `author`, `reviewer` | PR, TeamMember | Ground truth AI usage |

**TeamMember is the universal linker** - all cross-platform correlations flow through it.

---

## API Strategy Summary

| API | Current | Recommendation |
|-----|---------|----------------|
| GitHub REST | âœ… In use (PyGithub) | Keep for most operations |
| GitHub GraphQL | âŒ Not used | Consider for new complex fetches |
| Jira REST | âœ… In use (jira library) | Keep (no GraphQL alternative) |
| Slack Web API | âœ… In use (slack-sdk) | Keep (best option) |
| Copilot API | âœ… Via GitHub REST | Keep (part of GitHub) |
