# Improve AI Detection Regex Patterns - Plan

**Last Updated: 2025-12-26**

## Executive Summary

Analysis of LLM vs regex AI detection results across 53,876 PRs reveals **1,717 PRs** where LLM detected AI usage but regex patterns missed the detection. This represents a 3% gap that can be closed by adding new patterns for emerging tools and improving existing pattern coverage.

Key finding: The most significant gaps are in **AI code review tools** (CodeRabbit author detection, Greptile) and **i18n/translation AI** (Replexica).

## Current State Analysis

### Detection Comparison Results

| Metric | Value | Notes |
|--------|-------|-------|
| Total PRs with LLM analysis | 53,876 | 89% of all PRs |
| Regex-detected AI | 11,828 | Existing patterns |
| LLM-detected AI | 11,539 | Confidence â‰¥ 0.5 |
| **LLM Only (Gap)** | **1,717** | Opportunity |
| Regex Only (FP?) | 358 | Potential false positives |

### Gap Analysis by Tool

Top tools detected by LLM but missed by regex:

| Tool | Count | % of Gap | Issue |
|------|-------|----------|-------|
| CodeRabbit | 467 | 27.2% | **Author** detection missing (bot reviews work) |
| Greptile | 456 | 26.6% | Pattern exists, but LLM detecting from review context |
| Copilot | 163 | 9.5% | No explicit mentions - LLM inferring from style |
| Claude | 145 | 8.4% | No explicit mentions - LLM inferring |
| Cursor | 110 | 6.4% | No explicit mentions - LLM inferring |
| Cubic | 89 | 5.2% | Pattern exists, may need expansion |
| Devin | 38 | 2.2% | Pattern exists, coverage gap |
| Mintlify | 11 | 0.6% | Need author patterns |
| Replexica | 9 | 0.5% | **NEW TOOL** - No patterns exist |

### Usage Type Distribution

| Usage Type | Count | Notes |
|------------|-------|-------|
| reviewed | 624 | AI code review tools |
| assisted | 561 | AI-assisted coding |
| authored | 513 | AI authored the PR |
| brainstorm | 17 | Used for planning |
| co-authored | 2 | Partial AI authorship |

## Proposed Future State

### Version Bump
- Current: `PATTERNS_VERSION = "1.9.0"`
- Proposed: `PATTERNS_VERSION = "2.0.0"` (major version for significant additions)

### New Patterns to Add

1. **Replexica** (i18n AI) - 9 new detections
2. **CodeRabbit Author** (PR creation by CR bot) - ~400 new detections
3. **Mintlify Author** patterns - ~11 new detections
4. **Lingo.dev** (Replexica rebrand) - future-proofing

### Pattern Improvements

1. **Greptile** - Verify existing pattern matches, may need review context detection
2. **Cubic** - Expand patterns for edge cases

### Explicit Non-Goals

The following will NOT be added as regex patterns:

| Tool | Count | Why Not |
|------|-------|---------|
| Copilot (implicit) | 163 | No text markers - LLM infers from code style |
| Claude (implicit) | 145 | No text markers - LLM infers from code style |
| Cursor (implicit) | 110 | No text markers - LLM infers from code style |

These are best left to LLM detection which can understand context and code style. Adding regex patterns would cause false positives.

## Implementation Phases

### Phase 1: Add Replexica Patterns (S effort)

Add patterns for Replexica i18n AI tool:
- `Replexica AI`
- `@replexica`
- `@lingodotdev` (new brand)
- `Replexica Localization Engine`
- `replexica.com`

### Phase 2: CodeRabbit Author Detection (S effort)

Add patterns for CodeRabbit-authored PRs (not just reviews):
- `Docstrings generation was requested`
- `CodeRabbit cannot perform edits`
- Bot username: `coderabbit[bot]` as author (not reviewer)

### Phase 3: Mintlify Author Detection (S effort)

Add patterns for Mintlify-authored PRs:
- `Generated by Mintlify`
- `Mintlify Writer`

### Phase 4: Pattern Verification & Testing (M effort)

- Verify Greptile patterns are matching correctly
- Verify Cubic patterns are matching correctly
- Run backfill and compare detection rates
- Validate against known false positive cases

## Detailed Tasks

See `improve-ai-regex-patterns-tasks.md` for full checklist.

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| False positives from new patterns | Medium | Medium | Test against known-negative PRs first |
| Breaking existing detection | Low | High | Unit tests cover all existing patterns |
| LLM hallucinating tool usage | Low | Low | Cross-reference with actual PR body text |

## Success Metrics

| Metric | Current | Target | How to Measure |
|--------|---------|--------|----------------|
| LLM-only gap | 1,717 | < 1,000 | Re-run comparison after backfill |
| New detections | 0 | +500 | Count new `is_ai_assisted=True` PRs |
| False positive rate | < 2% | < 2% | Manual sampling |
| Pattern version | 1.9.0 | 2.0.0 | PATTERNS_VERSION constant |

## Required Resources

### Files to Modify

| File | Changes |
|------|---------|
| `apps/metrics/services/ai_patterns.py` | Add new patterns, update version |
| `apps/metrics/tests/test_ai_detector.py` | Add tests for new patterns |

### Commands

```bash
# Run AI detection tests
pytest apps/metrics/tests/test_ai_detector.py -v

# Run backfill after pattern changes
python manage.py backfill_ai_detection --dry-run --limit 100
python manage.py backfill_ai_detection

# Compare detection rates
python manage.py shell -c "
from apps.metrics.models import PullRequest
from django.db.models import Q
llm_only = PullRequest.objects.filter(
    llm_summary__ai__is_assisted=True,
    llm_summary__ai__confidence__gte=0.5,
    is_ai_assisted=False
).count()
print(f'LLM-only detections: {llm_only}')
"
```
