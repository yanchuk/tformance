# AI Detection Prompt v4.0

## Changelog
- v4.0 (2025-12-25): Added technology detection (primary_language, tech_categories)
- v3.0 (2025-12-25): Added files, commits, reviews sections with detection guidance
- v2.0 (2025-12-25): Added rich PR context (metadata, size, labels, linked issues)
- v1.0 (2025-12-24): Initial prompt for Groq Llama 3.3 70B

---

## New in v4.0: Technology Detection

The prompt now performs two tasks:
1. **AI Detection** - Same as v3 (detect AI tool usage)
2. **Technology Detection** - NEW: Identify languages and tech categories from files

### New Response Fields

```json
{
  "primary_language": "python" | "typescript" | "javascript" | "go" | "ruby" | "java" | null,
  "tech_categories": ["frontend", "backend", "test", "config", "docs"]
}
```

### Language Detection Rules (SO 2025 Survey)

| Extension | Language | SO 2025 Usage |
|-----------|----------|---------------|
| .js, .jsx, .mjs | javascript | 62.3% |
| .ts, .tsx | typescript | 38.5% |
| .py | python | 51.0% |
| .java | java | 30.3% |
| .cs | csharp | 27.1% |
| .cpp, .cc, .cxx | cpp | 23.0% |
| .php | php | 18.2% |
| .go | go | 13.5% |
| .rs | rust | 12.6% |
| .rb | ruby | 5.2% |
| .swift | swift | 4.7% |
| .kt, .kts | kotlin | 9.1% |
| .scala | scala | 2.6% |
| .dart | dart | 5.9% |
| .ex, .exs | elixir | 2.2% |
| .sql | sql | 51.5% |
| .sh, .bash | shell | 32.4% |
| .html, .css, .scss | html_css | 52.9% |
| .vue | vue | - |
| .svelte | svelte | - |

### Category Detection

LLM analyzes the `[category]` prefix in Files Changed section:
- `[frontend]` → frontend
- `[backend]` → backend
- `[test]` → test
- `[config]` → config
- `[docs]` → docs

---

## Full System Prompt

```
You analyze pull requests to detect AI tool usage and identify technologies.
You MUST respond with valid JSON only.

## Input Format
[Same as v3 - PR Metadata, Description, Files, Commits, Reviews]

## Task 1: AI Detection
[Positive/Negative signals for AI usage]

## Task 2: Technology Detection
Analyze the Files Changed section to determine:
1. Primary language: Most significant language by lines changed
2. Tech categories: What areas the PR touches

## Response Format
{
  "is_ai_assisted": boolean,
  "tools": ["lowercase", "tool", "names"],
  "usage_category": "authored" | "assisted" | "reviewed" | "brainstorm" | null,
  "confidence": 0.0-1.0,
  "reasoning": "1-sentence explanation",
  "primary_language": "python" | "typescript" | "javascript" | "go" | "ruby" | "java" | null,
  "tech_categories": ["frontend", "backend", "test", "config", "docs"]
}
```

---

## BatchResult Updates

Added fields to `BatchResult` dataclass:
- `primary_language: str | None`
- `tech_categories: list[str] | None`

---

## Use Cases

1. **Dashboard insights**: Show technology breakdown per team
2. **AI by language**: Correlate AI usage with primary language
3. **Category trends**: Track AI adoption in frontend vs backend
