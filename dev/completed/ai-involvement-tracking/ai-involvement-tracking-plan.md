# AI Involvement Tracking - Implementation Plan

**Last Updated:** 2025-12-21

## Executive Summary

Implement automatic detection and tracking of AI involvement in PRs, reviews, and commits. This enhances the platform's core value proposition of understanding "Is AI actually helping my team?" by detecting AI tools used even before explicit surveys are completed.

### Goals
1. Detect AI reviewers (CodeRabbit, Copilot, etc.) automatically
2. Detect AI-authored/co-authored PRs and commits from signatures
3. Store detection results for analytics and dashboard display
4. Complement existing survey-based AI attribution with automatic detection

---

## Current State Analysis

### Data Currently Captured (GitHub Fetcher)
| Data | Captured | Stored in DB | AI Detection Potential |
|------|----------|--------------|------------------------|
| PR body | âœ… Yes | âŒ No | High - AI signatures |
| PR title | âœ… Yes | âœ… Yes | Medium - Tool mentions |
| PR author | âœ… Yes | âœ… Yes | Medium - Bot accounts |
| Review author | âœ… Yes | âœ… Yes | High - AI reviewer bots |
| Review body | âœ… Yes | âŒ No | Medium - AI signatures |
| Commit message | âœ… Yes | âœ… Yes | High - Co-Authored-By |
| Commit author | âœ… Yes | âœ… Yes | Medium - Bot accounts |

### Gap Analysis
1. **PR body not stored** - Missing AI signatures like "ðŸ¤– Generated with Claude Code"
2. **Review body not stored** - Missing AI-generated review content
3. **No AI detection fields** - No way to flag AI involvement
4. **No detection logic** - No patterns to identify AI tools

---

## Proposed Future State

### AI Detection Capabilities
1. **AI Reviewer Detection** - Identify reviews from AI bots by username
2. **AI-Authored PRs** - Detect PRs created/co-authored by AI tools
3. **AI-Assisted Commits** - Parse Co-Authored-By headers for AI signatures
4. **Aggregated Metrics** - Track AI involvement trends over time

### AI Tools to Detect

| Category | Tool | Detection Method |
|----------|------|-----------------|
| **Reviewers** | CodeRabbit | Username: `coderabbitai` |
| | GitHub Copilot | Username: `*copilot*[bot]` |
| | Dependabot | Username: `dependabot[bot]` |
| | Renovate | Username: `renovate[bot]` |
| **Authors** | Claude Code | Body: `Generated with [Claude Code]` |
| | GitHub Copilot | Body/Commit: `Co-Authored-By: GitHub Copilot` |
| | Cursor | Body/Commit: `Generated by Cursor` |
| | Claude | Commit: `Co-Authored-By: Claude` |

---

## Implementation Phases

### Phase 1: Database Schema Changes
**Effort:** Medium | **Priority:** High | **Dependencies:** None

Add fields to track AI involvement in existing models.

### Phase 2: AI Detection Module
**Effort:** Medium | **Priority:** High | **Dependencies:** Phase 1

Create detection logic for identifying AI patterns.

### Phase 3: Seeder Integration
**Effort:** Small | **Priority:** High | **Dependencies:** Phase 2

Update GitHub seeder to run AI detection and store results.

### Phase 4: Dashboard Integration
**Effort:** Medium | **Priority:** Medium | **Dependencies:** Phase 3

Display AI involvement metrics in dashboards.

---

## Detailed Tasks

### Phase 1: Database Schema Changes

#### 1.1 Add AI fields to PullRequest model
**Effort:** S | **Acceptance Criteria:**
- [ ] Add `body` TextField to store PR description
- [ ] Add `is_ai_assisted` BooleanField (default=False)
- [ ] Add `ai_tools_detected` JSONField (default=list)
- [ ] Create and apply migration
- [ ] Update factories

#### 1.2 Add AI fields to PRReview model
**Effort:** S | **Acceptance Criteria:**
- [ ] Add `body` TextField to store review content
- [ ] Add `is_ai_review` BooleanField (default=False)
- [ ] Add `ai_reviewer_type` CharField (max_length=50, blank=True)
- [ ] Create and apply migration
- [ ] Update factories

#### 1.3 Add AI fields to Commit model
**Effort:** S | **Acceptance Criteria:**
- [ ] Add `is_ai_assisted` BooleanField (default=False)
- [ ] Add `ai_co_authors` JSONField (default=list)
- [ ] Create and apply migration
- [ ] Update factories

### Phase 2: AI Detection Module

#### 2.1 Create AI detector service
**Effort:** M | **Acceptance Criteria:**
- [ ] Create `apps/metrics/services/ai_detector.py`
- [ ] Define AI reviewer bot patterns (username-based)
- [ ] Define AI signature patterns (regex-based)
- [ ] Implement `detect_ai_reviewer(username)` function
- [ ] Implement `detect_ai_in_text(text)` function
- [ ] Implement `parse_co_authors(message)` function
- [ ] TDD: Write tests first in `apps/metrics/tests/test_ai_detector.py`

#### 2.2 Known AI patterns registry
**Effort:** S | **Acceptance Criteria:**
- [ ] Define AI_REVIEWER_BOTS dict with bot usernames
- [ ] Define AI_SIGNATURE_PATTERNS list with regex patterns
- [ ] Define AI_CO_AUTHOR_PATTERNS for commit parsing
- [ ] Make patterns configurable/extensible

### Phase 3: Seeder Integration

#### 3.1 Update real_project_seeder to store PR body
**Effort:** S | **Acceptance Criteria:**
- [ ] Store `pr_data.body` in PullRequest.body field
- [ ] Store `review_data.body` in PRReview.body field
- [ ] Verify with test

#### 3.2 Integrate AI detection in seeder
**Effort:** M | **Acceptance Criteria:**
- [ ] Call `detect_ai_reviewer()` when creating reviews
- [ ] Call `detect_ai_in_text()` on PR body and title
- [ ] Call `parse_co_authors()` on commit messages
- [ ] Store detection results in model fields
- [ ] Log AI detection statistics

### Phase 4: Dashboard Integration

#### 4.1 Add AI metrics to team dashboard
**Effort:** M | **Acceptance Criteria:**
- [ ] Show count of AI-assisted PRs
- [ ] Show count of AI reviews
- [ ] Show AI tool usage breakdown
- [ ] Show trends over time

#### 4.2 Add AI indicators to PR list views
**Effort:** S | **Acceptance Criteria:**
- [ ] Show AI badge on AI-assisted PRs
- [ ] Show AI reviewer badge on reviews
- [ ] Filter PRs by AI involvement

---

## Risk Assessment

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| False positives in AI detection | Medium | Medium | Use conservative patterns, allow manual override |
| Missing AI tools | Low | High | Make patterns registry extensible |
| Performance impact on seeding | Low | Low | Detection is simple string matching |
| Migration issues | Medium | Low | Test migrations thoroughly |

---

## Success Metrics

1. **Detection Accuracy:** >95% true positive rate for known AI tools
2. **Coverage:** Detect top 5 AI reviewer bots and top 5 AI authoring tools
3. **Performance:** <1ms overhead per PR for AI detection
4. **Dashboard Value:** Show AI involvement trends in CTO dashboard

---

## Required Resources

### Dependencies
- No new packages required (regex is built-in)
- Existing Django models and factories

### Files to Create/Modify
| File | Action | Purpose |
|------|--------|---------|
| `apps/metrics/models.py` | Modify | Add AI fields |
| `apps/metrics/migrations/00XX_*.py` | Create | Schema changes |
| `apps/metrics/factories.py` | Modify | Update factories |
| `apps/metrics/services/ai_detector.py` | Create | Detection logic |
| `apps/metrics/tests/test_ai_detector.py` | Create | TDD tests |
| `apps/metrics/seeding/real_project_seeder.py` | Modify | Store body, run detection |

---

## Timeline Estimate

| Phase | Effort | Duration |
|-------|--------|----------|
| Phase 1: Database Changes | Medium | 1-2 hours |
| Phase 2: AI Detection Module | Medium | 2-3 hours |
| Phase 3: Seeder Integration | Small | 1 hour |
| Phase 4: Dashboard Integration | Medium | 2-3 hours |
| **Total** | | **6-9 hours** |

---

## Notes

- This feature complements the existing PR Survey system for AI attribution
- Survey data provides author self-disclosure, this provides automatic detection
- Both sources can be combined for more accurate AI usage tracking
- Detection patterns should be reviewed and updated as new AI tools emerge
