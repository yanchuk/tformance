# Real Data Seeding Context

**Last Updated:** 2025-12-24

## Strategic Goal

Seed real GitHub PR data from multiple open source orgs to test and improve AI detection patterns locally.

## Current State

### Data Already Seeded

| Org | PRs | AI Detected | Rate | Repos | Notes |
|-----|-----|-------------|------|-------|-------|
| Antiwork | 44 | 18 | 40.9% | 3 | HIGH disclosure culture |
| Polar | 300 | 1 | 0.3% | 4 | LOW disclosure baseline |
| PostHog | 40 | ? | ? | 4 | Partial (test run) |
| Anthropic | 10 | ? | ? | 3 | Partial (test run) |
| Cal.com | 5 | ? | ? | 1 | Partial (test run) |
| Trigger.dev | 5 | ? | ? | 1 | Partial (test run) |

### New Orgs Added This Session

Added to `apps/metrics/seeding/real_projects.py`:

1. **anthropic** - anthropics/anthropic-cookbook, anthropic-sdk-python, courses
2. **calcom** - calcom/cal.com
3. **trigger** - triggerdotdev/trigger.dev

### Key Feature: `--no-check-runs` Flag

Added flag to skip REST API check runs fetching (the slow part):

**Files Modified:**
- `apps/metrics/management/commands/seed_real_projects.py` - Added `--no-check-runs` argument
- `apps/metrics/seeding/real_project_seeder.py` - Added `skip_check_runs` parameter

**Usage:**
```bash
.venv/bin/python manage.py seed_real_projects --project posthog --no-check-runs
```

**Speed improvement:** ~10x faster (11 API calls vs hundreds)

## Migration Applied

```bash
.venv/bin/python manage.py migrate
# Applied: metrics.0018_add_ai_detection_version
```

The `ai_detection_version` column was missing from PullRequest model.

## Files Modified This Session

| File | Changes |
|------|---------|
| `apps/metrics/seeding/real_projects.py` | Added anthropic, calcom, trigger configs |
| `apps/metrics/management/commands/seed_real_projects.py` | Added `--no-check-runs` flag |
| `apps/metrics/seeding/real_project_seeder.py` | Added `skip_check_runs` parameter |

## Commands for Next Session

### Run Full Seeding (in terminal)

```bash
cd /Users/yanchuk/Documents/GitHub/tformance

.venv/bin/python manage.py seed_real_projects --project posthog --clear --max-prs 100 --no-check-runs && \
.venv/bin/python manage.py seed_real_projects --project anthropic --clear --max-prs 50 --no-check-runs && \
.venv/bin/python manage.py seed_real_projects --project calcom --clear --max-prs 80 --no-check-runs && \
.venv/bin/python manage.py seed_real_projects --project trigger --clear --max-prs 50 --no-check-runs
```

### Verify Data After Seeding

```sql
SELECT
    t.name as team,
    COUNT(pr.id) as total_prs,
    COUNT(CASE WHEN pr.is_ai_assisted THEN 1 END) as ai_prs,
    ROUND(100.0 * COUNT(CASE WHEN pr.is_ai_assisted THEN 1 END) / NULLIF(COUNT(pr.id), 0), 1) as ai_pct
FROM metrics_pullrequest pr
JOIN teams_team t ON pr.team_id = t.id
GROUP BY t.name
ORDER BY total_prs DESC;
```

## AI Detection Patterns Analysis

### Patterns Working Well

1. `## AI Disclosure` / `### AI Disclosure` section headers
2. "Used Claude Opus 4.5 for implementation"
3. "Cursor Auto Mode for re-factor"
4. Co-Authored-By headers with @anthropic.com
5. Devin bot PRs (author detection)

### No False Positives Found

- "Generated by Speakeasy CLI" - correctly NOT flagged
- "cursor_pagination" (parameter name) - correctly NOT flagged
- "AI features" (product description) - correctly NOT flagged

## PostHog LLM Analytics (Documented)

The project has PostHog LLM observability configured:

1. **LiteLLM callbacks** in `apps/metrics/experiments/runner.py`:
   ```python
   litellm.success_callback = ["posthog"]
   litellm.failure_callback = ["posthog"]
   ```

2. **GeminiClient** in `apps/insights/services/gemini_client.py`:
   - Manual PostHog tracking via `$ai_generation` events

3. **Environment variables:**
   ```bash
   POSTHOG_API_KEY=""
   POSTHOG_HOST="https://us.i.posthog.com"
   ```

## Related Tasks

- `dev/active/incremental-seeding/` - Phase 4.2 complete (rate limit wait logic)
- `dev/active/ai-detection-pr-descriptions/` - AI detection patterns work

## Uncommitted Changes

Check with:
```bash
git status --short
```

Expected uncommitted:
- `apps/metrics/seeding/real_projects.py` - new org configs
- `apps/metrics/management/commands/seed_real_projects.py` - --no-check-runs flag
- `apps/metrics/seeding/real_project_seeder.py` - skip_check_runs param

## Next Steps

1. Run full seeding command (user running in terminal)
2. Verify data counts and AI detection rates
3. Analyze patterns in Anthropic PRs (expected high AI disclosure)
4. Compare detection rates across orgs
5. Commit changes after verification
