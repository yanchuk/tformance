{% load i18n %}
{# Note row partial for HTMX swaps #}
<div id="note-{{ note.id }}" class="card bg-base-200 shadow-sm {% if note.is_resolved %}opacity-60{% endif %}">
  <div class="card-body py-4">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-2">
          <a href="{% url 'notes:note_form' pr_id=note.pull_request.id %}"
             class="link link-primary font-medium">
            PR #{{ note.pull_request.github_pr_id }}
          </a>
          {% if note.flag %}
            <span class="badge badge-sm
              {% if note.flag == 'false_positive' %}badge-warning
              {% elif note.flag == 'review_later' %}badge-info
              {% elif note.flag == 'important' %}badge-primary
              {% elif note.flag == 'concern' %}badge-error
              {% endif %}">
              {{ note.get_flag_display }}
            </span>
          {% endif %}
          {% if note.is_resolved %}
            <span class="badge badge-sm badge-success">{% trans "Resolved" %}</span>
          {% endif %}
        </div>
        <p class="text-sm text-base-content/70 truncate mb-2">
          {{ note.pull_request.title }}
        </p>
        <p class="text-base-content">{{ note.content }}</p>
        <p class="text-xs text-base-content/50 mt-2">
          {{ note.created_at|date:"M j, Y" }}
        </p>
      </div>
      <div class="flex gap-2">
        <form hx-post="{% url 'notes:toggle_resolve' note_id=note.id %}"
              hx-target="#note-{{ note.id }}"
              hx-swap="outerHTML">
          {% csrf_token %}
          <button type="submit" class="btn btn-ghost btn-sm">
            {% if note.is_resolved %}{% trans "Reopen" %}{% else %}{% trans "Resolve" %}{% endif %}
          </button>
        </form>
        <a href="{% url 'notes:note_form' pr_id=note.pull_request.id %}"
           class="btn btn-ghost btn-sm">
          {% trans "Edit" %}
        </a>
      </div>
    </div>
  </div>
</div>
