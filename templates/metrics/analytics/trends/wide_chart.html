{% load i18n %}
{# Wide Trend Chart Partial - Loaded via HTMX #}
{# Supports single metric (backward compat) and multi-metric comparison #}

{# Store chart data as JSON in script tags for safe JavaScript access #}
{{ chart_data|json_script:"trend-chart-data" }}
{% if comparison_data %}{{ comparison_data|json_script:"trend-comparison-data" }}{% endif %}

<div class="p-6">
  <!-- Chart Header -->
  <div class="flex justify-between items-center mb-4">
    <div>
      <h2 class="text-lg font-semibold text-base-content">{{ metric_display }}</h2>
      <p class="text-sm text-base-content/60">
        {{ start_date|date:"M j, Y" }} - {{ end_date|date:"M j, Y" }}
        <span class="ml-2 badge badge-ghost badge-sm">{{ granularity }}</span>
        {% if is_multi_metric %}
        <span class="ml-1 badge badge-primary badge-sm">{% trans "Comparing" %}</span>
        {% endif %}
      </p>
    </div>
    <div class="flex gap-2">
      <button type="button"
              class="btn btn-ghost btn-sm"
              data-chart-reset
              onclick="if (window.trendChart) window.resetChartZoom(window.trendChart);"
              title="{% trans 'Reset Zoom' %}">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Chart Container (wide aspect ratio) -->
  <div class="relative w-full">
    <div style="height: 360px;">
      <canvas id="trend-chart"
              data-trend-chart
              data-metric="{{ metric }}"
              data-multi-metric="{{ is_multi_metric|yesno:'true,false' }}">
      </canvas>
    </div>
  </div>

  <!-- Zoom/Pan Instructions -->
  <div class="mt-4 text-center">
    <p class="text-xs text-base-content/50">
      <svg xmlns="http://www.w3.org/2000/svg" class="inline h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h8m-4-4v8" />
      </svg>
      {% trans "Scroll to zoom, drag to pan" %}
    </p>
  </div>
</div>
